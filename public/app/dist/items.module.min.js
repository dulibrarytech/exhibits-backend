let itemsModule=(()=>{let _=()=>{try{return endpointsModule.get_exhibits_endpoints()}catch(e){return console.error("Error getting exhibits endpoints:",e),null}},y=(()=>{try{var e=window.localStorage.getItem("exhibits_app_path");return e?e:(console.error("App path not found in localStorage"),"")}catch(e){return console.error("Error accessing localStorage:",e),""}})(),f={},w=(e,t,i)=>{var r,a;e?(t=["info","success","danger","warning"].includes(t)?t:"danger",(r=document.createElement("div")).className="alert alert-"+t,r.setAttribute("role","alert"),(a=document.createElement("i")).className=n(t),a.setAttribute("aria-hidden","true"),r.appendChild(a),t=document.createTextNode(" "+i),r.appendChild(t),e.textContent="",e.appendChild(r)):console.error("Message element not found:",i)},n=e=>({info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"})[e]||"fa fa-exclamation";async function x(i){try{if(!i)throw new Error("Invalid item UUID");var e=helperModule.get_parameter_by_name("exhibit_id");if(!e)throw new Error("Exhibit ID not found");var r=document.getElementsByTagName("tr");let t=null;for(let e=0;e<r.length;e++)if(r[e].id&&-1!==r[e].id.indexOf(i)){var a=r[e].id.split("_");t=a[a.length-1];break}if(!t)throw new Error("Could not determine item type");console.log("Publishing item type:",t);var n,o,s,d,l=_();if(l?.exhibits?.item_records?.item_publish?.post?.endpoint)return m=l.exhibits.item_records.item_publish.post.endpoint.replace(":exhibit_id",encodeURIComponent(e)).replace(":item_id",encodeURIComponent(i))+"?type="+encodeURIComponent(t),(n=authModule.get_user_token())&&!1!==n?(s=await httpModule.req({method:"POST",url:m,headers:{"Content-Type":"application/json","x-access-token":n},timeout:3e4}))&&200===s.status?(c=i,u=t,p=e,(h=document.getElementById(c))?(h.classList.remove("publish-item"),h.classList.add("suppress-item"),(g=document.createElement("span")).id="suppress-"+c,g.setAttribute("title","Published - click to unpublish"),(b=document.createElement("i")).className="fa fa-cloud",b.style.color="green",b.setAttribute("aria-hidden","true"),g.appendChild(b),g.appendChild(document.createElement("br")),g.appendChild(document.createTextNode("Published")),h.textContent="",h.appendChild(g),C(c,u,p,!0)):console.error("Status element not found for UUID: "+c),!0):(window.scrollTo({top:0,behavior:"smooth"}),d=document.querySelector("#message"),w(d,"danger","You do not have permission to publish this record."),!1):(o=document.querySelector("#message"),w(o,"danger","Session expired. Please log in again."),!1);throw new Error("Publish endpoint not configured")}catch(e){console.error("Error publishing item:",e);var l=document.querySelector("#message"),m=e.user_message||e.message||"Unable to publish item. Please try again.";return w(l,"danger",m),!1}var c,u,p,h,g,b}async function v(i){try{if(!i)throw new Error("Invalid item UUID");var e=helperModule.get_parameter_by_name("exhibit_id");if(!e)throw new Error("Exhibit ID not found");var r=document.getElementsByTagName("tr");let t=null;for(let e=0;e<r.length;e++)if(r[e].id&&-1!==r[e].id.indexOf(i)){var a=r[e].id.split("_");t=a[a.length-1];break}if(!t)throw new Error("Could not determine item type");console.log("Suppressing item type:",t);var n,o,s,d,l=_();if(l?.exhibits?.item_records?.item_suppress?.post?.endpoint)return m=l.exhibits.item_records.item_suppress.post.endpoint.replace(":exhibit_id",encodeURIComponent(e)).replace(":item_id",encodeURIComponent(i))+"?type="+encodeURIComponent(t),(n=authModule.get_user_token())&&!1!==n?(s=await httpModule.req({method:"POST",url:m,headers:{"Content-Type":"application/json","x-access-token":n},timeout:3e4}))&&200===s.status?(c=i,u=t,p=e,(h=document.getElementById(c))?(h.classList.remove("suppress-item"),h.classList.add("publish-item"),(g=document.createElement("span")).id="publish-"+c,g.setAttribute("title","Unpublished - click to publish"),(b=document.createElement("i")).className="fa fa-cloud-upload",b.style.color="darkred",b.setAttribute("aria-hidden","true"),g.appendChild(b),g.appendChild(document.createElement("br")),g.appendChild(document.createTextNode("Unpublished")),h.textContent="",h.appendChild(g),C(c,u,p,!1)):console.error("Status element not found for UUID: "+c),!0):(window.scrollTo({top:0,behavior:"smooth"}),d=document.querySelector("#message"),w(d,"danger","You do not have permission to unpublish this record."),!1):(o=document.querySelector("#message"),w(o,"danger","Session expired. Please log in again."),!1);throw new Error("Suppress endpoint not configured")}catch(e){console.error("Error suppressing item:",e);var l=document.querySelector("#message"),m=e.user_message||e.message||"Unable to unpublish item. Please try again.";return w(l,"danger",m),!1}var c,u,p,h,g,b}function C(r,a,n,o){var s=document.getElementById(r+"-item-actions");if(s){var d=document.createElement("div");d.className="card-text text-sm-center";let e="";let t=null,i="item";var l=encodeURIComponent(n),m=encodeURIComponent(r);switch(a){case"heading":i="heading",e=o?y+`/items/heading/details?exhibit_id=${l}&item_id=`+m:y+`/items/heading/edit?exhibit_id=${l}&item_id=`+m;break;case"text":e=o?y+`/items/standard/text/details?exhibit_id=${l}&item_id=`+m:y+`/items/standard/text/edit?exhibit_id=${l}&item_id=`+m;break;case"grid":i="grid",e=o?y+`/items/grid/details?exhibit_id=${l}&item_id=`+m:y+`/items/grid/edit?exhibit_id=${l}&item_id=`+m;var c=y+`/items/grid/items?exhibit_id=${l}&grid_id=`+m,c=((t=document.createElement("a")).href=c,t.setAttribute("title","View grid items"),t.setAttribute("aria-label","view-grid-items"),document.createElement("i"));c.className="fa fa-list pr-1",c.setAttribute("aria-hidden","true"),t.appendChild(c);break;case"timeline":i="timeline",e=o?y+`/items/vertical-timeline/details?exhibit_id=${l}&item_id=`+m:y+`/items/vertical-timeline/edit?exhibit_id=${l}&item_id=`+m;c=y+`/items/timeline/items?exhibit_id=${l}&timeline_id=`+m,c=((t=document.createElement("a")).href=c,t.setAttribute("title","View timeline items"),t.setAttribute("aria-label","view-timeline-items"),document.createElement("i"));c.className="fa fa-list pr-1",c.setAttribute("aria-hidden","true"),t.appendChild(c);break;default:e=o?y+`/items/standard/media/details?exhibit_id=${l}&item_id=`+m:y+`/items/standard/media/edit?exhibit_id=${l}&item_id=`+m}n=y+`/items/delete?exhibit_id=${l}&item_id=${m}&type=`+encodeURIComponent(i),t&&(d.appendChild(t),d.appendChild(document.createTextNode(" ")));var r=document.createElement("a"),a=(r.href=e,r.setAttribute("title",o?"View details":"Edit item"),r.setAttribute("aria-label",o?"view-item-details":"edit-item"),document.createElement("i"));a.className=o?"fa fa-folder-open pr-1":"fa fa-edit pr-1",a.setAttribute("aria-hidden","true"),r.appendChild(a),d.appendChild(r),d.appendChild(document.createTextNode(" ")),o?((a=document.createElement("i")).className="fa fa-trash pr-1",a.setAttribute("title","Can only delete if unpublished"),a.setAttribute("aria-label","delete-disabled"),a.style.color="#d3d3d3",a.setAttribute("aria-hidden","true"),d.appendChild(a)):((r=document.createElement("a")).href=n,r.setAttribute("title","Delete item"),r.setAttribute("aria-label","delete-item"),(a=document.createElement("i")).className="fa fa-trash pr-1",a.setAttribute("aria-hidden","true"),r.appendChild(a),d.appendChild(r)),s.textContent="",s.appendChild(d)}}return f.get_items=async function(e){try{if(!e||"string"!=typeof e)throw new Error("Invalid exhibit UUID");var t=_();if(!t?.exhibits?.item_records?.endpoint)throw new Error("Item records endpoint not configured");var i=authModule.get_user_token();if(!i||!1===i)return n=document.querySelector("#message"),w(n,"danger","Session expired. Please log in again."),!1;var r=t.exhibits.item_records.endpoint.replace(":exhibit_id",encodeURIComponent(e)),a=await httpModule.req({method:"GET",url:r,headers:{"Content-Type":"application/json","x-access-token":i},timeout:3e4});if(!a||200!==a.status)throw new Error("Failed to retrieve items");if(a.data?.data)return(e=>{try{window.localStorage.removeItem("items"),window.localStorage.setItem("items",JSON.stringify(e))}catch(e){return console.error("Error saving items to localStorage:",e)}})(a.data.data),a.data.data;throw new Error("Invalid response structure")}catch(e){console.error("Error getting items:",e);var n=document.querySelector("#message"),t=e.user_message||e.message||"Unable to retrieve items. Please try again.";return w(n,"danger",t),!1}},f.display_items=async function(){try{var e=helperModule.get_parameter_by_name("exhibit_id");if(!e)return b=document.querySelector("#message"),w(b,"warning","No exhibit ID provided"),!1;var i,r,a,n,o=await f.get_items(e);if(!1===o)return(_=document.querySelector("#item-card"))&&(_.textContent=""),!1;if(!o||0===o.length)return(i=document.querySelector(".card"))&&(i.textContent=""),r=document.querySelector("#message"),(a=document.createElement("div")).className="alert alert-info",a.setAttribute("role","alert"),(n=document.createElement("span")).id="exhibit-title",a.appendChild(n),a.appendChild(document.createTextNode(" exhibit is empty.")),r.textContent="",r.appendChild(a),await exhibitsModule.set_exhibit_title(e),!1;let t="";for(let e=0;e<o.length;e++){var s=o[e].type,d=o[e];switch(s){case"heading":t+=await itemsListDisplayModule.display_heading_items(d);break;case"item":t+=await itemsListDisplayModule.display_standard_items(d);break;case"grid":t+=await itemsListDisplayModule.display_grids(d);break;case"vertical_timeline":t+=await itemsListDisplayModule.display_timelines(d);break;default:console.warn("Unknown item type: "+s)}}var l=document.querySelector("#item-data"),m=(l&&(l.innerHTML=t),document.querySelector("#items"));m&&DataTable.isDataTable("#items")&&new DataTable("#items").destroy();new DataTable("#items",{paging:!1,rowReorder:!0}).on("row-reordered",async(e,t)=>{await helperModule.reorder_items(e,t)});var c,u,p=document.querySelector("#items tbody"),h=(p&&(p._publishSuppressHandler&&p.removeEventListener("click",p._publishSuppressHandler),c=async e=>{var t=e.target.closest(".publish-item, .suppress-item");t&&(e.preventDefault(),(e=t.getAttribute("id"))?t.classList.contains("publish-item")?await x(e):t.classList.contains("suppress-item")&&await v(e):console.warn("Publish/suppress button missing ID"))},p._publishSuppressHandler=c,p.addEventListener("click",c)),helperModule.get_parameter_by_name("id")),g=helperModule.get_parameter_by_name("type");return h&&g&&(u=y+"/exhibits?exhibit_id="+encodeURIComponent(e),window.history.replaceState({},"",u),window.history.pushState({},"",u),window.location.href=`#${h}_`+g),!0}catch(e){console.error("Error displaying items:",e);var b=document.querySelector("#message"),_=e.user_message||e.message||"Unable to display items. Please try again.";return w(b,"danger",_),!1}},f.delete_item=async function(){try{var i=document.querySelector("#delete-message");i&&(i.textContent="Deleting item...");let t=helperModule.get_parameter_by_name("exhibit_id");var e=helperModule.get_parameter_by_name("item_id"),r=helperModule.get_parameter_by_name("type");if(!t||!e||!r)throw new Error("Missing required parameters for delete operation");var a,n,o,s,d,l,m=_();if(m?.exhibits?.item_records?.delete?.endpoint)return(a=authModule.get_user_token())&&!1!==a?(o=m.exhibits.item_records.delete.endpoint.replace(":exhibit_id",encodeURIComponent(t)).replace(":item_id",encodeURIComponent(e))+"?type="+encodeURIComponent(r),(s=await httpModule.req({method:"DELETE",url:o,headers:{"Content-Type":"application/json","x-access-token":a},timeout:3e4}))&&204===s.status?(setTimeout(()=>{var e=y+"/items?exhibit_id="+encodeURIComponent(t);window.location.replace(e)},900),!0):(window.scrollTo({top:0,behavior:"smooth"}),(d=document.querySelector("#delete-card"))&&(d.textContent=""),l=document.querySelector("#message"),w(l,"danger","You do not have permission to delete this record."),!1)):(n=document.querySelector("#message"),w(n,"danger","Session expired. Please log in again."),!1);throw new Error("Delete endpoint not configured")}catch(e){console.error("Error deleting item:",e);i=document.querySelector("#message"),m=e.user_message||e.message||"Unable to delete item. Please try again.";return w(i,"danger",m),!1}},f.init=async function(){try{let t=helperModule.get_parameter_by_name("exhibit_id");"403"===helperModule.get_parameter_by_name("status")&&(r=document.querySelector("#message"),w(r,"danger","You do not have permission to add item."),setTimeout(()=>{var e=y+"/items?exhibit_id="+encodeURIComponent(t);window.history.replaceState({page:"items"},"",e)},0));var i=authModule.get_user_token();await authModule.check_auth(i),exhibitsModule.set_exhibit_title(t),await f.display_items(),helperModule.show_form(),navModule.set_preview_link(),navModule.set_item_nav_menu_links(),navModule.set_logout_link(),console.log("Items module initialized")}catch(e){console.error("Error initializing items module:",e);var r=document.querySelector("#message"),i=e.message||"Unable to initialize items module";w(r,"danger",i)}},f})();