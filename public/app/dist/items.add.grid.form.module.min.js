let itemsAddGridFormModule=(()=>{let u=window.localStorage.getItem("exhibits_app_path"),m=endpointsModule.get_exhibits_endpoints(),h={};function _(e,t,r){var i,o;e&&(t=["info","success","danger","warning"].includes(t)?t:"info",(i=document.createElement("div")).className="alert alert-"+t,i.setAttribute("role","alert"),(o=document.createElement("i")).className={info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"}[t]||"fa fa-info",i.appendChild(o),t=document.createTextNode(" "+r),i.appendChild(t),e.textContent="",e.appendChild(i))}return h.create_grid_record=async function(){if(this._is_creating_grid)return!1;this._is_creating_grid=!0;try{let t=document.querySelector("#message");window.scrollTo({top:0,behavior:"smooth"});var e=helperModule.get_parameter_by_name("exhibit_id");if(e){_(t,"info","Creating grid record...");var r=authModule.get_user_token();if(r&&!1!==r){var i=itemsCommonStandardGridFormModule.get_common_grid_form_fields();if(i&&!1!==i){var o=helperModule.get_user_name(),a=helperModule.get_owner(),n=(o&&(i.created_by=o),a&&(i.owner=a),(e=>{if(m?.exhibits?.grid_records?.post?.endpoint)return m.exhibits.grid_records.post.endpoint.replace(":exhibit_id",encodeURIComponent(e));throw new Error("API endpoint configuration missing")})(e)),d=await(async(e,t,r)=>{if(httpModule?.req)return e=await httpModule.req({method:"POST",url:e,data:t,headers:{"Content-Type":"application/json","x-access-token":r}});throw new Error("HTTP module not available")})(n,i,r);if(d&&201===d.status){var s=d.data?.data;if(!s)throw new Error("Server did not return a valid grid ID");window.scrollTo({top:0,behavior:"smooth"}),_(t,"success","Grid record created successfully");var c=e,l=s;try{((e,t)=>{var r;window.history?.pushState&&(r=new URLSearchParams({exhibit_id:e,item_id:t}),r=u+"/items/grid/edit?"+r.toString(),window.history.pushState({mode:"edit",exhibit_id:e,item_id:t,type:"grid"},"",r))})(c,l),(e=>{document.title&&(document.title=e);var t=document.querySelector("h1, .page-title");t&&(t.textContent=e)})("Edit Grid"),await("function"==typeof display_edit_record?!await display_edit_record():"function"!=typeof display_grid_edit_record||!await display_grid_edit_record()),(()=>{var e=document.querySelector("form#grid-form, form");e&&(e.onsubmit=async function(e){return e.preventDefault(),!(!h.update_grid_record||"function"!=typeof h.update_grid_record)&&h.update_grid_record()},e=e.querySelector('input[name="mode"]'))&&(e.value="edit")})(),(()=>{var e=document.querySelector('button[type="submit"], #submit-button, #grid-submit-button'),t=(e&&((t=e.querySelector(".button-text"))?t.textContent="Update Grid":e.querySelector("i")?e.childNodes.forEach(e=>{e.nodeType===Node.TEXT_NODE&&(e.textContent=" Update Grid")}):e.textContent="Update Grid"),document.querySelectorAll('.edit-only, [data-mode="edit"]'));t.forEach(e=>{e.style.display="",e.classList.remove("hidden")}),(e=document.querySelectorAll('.create-only, [data-mode="create"]')).forEach(e=>{e.style.display="none",e.classList.add("hidden")}),(e=document.querySelector("#created, .metadata-section"))&&(e.style.display="block",e.classList.remove("hidden")),(e=document.querySelector("#grid-items, .grid-items-section"))&&(e.style.display="block",e.classList.remove("hidden"))})()}catch(e){console.error("Error transitioning to grid edit mode:",e),((e,t)=>{e=new URLSearchParams({exhibit_id:e,item_id:t}),t=u+"/items/grid/edit?"+e.toString(),window.location.replace(t)})(c,l)}return await 0,setTimeout(()=>{var e;(e=t)&&(e.style.transition="opacity 0.3s ease-out",e.style.opacity="0",setTimeout(()=>{e.textContent="",e.style.opacity="1"},300))},3e3),!0}if(d)throw new Error("Unexpected response from server");_(t,"danger","Permission denied. You do not have access to add items to this exhibit.")}else _(t,"danger","Invalid form data. Please check all required fields.")}else _(t,"danger","Session expired. Please log in again."),setTimeout(()=>{authModule.logout()},1e3)}else _(t,"warning","Missing exhibit ID. Cannot create grid record.");return!1}catch(e){return console.error("Error creating grid record:",e),_(document.querySelector("#message"),"danger",(e=>{var t={NetworkError:"Network connection error. Please check your internet connection.",TimeoutError:"Request timed out. Please try again.",AbortError:"Request was cancelled. Please try again."};if(e.name&&t[e.name])return t[e.name];if(e.response?.status){t=e.response.status;if(401===t||403===t)return"Permission denied. You do not have access to create items in this exhibit.";if(404===t)return"Exhibit not found.";if(422===t)return"Invalid data submitted. Please check your inputs.";if(500<=t)return"Server error. Please try again later."}return"Unable to create grid record. Please try again."})(e)),!1}finally{this._is_creating_grid=!1}},h.init=async function(){var e=helperModule.get_parameter_by_name("exhibit_id");await authModule.check_permissions(["add_item","add_item_to_any_exhibit"],"grid",e,null,"/items?exhibit_id="+e+"&status=403"),exhibitsModule.set_exhibit_title(e),document.querySelector("#save-item-btn").addEventListener("click",itemsAddGridFormModule.create_grid_record)},h})();