let itemsEditGridItemFormModule=(()=>{window.localStorage.getItem("exhibits_app_path");let p=endpointsModule.get_exhibits_endpoints();var e={};async function a(){try{var t=await(async()=>{var e,t,r,a=document.querySelector("#message"),i=(e,t,r)=>{var a,i;e&&(t=["info","success","danger","warning"].includes(t)?t:"danger",(a=document.createElement("div")).className="alert alert-"+t,a.setAttribute("role","alert"),(i=document.createElement("i")).className=(e=>{const t={info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"};return t[e]||"fa fa-exclamation"})(t),a.appendChild(i),t=document.createTextNode(" "+r),a.appendChild(t),e.textContent="",e.appendChild(a))};try{var o=helperModule.get_parameter_by_name("exhibit_id"),d=helperModule.get_parameter_by_name("grid_id"),l=helperModule.get_parameter_by_name("item_id"),n=(t=d,r=l,(e=o)&&t&&r?255<e.length||255<t.length||255<r.length?{valid:!1,error:"Invalid parameter length"}:{valid:!0}:{valid:!1,error:"Missing required parameters: exhibit_id, grid_id, or item_id"});if(!n.valid)return i(a,"danger",n.error),null;var u=authModule.get_user_token();if(!u||!1===u)return i(a,"danger","Authentication required. Redirecting..."),setTimeout(()=>{authModule.redirect_to_auth()},1e3),null;var c=authModule.get_user_profile_data();if(!c?.uid)return i(a,"danger","Invalid user profile data"),null;if(!p?.exhibits?.grid_item_record?.get?.endpoint)return i(a,"danger","API endpoint configuration missing"),null;var m=p.exhibits.grid_item_record.get.endpoint.replace(":exhibit_id",encodeURIComponent(o)).replace(":grid_id",encodeURIComponent(d)).replace(":item_id",encodeURIComponent(l))+"?"+new URLSearchParams({type:"edit",uid:c.uid}).toString(),s=await httpModule.req({method:"GET",url:m,headers:{"Content-Type":"application/json","x-access-token":u},timeout:3e4});if(console.log("RESPONSE ",s),!s)throw new Error("No response received from server");if(200!==s.status)throw new Error("Server returned status "+s.status);if(s.data?.data)return s.data.data;throw new Error("Invalid response structure")}catch(e){return console.error("Error in get_grid_item_record:",e),i(a,"danger",e.user_message||"Unable to load the grid item record. Please try again."),null}})(),r=t.is_published,a=t.created_by,i=new Date(t.created),o=t.updated_by,d=t.updated,l=new Date(d);let e="";var n=helperModule.format_date(i),u=helperModule.format_date(l),c=(helperModule.check_if_locked(t,"#item-submit-card"),null!==a&&(e+=`<em>Created by ${a} on ${n}</em>`),null!==o&&(e+=` | <em>Last updated by ${o} on ${u}</em>`),document.querySelector("#created").innerHTML=e,null!==document.querySelector("#is-published")&&1===r?document.querySelector("#is-published").value=!0:null!==document.querySelector("#is-published")&&0===r&&(document.querySelector("#is-published").value=!1),document.querySelector("#item-title-input").value=helperModule.unescape(t.title),document.querySelector("#item-text-input").value=helperModule.unescape(t.text),-1!==window.location.pathname.indexOf("media")&&await helperMediaModule.display_media_fields_common(t),document.getElementsByName("layout"));for(let e=0;e<c.length;e++)c[e].value===t.layout&&(document.querySelector("#"+c[e].id).checked=!0);var m=document.getElementsByName("media_width");for(let e=0;e<m.length;e++)parseInt(m[e].value)===parseInt(t.media_width)&&(document.querySelector("#"+m[e].id).checked=!0);var s=JSON.parse(t.styles);if(0!==Object.keys(s).length){void 0!==s.backgroundColor?(document.querySelector("#item-background-color").value=s.backgroundColor,document.querySelector("#item-background-color-picker").value=s.backgroundColor):document.querySelector("#item-background-color").value="",void 0!==s.color?(document.querySelector("#item-font-color").value=s.color,document.querySelector("#item-font-color-picker").value=s.color):document.querySelector("#item-font-color").value="";var _=document.querySelector("#item-font");for(let e=0;e<_.length;e++)_[e].value===s.fontFamily&&(document.querySelector("#item-font").value=s.fontFamily);void 0!==s.fontSize?document.querySelector("#item-font-size").value=s.fontSize.replace("px",""):document.querySelector("#item-font-size").value=""}return!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}return e.update_grid_item_record=async function(){try{window.scrollTo(0,0);var e=helperModule.get_parameter_by_name("exhibit_id"),t=helperModule.get_parameter_by_name("grid_id"),r=helperModule.get_parameter_by_name("item_id");if(void 0===e||void 0===t||void 0===r)return!(document.querySelector("#message").innerHTML='<div class="alert alert-warning" role="alert"><i class="fa fa-info"></i> Unable to update grid item record.</div>');document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Updating grid item record...</div>';var a=itemsCommonGridItemFormModule.get_common_grid_item_form_fields();if(void 0===a)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get form field values</div>');if(!1===a)return!1;a.updated_by=helperModule.get_user_name();var i=p.exhibits.grid_item_records.put.endpoint.replace(":exhibit_id",e).replace(":grid_id",t).replace(":item_id",r),o=authModule.get_user_token(),d=await httpModule.req({method:"PUT",url:i,data:a,headers:{"Content-Type":"application/json","x-access-token":o}});void 0!==d&&201===d.status&&(document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Grid item record updated</div>',setTimeout(()=>{window.location.reload()},900))}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.init=async function(){try{var e=helperModule.get_parameter_by_name("exhibit_id"),t=helperModule.get_parameter_by_name("item_id"),r="/items/grid/details?exhibit_id="+e+"&item_id="+t+"&status=403";await authModule.check_permissions(["update_item","update_any_item"],"grid_item",e,t,r),exhibitsModule.set_exhibit_title(e),navModule.back_to_grid_items(),await a(),document.querySelector("#save-item-btn").addEventListener("click",itemsEditGridItemFormModule.update_grid_item_record),-1!==window.location.pathname.indexOf("media")&&helperMediaModule.media_edit_init()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e})();