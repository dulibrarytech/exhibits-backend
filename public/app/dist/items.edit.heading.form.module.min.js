let itemsEditHeadingFormModule=(()=>{let m=window.localStorage.getItem("exhibits_app_path"),p=endpointsModule.get_exhibits_endpoints();var e={};let l={};async function c(){try{var e,t=await(async()=>{var t=document.querySelector("#message");try{var r=helperModule.get_parameter_by_name("exhibit_id"),a=helperModule.get_parameter_by_name("item_id");if(!r||!a)throw new Error("Missing required parameters: exhibit_id or item_id");var e=authModule.get_user_token(),n=authModule.get_user_profile_data();if(!e||!1===e)return t&&(t.textContent="Authentication required. Redirecting to login..."),setTimeout(()=>{var e=m+"/login";window.location.replace(e)},1e3),null;if(!n?.uid)throw new Error("Invalid user profile data");var o=p.exhibits.heading_records.get.endpoint.replace(":exhibit_id",encodeURIComponent(r)).replace(":heading_id",encodeURIComponent(a)),i=o+"?"+new URLSearchParams({type:"edit",uid:n.uid}).toString(),d=await httpModule.req({method:"GET",url:i,headers:{"Content-Type":"application/json","x-access-token":e}});if(!d)throw new Error("No response received from server");if(200!==d.status)throw new Error("Server returned status "+d.status);if(d.data?.data)return d.data.data;throw new Error("Invalid response structure")}catch(e){return console.error("Error in get_item_heading_record:",e),t&&((r=document.createElement("div")).className="alert alert-danger",r.setAttribute("role","alert"),(a=document.createElement("i")).className="fa fa-exclamation",r.appendChild(a),o=document.createTextNode(" Unable to load the heading record. Please try again."),r.appendChild(o),t.textContent="",t.appendChild(r)),null}})();if(t)return e={created:document.querySelector("#created"),heading_text_input:document.querySelector("#item-heading-text-input"),is_published:document.querySelector("#is-published"),background_color:document.querySelector("#heading-background-color"),background_color_picker:document.querySelector("#heading-background-color-picker"),font_color:document.querySelector("#heading-font-color"),font_color_picker:document.querySelector("#heading-font-color-picker"),font_size:document.querySelector("#heading-font-size"),font_family:document.querySelector("#heading-font")},helperModule.check_if_locked(t,"#item-submit-card"),i=t,(d=e.created)&&i&&(l=[],i.created_by&&i.created&&_(c=new Date(i.created))&&(c=helperModule.format_date(c),(u=document.createElement("em")).textContent=`Created by ${i.created_by} on `+c,l.push(u)),i.updated_by&&i.updated&&_(c=new Date(i.updated))&&(u=helperModule.format_date(c),(s=document.createElement("em")).textContent=`Last updated by ${i.updated_by} on `+u,l.push(s)),d.textContent="",l.forEach((e,t)=>{0<t&&d.appendChild(document.createTextNode(" | ")),d.appendChild(e)})),n=t.text,(o=e.heading_text_input)&&(n=n?helperModule.unescape(n):"",o.value=n),r=t.is_published,(a=e.is_published)&&(a.checked=[1,!0,"1","true"].includes(r)),((t,r)=>{if(t){let e;try{e="string"==typeof t?JSON.parse(t):t}catch(e){return console.error("Failed to parse styles JSON:",e)}e&&"object"==typeof e&&0!==Object.keys(e).length&&(h(e.backgroundColor,r.background_color,r.background_color_picker),h(e.color,r.font_color,r.font_color_picker),((e,t)=>{t&&(e?(e=String(e).replace(/px$/i,"").trim(),t.value=e):t.value="")})(e.fontSize,r.font_size),((e,r)=>{if(e&&r){let t=String(e).trim();Array.from(r.options).some(e=>e.value===t)&&(r.value=t)}})(e.fontFamily,r.font_family))}})(t.styles,e),!1;throw new Error("Failed to load record data")}catch(e){return console.error("Error in display_edit_record:",e),i="Unable to display the record. Please try again.",(o=document.querySelector("#message"))&&((n=document.createElement("div")).className="alert alert-danger",n.setAttribute("role","alert"),(a=document.createElement("i")).className="fa fa-exclamation",n.appendChild(a),a=document.createTextNode(" "+i),n.appendChild(a),o.textContent="",o.appendChild(n)),!1}var r,a,n,o,i,d,l,c,u,s}function h(e,t,r){e&&((e=String(e).trim())&&t&&(t.value=e),e)&&r&&(r.value=e)}function _(e){return e instanceof Date&&!isNaN(e.getTime())}function u(e,t,r){var a,n;e&&(t=["info","success","danger","warning"].includes(t)?t:"info",(a=document.createElement("div")).className="alert alert-"+t,a.setAttribute("role","alert"),(n=document.createElement("i")).className={info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"}[t]||"fa fa-info",a.appendChild(n),t=document.createTextNode(" "+r),a.appendChild(t),e.textContent="",e.appendChild(a))}return e.update_item_heading_record=async function(){if(this._is_updating)return!1;this._is_updating=!0;try{let t=document.querySelector("#message");window.scrollTo({top:0,behavior:"smooth"}),u(t,"info","Updating heading record...");var e=helperModule.get_parameter_by_name("exhibit_id"),r=helperModule.get_parameter_by_name("item_id");if(!e||!r)return u(t,"danger","Missing required record identifiers"),!1;var a=authModule.get_user_token();if(!a||!1===a)return u(t,"danger","Session expired. Redirecting to login..."),setTimeout(()=>{authModule.logout()},1e3),!1;var n=itemsCommonHeadingFormModule.get_common_heading_form_fields(l);if(!n||!1===n)return u(t,"danger","Invalid form data. Please check all required fields."),!1;var o=helperModule.get_user_name(),i=(o&&(n.updated_by=o),((e,t)=>{if(p?.exhibits?.heading_records?.put?.endpoint)return p.exhibits.heading_records.put.endpoint.replace(":exhibit_id",encodeURIComponent(e)).replace(":heading_id",encodeURIComponent(t));throw new Error("API endpoint configuration missing")})(e,r)),d=await(async(e,t,r)=>{if(httpModule?.req)return e=await httpModule.req({method:"PUT",url:e,data:t,headers:{"Content-Type":"application/json","x-access-token":r}});throw new Error("HTTP module not available")})(i,n,a);if(d&&201===d.status){u(t,"success","Heading record updated successfully");try{await c(),(()=>{void 0!==l&&l&&l.setDirty&&"function"==typeof l.setDirty&&l.setDirty(!1);let e=document.querySelector('#item-submit-card button[type="submit"]');e&&(e.disabled=!0,setTimeout(()=>{e.disabled=!1},1e3)),window.onbeforeunload=null})()}catch(e){console.error("Error refreshing display:",e)}return await 0,setTimeout(()=>{var e;(e=t)&&(e.style.transition="opacity 0.3s ease-out",e.style.opacity="0",setTimeout(()=>{e.textContent="",e.style.opacity="1"},300))},3e3),!0}throw new Error("Unexpected response from server")}catch(e){return console.error("Error updating heading record:",e),u(document.querySelector("#message"),"danger",(e=>{var t={NetworkError:"Network connection error. Please check your internet connection.",TimeoutError:"Request timed out. Please try again.",AbortError:"Request was cancelled. Please try again."};if(e.name&&t[e.name])return t[e.name];if(e.response?.status){t=e.response.status;if(401===t||403===t)return"Authentication failed. Please log in again.";if(404===t)return"Record not found.";if(422===t)return"Invalid data submitted. Please check your inputs.";if(500<=t)return"Server error. Please try again later."}return"Unable to update heading record. Please try again."})(e)),!1}finally{this._is_updating=!1}},e.init=async function(){try{var e=helperModule.get_parameter_by_name("exhibit_id"),t=helperModule.get_parameter_by_name("item_id"),r="/items/heading/details?exhibit_id="+e+"&item_id="+t+"&status=403";await authModule.check_permissions(["update_item","update_any_item"],"heading",e,t,r),await exhibitsModule.set_exhibit_title(e),document.querySelector("#save-heading-btn").addEventListener("click",await itemsEditHeadingFormModule.update_item_heading_record),await c()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e})();