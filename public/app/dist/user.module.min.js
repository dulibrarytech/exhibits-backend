let userModule=(()=>{let _=window.localStorage.getItem("exhibits_app_path"),g=endpointsModule.get_users_endpoints(),u="#message";var e={};async function y(){try{var e,t,r=helperModule.get_parameter_by_name("user_id");return null===r?!1:(e=authModule.get_user_token(),200===(t=await httpModule.req({method:"GET",url:g.users.get_user.endpoint.replace(":user_id",r),headers:{"Content-Type":"application/json","x-access-token":e}})).status?t.data:void 0)}catch(e){document.querySelector(u).innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}async function h(e){try{var t=authModule.get_user_token(),r=await httpModule.req({method:"GET",url:"/exhibits-dashboard/auth/role?user_id="+e,headers:{"Content-Type":"application/json","x-access-token":t}});if(200===r.status)return r.data[0]}catch(e){document.querySelector(u).innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}function o(){try{var t,r,a={first_name:"#first-name-input",last_name:"#last-name-input",email:"#email-input",du_id:"#du-id-input",role_id:"#user-roles"},s={};let e=!0;for([t,r]of Object.entries(a)){var i,o,l=document.querySelector(r);l?(i=l.value||"",(o=((e,t)=>(e=document.querySelector(`#${e}-error`),t&&0!==t.trim().length?(e&&(e.innerHTML=""),t.trim()):(e&&(e.innerHTML='<span style="color: red"><i class="fa fa-exclamation-circle"></i> Please enter a value</span>'),!1)))(r.replace("#",""),i))||0===o?s[t]=o:e=!1):(console.error("Element not found: "+r),e=!1)}return e?s:null}catch(e){return console.error("Error retrieving form data:",e),null}}async function f(e){var t=authModule.get_user_token();200===(await httpModule.req({method:"PUT",url:g.users.user_status.endpoint.replace(":id",e).replace(":is_active","1"),headers:{"Content-Type":"application/json","x-access-token":t}})).status&&(t=document.getElementById(e),document.getElementById(e).classList.remove("active-user"),document.getElementById(e).classList.add("inactive-user"),document.getElementById(e).replaceWith(t.cloneNode(!0)),document.getElementById(e).innerHTML='<span id="suppress" title="published"><i class="fa fa-user" style="color: green"></i><br>Active</span>',document.getElementById(e).addEventListener("click",async()=>{await p(e)},!1),document.getElementById(e+"-user-actions").innerHTML=`
                        <div class="card-text text-sm-center">
                        <i title="Only administrators can view user details" style="color: #d3d3d3" class="fa fa-edit pr-1"></i>&nbsp;
                        <i title="Only administrators can delete users" style="color: #d3d3d3" class="fa fa-trash pr-1" aria-label="delete-user"></i>
                        </div>`)}async function p(t){var e,r,a=authModule.get_user_token();200===(await httpModule.req({method:"PUT",url:g.users.user_status.endpoint.replace(":id",t).replace(":is_active","0"),headers:{"Content-Type":"application/json","x-access-token":a}})).status&&(a=document.getElementById(t),document.getElementById(t).classList.remove("inactive-user"),document.getElementById(t).classList.add("active-user"),document.getElementById(t).replaceWith(a.cloneNode(!0)),document.getElementById(t).innerHTML='<span id="publish" title="suppressed"><i class="fa fa-user" style="color: darkred"></i><br>Inactive</span>',document.getElementById(t).addEventListener("click",async e=>{await f(t)},!1),a=document.getElementById(t+"-user-actions"),e=`<a href="${_}/users/edit?user_id=${t}" title="View user details" aria-label="user-details"><i class="fa fa-edit pr-1"></i></a>`,r=`<a href="${_}/users/delete?user_id=${t}" title="Delete User" aria-label="delete-user"><i class="fa fa-trash pr-1"></i></a>`,a.innerHTML=`
                        <div class="card-text text-sm-center">
                        ${e}&nbsp;
                        ${r}
                        </div>`)}async function c(){try{var e=e=>{var t=document.querySelector(u);t&&(t.innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e}</div>`)};if(authModule&&httpModule){var r=authModule.get_user_token();if(r&&!1!==r){var t=await httpModule.req({method:"GET",url:"/exhibits-dashboard/auth/roles",headers:{"Content-Type":"application/json","x-access-token":r},timeout:1e4});if(t&&"object"==typeof t){if(200===t.status)return t.data?Array.isArray(t.data)?t.data:(console.error("Invalid roles data format - expected array"),e("Invalid server response format."),null):(console.warn("No roles data in response"),[]);401===t.status||403===t.status?(console.warn("Authorization failed with status "+t.status),e("You do not have permission to access roles."),401===t.status&&setTimeout(()=>{authModule.logout()},2e3)):404===t.status?(console.warn("Roles endpoint not found"),e("Roles service not available.")):(console.error("Unexpected response status: "+t.status),e(t.data?.message||"Failed to retrieve roles."))}else console.error("Invalid response from server"),e("Server communication error.")}else console.warn("No authentication token available"),e("Session expired. Please log in again."),setTimeout(()=>{authModule.logout()},2e3)}else console.error("Required modules are not available"),e("System configuration error.");return null}catch(t){console.error("Error in get_roles:",t.message);r=document.querySelector(u);if(r){let e="An error occurred while retrieving roles.";t.message.includes("timeout")?e="Request timeout. Please try again.":t.message.includes("network")?e="Network error. Please check your connection.":(t.message.includes("401")||t.message.includes("unauthorized"))&&(e="Session expired. Please log in again.",setTimeout(()=>{authModule.logout()},2e3)),r.innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e}</div>`}return null}}return e.display_user_records=async function(){let o={message_selector:"#message",user_data_selector:"#user-data",add_user_selector:"#add-user",card_selector:".card",user_table_selector:"#users",app_path:_},l={active:{value:1,icon:"fa-user",color:"green",label:"Active",title:"active",class_name:"inactive-user"},inactive:{value:0,icon:"fa-user",color:"darkred",label:"Inactive",title:"inactive",class_name:"active-user"}},a=new Map;function s(e){return a.has(e)||a.set(e,document.querySelector(e)),a.get(e)}function i(e,t="danger"){var r=s(o.message_selector);r&&(r.innerHTML=`
            <div class="alert alert-${t}" role="alert">
                <i class="fa fa-${"danger"===t?"exclamation":"info"}"></i> ${e}
            </div>
        `)}function n(e,t,r){var a,s,i,t=t&&parseInt(t.uid)===e.id,t=(s=e,t=t,a=r,i=l[1===s.is_active?"active":"inactive"],t?`
                <span id="${i.title}" title="${i.title}">
                    <i class="fa ${i.icon}" style="color: ${i.color}"></i>
                    <br>${i.label}
                </span>
            `:a&&1===s.is_active?`
                <a href="#" id="${s.id}" class="inactive-user" role="button" aria-label="Deactivate user">
                    <span id="${i.title}" title="${i.title}">
                        <i class="fa ${i.icon}" style="color: ${i.color}"></i>
                        <br>${i.label}
                    </span>
                </a>
            `:a&&0===s.is_active?`
                <a href="#" id="${s.id}" class="active-user" role="button" aria-label="Activate user">
                    <span id="${i.title}" title="${i.title}">
                        <i class="fa ${i.icon}" style="color: ${i.color}"></i>
                        <br>${i.label}
                    </span>
                </a>
            `:`
            <span id="${i.title}" title="${i.title}">
                <i class="fa ${i.icon}" style="color: ${i.color}"></i>
                <br>${i.label}
            </span>
        `),r=(a=e,i=(s=r)&&0===a.is_active,s=r&&0===a.is_active,(i?`<a href="${o.app_path}/users/edit?user_id=${a.id}" title="Edit" aria-label="edit-user"><i class="fa fa-edit pr-1"></i></a>`:'<i title="Can only edit if inactive" style="color: #d3d3d3" class="fa fa-edit pr-1" aria-disabled="true"></i>')+"&nbsp;"+(s?`<a href="${o.app_path}/users/delete?user_id=${a.id}" title="Delete" aria-label="delete-user"><i class="fa fa-trash pr-1"></i></a>`:'<i title="Can only delete if inactive" style="color: #d3d3d3" class="fa fa-trash pr-1" aria-disabled="true"></i>'));return`
            <tr style="height: 10%">
                <td style="width: 35%; padding-left: 7%">
                    <small>${e.first_name} ${e.last_name}</small>
                </td>
                <td style="width: 15%; text-align: center">
                    <small>${e.role}</small>
                </td>
                <td style="width: 5%; text-align: center">
                    <small>${t}</small>
                </td>
                <td id="${e.id}-user-actions" style="width: 10%">
                    <div class="card-text text-sm-center">${r}</div>
                </td>
            </tr>
        `}try{a.clear();var e=await(async()=>{try{var e=authModule.get_user_token(),t=await httpModule.req({method:"GET",url:g.users.endpoint,headers:{"Content-Type":"application/json","x-access-token":e}});return void 0!==t&&200===t.status?t.data:void 0!==t&&void 0}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})();if(!e||!1===e)return void await(s(o.add_user_selector).style.display="none",i("You do not have permission to view users.","danger"),!1);if(!Array.isArray(e)||0===e.length)return void await(s(o.card_selector).innerHTML="",i("No User Profiles found.","info"),!1);let t=(()=>{try{var e=sessionStorage.getItem("exhibits_user");return e?JSON.parse(e):(i("Unable to get your user id","danger"),null)}catch(e){return console.error("Failed to parse user data:",e),i("Unable to parse user data","danger"),null}})();if(!t)return void await!1;m=t,v=e;let r=m&&v.some(e=>parseInt(m.uid)===e.id&&"Administrator"===e.role);var d=e.map(e=>n(e,t,r)).join(""),u=s(o.user_data_selector);return void await(u&&(u.innerHTML=d),(c=s(o.user_table_selector))?"undefined"==typeof DataTable?console.warn("DataTable library not loaded"):((c=new DataTable(c,{paging:!0,order:[[0,"asc"]]})).on("click","tbody tr .inactive-user",async e=>{e.preventDefault();e=e.currentTarget.getAttribute("id");e&&await p(e)}),c.on("click","tbody tr .active-user",async e=>{e.preventDefault();e=e.currentTarget.getAttribute("id");e&&await f(e)})):console.warn("User table element not found"),"undefined"!=typeof helperModule&&helperModule.show_form&&helperModule.show_form(),!0)}catch(e){return void await(console.error("Error displaying user records:",e),i(e.message||"An error occurred while loading users","danger"),!1)}var c,m,v},e.display_user_record=async function(){let s={message_selector:"#message",selectors:{edit_form:"#user-form",view_only_form:"#user-form-view-only",save_btn:"#save-user-btn",first_name:"#first-name-input",last_name:"#last-name-input",email:"#email-input",du_id:"#du-id-input",user_roles:"#user-roles",first_name_disabled:"#first-name-disabled",last_name_disabled:"#last-name-disabled",email_disabled:"#email-disabled",du_id_disabled:"#du-id-disabled",role_disabled:"#role-disabled"}},r=new Map;function a(e){var t;return r.has(e)||((t=document.querySelector(e))||console.warn("Element not found: "+e),r.set(e,t)),r.get(e)}function i(e,t){e=a(e);e&&(e.value=t||"")}function o(e,t=!0){e=a(e);e&&(t?e.setAttribute("disabled",""):e.removeAttribute("disabled"))}function l(e,t=!0){e=a(e);e&&(e.style.display=t?"block":"none")}function t(e){var t=a(s.message_selector);t&&(t.innerHTML=`
                <div class="alert alert-danger" role="alert">
                    <i class="fa fa-exclamation"></i> ${e}
                </div>
            `)}function e(e,t,r){var a;"view_only"===e.form_type?(a=t,r=r,i(s.selectors.first_name_disabled,a.first_name),i(s.selectors.last_name_disabled,a.last_name),i(s.selectors.email_disabled,a.email),i(s.selectors.du_id_disabled,a.du_id),i(s.selectors.role_disabled,r.role),l(s.selectors.edit_form,!1),l(s.selectors.view_only_form,!0),l(s.selectors.save_btn,!1)):(a=t,i(s.selectors.first_name,a.first_name),i(s.selectors.last_name,a.last_name),i(s.selectors.email,a.email),i(s.selectors.du_id,a.du_id),l(s.selectors.edit_form,!0),l(s.selectors.view_only_form,!1),l(s.selectors.save_btn,!0),e.can_disable_fields?(o(s.selectors.du_id,!0),o(s.selectors.user_roles,!0)):(o(s.selectors.du_id,!1),o(s.selectors.user_roles,!1)))}try{r.clear();var n,d,u,c,m=authModule.get_user_profile_data();return void await(m&&m.uid?(n=await y())&&Array.isArray(n)&&0!==n.length?(d=n[n.length-1])?(u=await h(d.id),c=await h(m.uid),u?c?(void 0!==userModule&&userModule.list_roles&&await userModule.list_roles(u),v=m,f=d,p="Administrator"===(p=c).role,v=parseInt(v.uid)===parseInt(f.id),e(p&&v||p&&!v?{can_edit:!0,can_disable_fields:!1,form_type:"editable"}:!p&&v?{can_edit:!0,can_disable_fields:!0,form_type:"editable"}:{can_edit:!1,can_disable_fields:!1,form_type:"view_only"},d,u),!0):(t("Unable to retrieve profile role"),!1):(t("Unable to retrieve user role"),!1)):(t("User record is empty"),!1):(t("Unable to retrieve user record"),setTimeout(()=>{window.location.replace(_+"/users")},1e3),!1):(t("Unable to retrieve profile data"),!1))}catch(e){return void await(console.error("Error displaying user record:",e),t(e.message||"An error occurred while loading the user record"),!1)}var v,f,p},e.display_user=async function(e){return y()},e.update_user_record=async function(e){try{window.scrollTo(0,0),e.preventDefault();var t,r,a=helperModule.get_parameter_by_name("user_id"),s=o(),i=authModule.get_user_token();if(void 0===a)return!(document.querySelector(u).innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get user ID</div>');if(!1===i)setTimeout(()=>{document.querySelector(u).innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get session token</div>',authModule.logout()},1e3);else{if(void 0===s)return!(document.querySelector(u).innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get form field values</div>');null!==s&&(document.querySelector(u).innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Updating user record...</div>',t=g.users.update_user.put.endpoint.replace(":user_id",a),void 0!==(r=await httpModule.req({method:"PUT",url:t,data:s,headers:{"Content-Type":"application/json","x-access-token":i}})))&&201===r.status&&(document.querySelector(u).innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> User record updated</div>',setTimeout(()=>{window.location.reload()},900))}return!1}catch(e){document.querySelector(u).innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.save_user_record=async function(r){try{r?.preventDefault(),window.scrollTo(0,0);var t=(e,t="danger")=>{var r=document.querySelector(u);r&&(r.innerHTML=`<div class="alert alert-${t}" role="alert"><i class="fa fa-${"success"===t?"check":"info"===t?"info":"exclamation"}"></i> ${e}</div>`)};if(authModule&&httpModule){var e=authModule.get_user_token();if(e&&!1!==e){var a=o();if(void 0===a)t("Unable to retrieve form field values.");else if(null!==a&&!1!==a)if("object"!=typeof a)t("Invalid form data format.");else if(t("Saving user record...","info"),g?.users?.endpoint){var s=g.users.endpoint,i=await httpModule.req({method:"POST",url:s,data:a,headers:{"Content-Type":"application/json","x-access-token":e},timeout:1e4});if(i&&"object"==typeof i){if(201===i.status){if(!i.data||!i.data.user||!i.data.user.data.id)return console.error("Invalid user data in response"),t("User saved but unable to retrieve user ID."),!1;let e=i.data.user.data.id;return!Number.isInteger(e)||e<=0?(console.error("Invalid user ID in response:",e),t("User saved but invalid user ID received."),!1):(t("User record saved successfully.","success"),setTimeout(()=>{window.location.replace(_+"/users/edit?user_id="+e)},900),!0)}200===i.status?t(i.data?.message||"User already exists."):401===i.status||403===i.status?(t("You do not have permission to create users."),setTimeout(()=>{authModule.logout()},2e3)):400===i.status?t(i.data?.message||"Invalid user data provided."):(console.error("Unexpected response status: "+i.status),t(i.data?.message||"Failed to save user record."))}else console.error("Invalid response from server"),t("Server communication error.")}else console.error("User endpoint not configured"),t("System configuration error.")}else t("Session expired. Redirecting to login..."),setTimeout(()=>{authModule.logout()},1e3)}else console.error("Required modules are not available"),t("System configuration error.");return!1}catch(t){console.error("Error in save_user_record:",t.message);r=document.querySelector(u);if(r){let e="An error occurred while saving user record.";t.message.includes("timeout")?e="Request timeout. Please try again.":t.message.includes("network")?e="Network error. Please check your connection.":(t.message.includes("401")||t.message.includes("unauthorized"))&&(e="Session expired. Please log in again.",setTimeout(()=>{authModule.logout()},2e3)),r.innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e}</div>`}return!1}},e.delete_user=async function(){try{var e=(e,t="danger",r=u)=>{r=document.querySelector(r);r&&(r.innerHTML="loading"===t?'<i class="fa fa-spinner fa-spin"></i> '+e:`<div class="alert alert-${t}" role="alert"><i class="fa fa-exclamation"></i> ${e}</div>`)};if(e("Deleting user...","loading","#delete-message"),helperModule&&authModule&&httpModule){var r=helperModule.get_parameter_by_name("user_id");if(r){var t=Number(r);if(!Number.isInteger(t)||t<=0)console.warn("Invalid user_id format: "+r),e("Invalid user ID format.","danger","#exhibit-no-delete");else{var a=authModule.get_user_token();if(a&&!1!==a)if(g?.users?.delete_user?.delete?.endpoint){var s=g.users.delete_user.delete.endpoint.replace(":user_id",t),i=await httpModule.req({method:"DELETE",url:s,headers:{"Content-Type":"application/json","x-access-token":a},timeout:1e4});if(i&&"object"==typeof i){if(204===i.status)return document.querySelector("#delete-card").innerHTML="",e("User deleted successfully.","success","#message"),setTimeout(()=>{window.location.replace(_+"/users")},900),!0;401===i.status||403===i.status?(e(i.data?.message||"You do not have permission to delete users.","danger","#exhibit-no-delete"),401===i.status&&setTimeout(()=>{authModule.logout()},2e3)):404===i.status?e(i.data?.message||"User not found.","danger","#exhibit-no-delete"):409===i.status?e(i.data?.message||"User cannot be deleted due to existing dependencies.","danger","#exhibit-no-delete"):(console.error("Unexpected response status: "+i.status),e(i.data?.message||"Failed to delete user.","danger","#exhibit-no-delete"))}else console.error("Invalid response from server"),e("Server communication error.","danger","#exhibit-no-delete")}else console.error("Delete user endpoint not configured"),e("System configuration error.");else console.warn("No authentication token available"),e("Session expired. Please log in again."),setTimeout(()=>{authModule.logout()},2e3)}}else console.warn("Missing user_id parameter"),e("Invalid user ID.","danger","#exhibit-no-delete")}else console.error("Required modules are not available"),e("System configuration error.");return!1}catch(t){console.error("Error in delete_user:",t.message);r=document.querySelector(u);if(r){let e="An error occurred while deleting user.";t.message.includes("timeout")?e="Request timeout. Please try again.":t.message.includes("network")?e="Network error. Please check your connection.":(t.message.includes("401")||t.message.includes("unauthorized"))&&(e="Session expired. Please log in again.",setTimeout(()=>{authModule.logout()},2e3)),r.innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e}</div>`}return!1}},e.user_status_manager=async function(e,t){let u={active:{is_active:1,remove_class:"active-user",add_class:"inactive-user",icon:"fa-user",color:"green",label:"Active",title:"active",span_id:"suppress",next_action:"deactivate",show_edit_delete:!1},inactive:{is_active:0,remove_class:"inactive-user",add_class:"active-user",icon:"fa-user",color:"darkred",label:"Inactive",title:"inactive",span_id:"publish",next_action:"activate",show_edit_delete:!0}},c=new Map;function m(e){var t;return c.has(e)||((t=document.getElementById(e))||console.warn(`Element with id "${e}" not found in DOM`),c.set(e,t)),c.get(e)}function v(e,t){var r=m(e+"-user-actions");r&&(e=e,t=t?`<a href="${_}/users/edit?user_id=${e}" title="View user details" aria-label="user-details"><i class="fa fa-edit pr-1"></i></a>`+"&nbsp;"+`<a href="${_}/users/delete?user_id=${e}" title="Delete User" aria-label="delete-user"><i class="fa fa-trash pr-1"></i></a>`:'<i title="Only administrators can view user details" style="color: #d3d3d3" class="fa fa-edit pr-1"></i>&nbsp;<i title="Only administrators can delete users" style="color: #d3d3d3" class="fa fa-trash pr-1" aria-label="delete-user"></i>',r.innerHTML=`<div class="card-text text-sm-center">${t}</div>`)}async function r(t,r){try{var e,a=u[r];if(a)return await(async(t,e)=>{try{var r,a=authModule.get_user_token();if(a)return r=g.users.user_status.endpoint.replace(":id",t).replace(":is_active",e),200===(await httpModule.req({method:"PUT",url:r,headers:{"Content-Type":"application/json","x-access-token":a}}))?.status;throw new Error("Authentication token not available")}catch(e){return console.error(`Failed to update user ${t} status:`,e),!1}})(t,a.is_active)?((e=m(t))&&(e.classList.remove(a.remove_class),e.classList.add(a.add_class),d=a,(n=e)&&(n.innerHTML=`
            <span id="${d.span_id}" title="${d.title}">
                <i class="fa ${d.icon}" style="color: ${d.color}"></i>
                <br>${d.label}
            </span>
        `),s=e,i=t,o=a.next_action,s)&&(l=s.cloneNode(!1),s.parentNode&&s.parentNode.replaceChild(l,s),l.addEventListener("click",async e=>{e.preventDefault(),"deactivate"===o?await p(i):"activate"===o&&await f(i)}),c.set(i,l)),v(t,a.show_edit_delete),!0):(console.error(`Failed to ${r} user `+t),!1);throw new Error("Invalid status: "+r)}catch(e){return console.error(`Error updating user ${t} to ${r}:`,e),!1}var s,i,o,l,n,d}async function f(e){return r(e,"active")}async function p(e){return r(e,"inactive")}"activate"===e?await f(t):"deactivate"===e&&await p(t)},e.list_roles=async function(t){try{var r=e=>{var t=document.querySelector(u);t&&(t.innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e}</div>`)},a=await c();if(null===a)return console.error("Failed to retrieve roles"),r("Unable to load roles. Please refresh the page."),!1;if(!Array.isArray(a))return console.error("Invalid roles data format"),r("Invalid roles data received."),!1;var s=document.querySelector("#user-roles");if(!s)return console.error("User roles select element not found"),r("Form element not found."),!1;let e=null;null!=t&&"object"==typeof t&&(e=Number(t.role_id),!Number.isInteger(e)||e<=0)&&(console.warn("Invalid role_id in role parameter"),e=null);var i,o,l,n=[{value:"",text:"Select From Menu",selected:!1},{value:"",text:"----------",disabled:!0,selected:!1}];for(i of a)i&&"object"==typeof i&&i.id&&i.role?(o=Number(i.id),!Number.isInteger(o)||o<=0?console.warn("Invalid role ID:",i.id):(l=(e=>{var t;return"string"!=typeof e?String(e):((t=document.createElement("div")).textContent=e,t.innerHTML)})(i.role),n.push({value:o,text:l,selected:e===o}))):console.warn("Invalid role item structure:",i);var d=n.map(e=>`<option ${""!==e.value?`value="${e.value}"`:'value=""'}${e.selected?" selected":""}${e.disabled?" disabled":""}>${e.text}</option>`).join("");return s.innerHTML=d,!0}catch(e){console.error("Error in list_roles:",e.message);r=document.querySelector(u);return r&&(r.innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> An error occurred while loading roles.</div>'),!1}},e.check_add_user_permission=async function(){try{var e,t,r=e=>{var t=document.querySelector(u);t&&(t.innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e}</div>`)};return authModule?(e=authModule.get_user_profile_data())?e.uid&&"string"==typeof e.uid?(a=await h(e.uid))?"object"==typeof a&&a.role?"string"!=typeof a.role?(console.warn("Role is not a string"),!1):((t="administrator"===a.role.trim().toLowerCase())||console.debug("User does not have add user permission. Role: "+a.role),t):(console.warn("Invalid role data structure"),r("Invalid role data."),!1):(console.warn("No role data found for user: "+e.uid),r("Unable to verify user permissions."),!1):(console.warn("Invalid user profile structure"),r("Invalid user profile data."),!1):(console.warn("No user profile found"),r("User profile not found. Please log in again."),authModule.redirect_to_auth(),!1):(console.error("authModule is not available"),r("System configuration error."),!1)}catch(e){console.error("Error in check_add_user_permission:",e.message);var a=document.querySelector(u);return a&&(a.innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> An error occurred while checking permissions.</div>'),!1}},e.init=async function(){await userModule.list_roles()},e})();