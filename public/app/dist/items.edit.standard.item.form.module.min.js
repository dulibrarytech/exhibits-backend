let itemsEditStandardItemFormModule=(()=>{let c=window.localStorage.getItem("exhibits_app_path");var e={};async function r(){try{let o=await(async()=>{try{var e,t=endpointsModule.get_exhibits_endpoints(),a=helperModule.get_parameter_by_name("exhibit_id"),i=helperModule.get_parameter_by_name("item_id"),r=authModule.get_user_token(),o=authModule.get_user_profile_data(),d=t.exhibits.item_records.get.endpoint.replace(":exhibit_id",a).replace(":item_id",i);return!1===r?(document.querySelector("#message").innerHTML="ERROR: Unable to get API endpoints",setTimeout(()=>{window.location.replace(c+"/exhibits-dashboard/auth")},1e3),!1):void 0!==(e=await httpModule.req({method:"GET",url:d+"?type=edit&uid="+o.uid,headers:{"Content-Type":"application/json","x-access-token":r}}))&&200===e.status?e.data.data[0]:void 0}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})();if(o){var e=window.location.pathname.includes("media");let r=(e,t)=>{e=document.querySelector(e);e&&(e.value=t)};var t,a=helperModule.format_date(new Date(o.created)),i=helperModule.format_date(new Date(o.updated)),d=[],l=(o.created_by&&d.push(`<em>Created by ${o.created_by} on ${a}</em>`),o.updated_by&&d.push(`<em>Last updated by ${o.updated_by} on ${i}</em>`),document.querySelector("#created")),n=(l&&(l.innerHTML=d.join(" | ")),helperModule.check_if_locked(o,"#exhibit-submit-card"),document.querySelector("#is-published")),s=(n&&(n.value=1===o.is_published),r("#item-title-input",helperModule.unescape(o.title)),r("#item-text-input",helperModule.unescape(o.text)),e&&(await helperMediaModule.display_media_fields_common(o),null!==o.item_subjects&&0<o.item_subjects?.length?(t=o.item_subjects.split("|"),await helperModule.create_subjects_menu(t)):await helperModule.create_subjects_menu()),(e,t)=>{var a;for(a of document.getElementsByName(e))if(a.value===t){((e,t)=>{e=document.querySelector(e);e&&(e.checked=!!t)})("#"+a.id,!0);break}});s("layout",o.layout),s("media_width",String(o.media_width));(()=>{let e={};try{e=JSON.parse(o.styles||"{}")}catch(e){return console.error("Invalid styles JSON:",e.message)}if(0!==Object.keys(e).length){var a,i,t;for([a,i]of Object.entries({backgroundColor:["#item-background-color","#item-background-color-picker"],color:["#item-font-color","#item-font-color-picker"]})){let t=e[a]||"";i.forEach(e=>r(e,t))}e.fontFamily&&r("#item-font",e.fontFamily),e.fontSize?(t=e.fontSize.replace(/px$/,""),r("#item-font-size",t)):r("#item-font-size","")}})()}else console.error("No record returned from get_item_record()");return!1}catch(e){return console.error("Error in display_edit_record:",e.message),document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`,!1}}return e.update_item_record=async function(){try{scrollTo(0,0);var e=endpointsModule.get_exhibits_endpoints(),t=helperModule.get_parameter_by_name("exhibit_id"),a=helperModule.get_parameter_by_name("item_id"),i=itemsCommonStandardItemFormModule.get_common_standard_item_form_fields(),r=authModule.get_user_token();if(void 0===t||void 0===a)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get record ID</div>');if(!1===r)return setTimeout(()=>{document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get session token</div>',authModule.logout()},1e3),!1;if(void 0===i)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get form field values</div>');if(!1===i)return!1;i.updated_by=helperModule.get_user_name(),document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Updating item record...</div>';var o,d=e.exhibits.item_records.put.endpoint.replace(":exhibit_id",t).replace(":item_id",a);void 0!==(o=await httpModule.req({method:"PUT",url:d,data:i,headers:{"Content-Type":"application/json","x-access-token":r}}))&&201===o.status&&(document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Item record updated</div>',setTimeout(()=>{window.location.reload()},900))}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.init=async function(){try{var t=helperModule.get_parameter_by_name("exhibit_id"),a=helperModule.get_parameter_by_name("item_id");let e="media";var i="/items/standard/"+(e=window.location.pathname.indexOf("text")?"text":e)+"/details?exhibit_id="+t+"&item_id="+a+"&status=403";await authModule.check_permissions(["update_item","update_any_item"],"item",t,a,i),exhibitsModule.set_exhibit_title(t),await r(),document.querySelector("#update-item-btn").addEventListener("click",itemsEditStandardItemFormModule.update_item_record),-1!==window.location.pathname.indexOf("media")&&helperMediaModule.media_edit_init()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e})();