let itemsAddHeadingFormModule=(()=>{let u=window.localStorage.getItem("exhibits_app_path"),m=endpointsModule.get_exhibits_endpoints(),h={};function g(e,t,i){var r,a;e&&(t=["info","success","danger","warning"].includes(t)?t:"info",(r=document.createElement("div")).className="alert alert-"+t,r.setAttribute("role","alert"),(a=document.createElement("i")).className={info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"}[t]||"fa fa-info",r.appendChild(a),t=document.createTextNode(" "+i),r.appendChild(t),e.textContent="",e.appendChild(r))}return h.create_heading_record=async function(){if(this._is_creating)return!1;this._is_creating=!0;try{let t=document.querySelector("#message");window.scrollTo({top:0,behavior:"smooth"});var e=helperModule.get_parameter_by_name("exhibit_id");if(e){g(t,"info","Creating item heading record...");var i=authModule.get_user_token();if(i&&!1!==i){var r=itemsCommonHeadingFormModule.get_common_heading_form_fields();if(r&&!1!==r){var a=helperModule.get_user_name(),n=helperModule.get_owner(),o=(a&&(r.created_by=a),n&&(r.owner=n),(e=>{if(m?.exhibits?.heading_records?.post?.endpoint)return m.exhibits.heading_records.post.endpoint.replace(":exhibit_id",encodeURIComponent(e));throw new Error("API endpoint configuration missing")})(e)),d=await(async(e,t,i)=>{if(httpModule?.req)return e=await httpModule.req({method:"POST",url:e,data:t,headers:{"Content-Type":"application/json","x-access-token":i}});throw new Error("HTTP module not available")})(o,r,i);if(d&&201===d.status){var s=d.data?.data;if(!s)throw new Error("Server did not return a valid item ID");g(t,"success","Heading record created successfully");var c=e,l=s;try{((e,t)=>{var i;window.history?.pushState&&(i=new URLSearchParams({exhibit_id:e,item_id:t}),i=u+"/items/heading/edit?"+i.toString(),window.history.pushState({mode:"edit",exhibit_id:e,item_id:t},"",i))})(c,l),(e=>{document.title&&(document.title=e);var t=document.querySelector("h1, .page-title");t&&(t.textContent=e)})("Edit Heading"),await("function"!=typeof display_edit_record||!await display_edit_record()),(()=>{var e=document.querySelector("form#heading-form, form");e&&(e.onsubmit,e.onsubmit=async function(e){return e.preventDefault(),!(!h.update_item_heading_record||"function"!=typeof h.update_item_heading_record)&&h.update_item_heading_record()},e=e.querySelector('input[name="mode"]'))&&(e.value="edit")})(),(()=>{var e=document.querySelector('button[type="submit"], #submit-button'),t=(e&&((t=e.querySelector(".button-text"))?t.textContent="Update Heading":e.textContent="Update Heading"),document.querySelectorAll('.edit-only, [data-mode="edit"]'));t.forEach(e=>{e.style.display="",e.classList.remove("hidden")}),(e=document.querySelectorAll('.create-only, [data-mode="create"]')).forEach(e=>{e.style.display="none",e.classList.add("hidden")}),(e=document.querySelector("#created"))&&(e.style.display="block")})()}catch(e){console.error("Error transitioning to edit mode:",e),((e,t)=>{e=new URLSearchParams({exhibit_id:e,item_id:t}),t=u+"/items/heading/edit?"+e.toString(),window.location.replace(t)})(c,l)}return await 0,setTimeout(()=>{var e;(e=t)&&(e.style.transition="opacity 0.3s ease-out",e.style.opacity="0",setTimeout(()=>{e.textContent="",e.style.opacity="1"},300))},3e3),!0}if(d)throw new Error("Unexpected response from server");g(t,"danger","Permission denied. You do not have access to add items to this exhibit.")}else g(t,"danger","Invalid form data. Please check all required fields.")}else g(t,"danger","Session expired. Please log in again."),setTimeout(()=>{authModule.logout()},1e3)}else g(t,"warning","Missing exhibit ID. Cannot create heading record.");return!1}catch(e){return console.error("Error creating heading record:",e),g(document.querySelector("#message"),"danger",(e=>{var t={NetworkError:"Network connection error. Please check your internet connection.",TimeoutError:"Request timed out. Please try again.",AbortError:"Request was cancelled. Please try again."};if(e.name&&t[e.name])return t[e.name];if(e.response?.status){t=e.response.status;if(401===t||403===t)return"Permission denied. You do not have access to create items in this exhibit.";if(404===t)return"Exhibit not found.";if(422===t)return"Invalid data submitted. Please check your inputs.";if(500<=t)return"Server error. Please try again later."}return"Unable to create heading record. Please try again."})(e)),!1}finally{this._is_creating=!1}},h.init=async function(){var e=helperModule.get_parameter_by_name("exhibit_id");await authModule.check_permissions(["add_item","add_item_to_any_exhibit"],"heading",e,null,"/items?exhibit_id="+e+"&status=403"),exhibitsModule.set_exhibit_title(e),document.querySelector("#save-heading-btn").addEventListener("click",itemsAddHeadingFormModule.create_heading_record)},h})();