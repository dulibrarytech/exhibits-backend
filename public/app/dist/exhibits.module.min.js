let exhibitsModule=(()=>{let m=window.localStorage.getItem("exhibits_app_path");var e={};let i;async function b(){try{var t=endpointsModule.get_exhibits_endpoints();if(!t?.exhibits?.exhibit_records?.endpoint)throw new Error("Exhibits endpoint configuration not available");var i=authModule.get_user_token();if(!i||"string"!=typeof i)throw new Error("Authentication token not available");var a=await httpModule.req({method:"GET",url:t.exhibits.exhibit_records.endpoint,headers:{"Content-Type":"application/json","x-access-token":i},timeout:3e4});if(a&&200===a.status)return a.data&&Array.isArray(a.data.data)?a.data.data:(console.warn("Unexpected response data structure:",a.data),[]);if(a)throw new Error("Request failed with status "+a.status)}catch(e){console.error("Error fetching exhibits:",e),t=e.message,(i=document.querySelector("#message"))?(i.textContent="",(a=document.createElement("div")).className="alert alert-danger",a.setAttribute("role","alert"),a.setAttribute("aria-live","polite"),a.setAttribute("aria-atomic","true"),(n=document.createElement("i")).className="fa fa-exclamation",n.setAttribute("aria-hidden","true"),a.appendChild(n),a.appendChild(document.createTextNode(" ")),n=document.createTextNode(t),a.appendChild(n),i.appendChild(a)):console.error("Message element #message not found in DOM")}var n}function f(e,t){var i=document.createElement("td"),t=(i.style.width="4%",i.className="item-order",i.setAttribute("aria-label",t),document.createElement("span")),e=(t.style.paddingLeft="4px",new Date(e)),e=helperModule.format_date(e);return t.textContent=e,i.appendChild(t),i}function x(e,t,i,a){var n=document.createElement("i");return n.className=e,t&&n.setAttribute("title",t),i?n.setAttribute("aria-label",i):n.setAttribute("aria-hidden","true"),a&&(n.style.color=a),n}function _(e,t,i,a){var n=document.createElement("a");return n.href=e,t&&n.setAttribute("title",t),i&&n.setAttribute("aria-label",i),a&&(e=x(a,"","",""),n.appendChild(e),n.appendChild(document.createTextNode(" "))),n}e.display_exhibits=async function(){try{var t=await b();if(!1===t)return(d=document.querySelector("#exhibit-card"))&&(d.textContent=""),!1;if(void 0===t)return authModule.redirect_to_auth(),!1;if(!t||0===t.length)return(p=document.querySelector(".card"))&&(p.textContent=""),(e=document.querySelector("#message"))?(e.textContent="",(u=document.createElement("div")).className="alert alert-info",u.setAttribute("role","status"),u.setAttribute("aria-live","polite"),u.setAttribute("aria-atomic","true"),h=document.createTextNode("No Exhibits found."),u.appendChild(h),e.appendChild(u)):console.warn("Message element not found"),!1;var i=document.querySelector("#exhibits-data");if(!i)throw new Error("Table body element #exhibits-data not found");i.textContent="";var a=document.createDocumentFragment();for(let e=0;e<t.length;e++){s=t[e],c=void 0,(c=document.createElement("tr")).id=s.uuid,c.appendChild((e=>{var t=document.createElement("td"),i=(t.style.width="35%",(e=>{var t=document.createElement("p"),i=document.createElement("strong"),a=helperModule.strip_html(helperModule.unescape(e.title));return i.textContent=a,t.appendChild(i),1===e.is_featured&&(t.appendChild(document.createTextNode("  ")),a=x("fa fa-star","Featured","featured exhibit","#BA8E23"),t.appendChild(a)),1===e.is_locked&&(t.appendChild(document.createTextNode("  ")),i=x("fa fa-lock","Record is currently locked","exhibit-is-locked","#BA8E23"),t.appendChild(i)),t})(e)),i=(t.appendChild(i),(e=>{let t=document.createElement("p"),i=document.createElement("img"),a=m+"/static/images/image-tn.png",n;return n=e.thumbnail&&0<e.thumbnail.length?`${m}/api/v1/exhibits/${encodeURIComponent(e.uuid)}/media/`+encodeURIComponent(e.thumbnail):a,i.src=n,i.alt=e.uuid+" thumbnail",i.height=100,i.width=100,i.addEventListener("error",function(){this.src!==a&&(console.warn(`Thumbnail failed to load for exhibit ${e.uuid}, using default image`),this.src=a)}),t.appendChild(i),t})(e)),i=(t.appendChild(i),(e=>{let t=document.createElement("div"),i=(t.className="d-flex justify-content-between align-items-center",document.createElement("div")),a=(i.className="btn-group",document.createElement("span")),n=(a.id="preview-link",document.createElement("button")),r=(n.type="button",n.className="btn btn-sm btn-outline-secondary",n.setAttribute("aria-label","Preview exhibit"),document.createElement("i")),o=(r.className="menu-icon fa fa-eye",r.setAttribute("aria-hidden","true"),n.appendChild(r),n.appendChild(document.createTextNode(" ")),document.createElement("small")),d=(o.textContent="Preview",n.appendChild(o),m+"/preview?uuid="+encodeURIComponent(e.uuid)),l=(n.addEventListener("click",()=>{exhibitsModule.open_preview(d)}),a.appendChild(n),i.appendChild(a),i.appendChild(document.createTextNode("  ")),document.createElement("span")),s=(l.id="share-link",document.createElement("button")),c=(s.type="button",s.className="btn btn-sm btn-outline-secondary",s.setAttribute("aria-label","Share exhibit"),s.setAttribute("data-toggle","modal"),s.setAttribute("data-target",".shared-url-modal"),document.createElement("i")),u=(c.className="fa fa-share-alt",c.setAttribute("aria-hidden","true"),s.appendChild(c),s.appendChild(document.createTextNode(" ")),document.createElement("small"));return u.textContent="Share",s.appendChild(u),s.addEventListener("click",()=>{exhibitsModule.create_shared_preview_url(e.uuid)}),l.appendChild(s),i.appendChild(l),t.appendChild(i),t})(e)),i=(t.appendChild(i),(e=>{var t=document.createElement("p"),i=document.createElement("span"),a=(i.style.fontSize="x-small",document.createElement("em"));return a.textContent="Exhibit created by "+e,i.appendChild(a),t.appendChild(i),t})(e.created_by));return t.appendChild(i),t})(s)),c.appendChild((e=>{var t=document.createElement("td"),i=(t.style.width="5%",t.style.textAlign="center",document.createElement("small")),e=((e,t)=>{var i=document.createElement("a"),e=(i.href="#",i.id=e+"-status",i.setAttribute("aria-label","Toggle publication status"),document.createElement("span"));return 1===t?(i.className="suppress-exhibit",e.id="suppress",e.setAttribute("title","published"),(t=document.createElement("i")).className="fa fa-cloud",t.style.color="green",t.setAttribute("aria-hidden","true"),e.appendChild(t),e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode("Published"))):(i.className="publish-exhibit",e.id="publish",e.setAttribute("title","suppressed"),(t=document.createElement("i")).className="fa fa-cloud-upload",t.style.color="darkred",t.setAttribute("aria-hidden","true"),e.appendChild(t),e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode("Unpublished"))),i.appendChild(e),i})(e.uuid,e.is_published);return i.appendChild(e),t.appendChild(i),t})(s)),c.appendChild((e=>{var t=document.createElement("td"),i=(t.style.width="10%",document.createElement("div")),a=(i.className="card-text text-sm-center",i.id=e.uuid+"-actions",_(m+"/items?exhibit_id="+encodeURIComponent(e.uuid),"View Exhibit Items","view-exhibit-items","fa fa-list"));return a.classList.add("pr-1"),i.appendChild(a),i.appendChild(document.createTextNode(" ")),1===e.is_published?((a=_(m+"/exhibits/exhibit/details?exhibit_id="+encodeURIComponent(e.uuid),"View details","exhibit-details","fa fa-folder-open")).classList.add("pr-1"),i.appendChild(a),i.appendChild(document.createTextNode(" ")),(a=document.createElement("i")).className="fa fa-trash pr-1",a.setAttribute("title","Can only delete if unpublished"),a.setAttribute("aria-label","delete-exhibit"),a.style.color="#d3d3d3",i.appendChild(a)):((a=_(m+"/exhibits/exhibit/edit?exhibit_id="+encodeURIComponent(e.uuid),"Edit","edit-exhibit","fa fa-edit")).classList.add("pr-1"),i.appendChild(a),i.appendChild(document.createTextNode(" ")),(a=_(m+"/exhibits/exhibit/delete?exhibit_id="+encodeURIComponent(e.uuid),"Delete exhibit","delete-exhibit","fa fa-trash")).classList.add("pr-1"),i.appendChild(a)),t.appendChild(i),t})(s)),c.appendChild(f(s.created,"exhibit-created")),c.appendChild(f(s.updated,"exhibit-updated"));var n=c;a.appendChild(n)}i.appendChild(a);var r=(()=>{try{if(document.querySelector("#exhibits"))return new DataTable("#exhibits",{paging:!0,order:[[4,"desc"]],rowReorder:!1,language:{bottomEnd:{paging:{firstLast:!1}}}});throw new Error("Table element #exhibits not found")}catch(e){throw console.error("Error initializing DataTable:",e),e}})();if(r)try{r.on("click","tbody tr .publish-exhibit",async e=>{e.preventDefault();e=e.currentTarget.getAttribute("id");e?await g(e):console.error("No UUID found on publish button")}),r.on("click","tbody tr .suppress-exhibit",async e=>{e.preventDefault();e=e.currentTarget.getAttribute("id");e?await v(e):console.error("No UUID found on suppress button")})}catch(e){console.error("Error binding DataTable events:",e)}else console.error("DataTable instance not provided");try{var o=helperModule.get_parameter_by_name("exhibit_id");if(null!==o&&""!==o){history.replaceState({},"",m+"/exhibits"),history.pushState({},"",m+"/exhibits");let e=document.getElementById(o);e?(e.scrollIntoView({behavior:"smooth",block:"center"}),e.style.backgroundColor="#fffacd",setTimeout(()=>{e.style.backgroundColor=""},2e3)):console.warn(`Exhibit with ID ${o} not found in DOM`)}}catch(e){console.error("Error handling exhibit_id parameter:",e)}return!0}catch(e){console.error("Error displaying exhibits:",e);var d=document.querySelector("#message");return d&&(i=d,r="danger",d="Error displaying exhibits: "+e.message,i?(i.textContent="",(l=document.createElement("div")).className="alert alert-"+r,l.setAttribute("role","alert"),l.setAttribute("aria-live","polite"),l.setAttribute("aria-atomic","true"),r=x({info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"}[r]||"fa fa-info","","",""),l.appendChild(r),l.appendChild(document.createTextNode(" ")),r=document.createTextNode(d),l.appendChild(r),i.appendChild(l)):console.error("Display message: element not found")),!1}var l,s,c,e,u,h,p},e.get_exhibit_title=async function(e){try{var t=endpointsModule.get_exhibits_endpoints(),i=authModule.get_user_token(),a=await httpModule.req({method:"GET",url:t.exhibits.exhibit_records.endpoints.get.endpoint.replace(":exhibit_id",e),headers:{"Content-Type":"application/json","x-access-token":i}});if(void 0!==a&&200===a.status)return helperModule.strip_html(helperModule.unescape(a.data.data.title))}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.set_exhibit_title=async function(e){e=await exhibitsModule.get_exhibit_title(e);return document.querySelector("#exhibit-title").innerHTML=""+e,!1},e.open_preview=function(e){scrollTo(0,0);let t=authModule.get_user_token();void 0!==i&&exhibitsModule.close_preview(),document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> Building Exhibit Preview...</div>',setTimeout(()=>{i=window.open(e+"&t="+t,"_blank","location=yes,scrollbars=yes,status=yes"),document.querySelector("#message").innerHTML=""},900)},e.close_preview=function(){i.close()},e.delete_exhibit=function(){try{(async()=>{document.querySelector("#delete-message").innerHTML="Deleting exhibit...";var e=endpointsModule.get_exhibits_endpoints(),t=helperModule.get_parameter_by_name("exhibit_id"),i=authModule.get_user_token();void 0!==(e=await httpModule.req({method:"DELETE",url:e.exhibits.exhibit_records.endpoints.delete.endpoint.replace(":exhibit_id",t),headers:{"Content-Type":"application/json","x-access-token":i}}))&&204===e.status?setTimeout(()=>{window.location.replace(m+"/exhibits")},900):void 0!==e&&200===e.status?(scrollTo(0,0),document.querySelector("#delete-card").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-warning" role="alert"><i class="fa fa-warning"></i> Cannot delete an exhibit that contains items.</div>'):void 0===e&&(scrollTo(0,0),document.querySelector("#delete-card").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> You do not have permission to delete this record.</div>')})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}return!1};let o={STATUS_SUFFIX:"-status",ACTIONS_SUFFIX:"-actions",MESSAGE_DURATION:5e3,HTTP_OK:200,HTTP_NO_CONTENT:204,UUID_PATTERN:/^[a-f0-9-]+$/i},r={PUBLISHED:{span_id:"suppress",title:"published",icon_class:"fa fa-cloud",icon_color:"green",text:"Published",css_class_to_add:"suppress-exhibit",css_class_to_remove:"publish-exhibit",click_handler:v,actions:(e,t)=>[{href:e+"/items?exhibit_id="+t,title:"View Exhibit Items",icon:"fa fa-list pr-1",label:"view-items"},{href:e+"/exhibits/exhibit/details?exhibit_id="+t,title:"View details",icon:"fa fa-folder-open pr-1",label:"exhibit-details"},{type:"disabled-trash"}]},SUPPRESSED:{span_id:"publish",title:"suppressed",icon_class:"fa fa-cloud-upload",icon_color:"darkred",text:"Unpublished",css_class_to_add:"publish-exhibit",css_class_to_remove:"suppress-exhibit",click_handler:g,actions:(e,t)=>[{href:e+"/items?exhibit_id="+t,title:"View Exhibit Items",icon:"fa fa-list pr-1",label:"view-items"},{href:e+"/exhibits/exhibit/edit?exhibit_id="+t,title:"Edit",icon:"fa fa-edit pr-1",label:"edit-exhibit"},{href:e+"/exhibits/exhibit/delete?exhibit_id="+t,title:"Delete exhibit",icon:"fa fa-trash pr-1",label:"delete-exhibit"}]}};function d(e){if(!e||"string"!=typeof e)throw new Error("Invalid exhibit UUID provided");e=e.replace(o.STATUS_SUFFIX,"");if(o.UUID_PATTERN.test(e))return e;throw new Error("Invalid UUID format")}function l(e){if(!e)throw new Error("Authentication token not available")}async function s(e,t,i){return httpModule.req({method:"POST",url:e.replace(":exhibit_id",t),headers:{"Content-Type":"application/json","x-access-token":i},validateStatus:e=>200<=e&&e<600})}function c(t,i){var e,a,n,r,o,d=document.getElementById(t);d?((e=d.cloneNode(!1)).classList.remove(i.css_class_to_remove),e.classList.add(i.css_class_to_add),(a=document.createElement("span")).id=i.span_id,a.title=i.title,(n=document.createElement("i")).className=i.icon_class,n.style.color=i.icon_color,n.setAttribute("aria-hidden","true"),r=document.createElement("br"),o=document.createTextNode(i.text),a.appendChild(n),a.appendChild(r),a.appendChild(o),e.appendChild(a),e.addEventListener("click",async e=>{e.preventDefault(),await i.click_handler(t)},{once:!1,passive:!1}),d.replaceWith(e)):console.warn("Status element not found: "+t)}function u(e,t){var i=""+e+o.ACTIONS_SUFFIX;let a=document.getElementById(i);if(a){for(;a.firstChild;)a.removeChild(a.firstChild);var e=encodeURIComponent(e),n=void 0!==m?m:"";let o=t.actions(n,e),d=[];o.forEach((e,t)=>{var i,a,n,r;"disabled-trash"===e.type?d.push(((r=document.createElement("i")).className="fa fa-trash pr-1",r.title="Can only delete if unpublished",r.style.color="#d3d3d3",r.setAttribute("aria-label","delete-exhibit"),r.setAttribute("aria-disabled","true"),r.setAttribute("aria-hidden","true"),r)):d.push((r=e.href,i=e.title,a=e.icon,e=e.label,(n=document.createElement("a")).href=r,n.title=i,n.setAttribute("aria-label",e),(r=document.createElement("i")).className=a,r.setAttribute("aria-hidden","true"),n.appendChild(r),n)),t<o.length-1&&d.push(document.createTextNode("Â "))}),d.forEach(e=>a.appendChild(e))}else console.warn("Actions element not found: "+i)}async function g(e){try{var t=d(e),i=endpointsModule.get_exhibits_endpoints(),a=authModule.get_user_token(),n=(l(a),await s(i.exhibits.exhibit_publish.post.endpoint,t,a));return n?.status===o.HTTP_OK?(c(e,r.PUBLISHED),u(t,r.PUBLISHED)):n?.status===o.HTTP_NO_CONTENT?h("warning","Exhibit must contain at least one item to publish"):n||h("danger","You do not have permission to publish this record"),!1}catch(e){return console.error("Error publishing exhibit:",e),h("danger",e.message||"An unexpected error occurred while publishing the exhibit"),!1}}async function v(e){try{var t=d(e),i=endpointsModule.get_exhibits_endpoints(),a=authModule.get_user_token(),n=(l(a),await s(i.exhibits.exhibit_suppress.post.endpoint,t,a));return n?.status===o.HTTP_OK?(c(e,r.SUPPRESSED),u(t,r.SUPPRESSED)):n||h("danger","You do not have permission to unpublish this record"),!1}catch(e){return console.error("Error suppressing exhibit:",e),h("danger",e.message||"An error occurred while suppressing exhibit"),!1}}function h(t,i,a=o.MESSAGE_DURATION){let n=document.querySelector("#message");if(n){for(window.scrollTo({top:0,behavior:"smooth"});n.firstChild;)n.removeChild(n.firstChild);let e=document.createElement("div");e.className="alert alert-"+t,e.setAttribute("role","alert");var r=document.createElement("i"),t=(r.className="warning"===t?"fa fa-warning":"fa fa-exclamation-circle",r.setAttribute("aria-hidden","true"),document.createTextNode(" "+i));e.appendChild(r),e.appendChild(t),n.appendChild(e),setTimeout(()=>{n.firstChild===e&&n.removeChild(e)},a)}else console.error("Message container not found")}return e.create_shared_preview_url=function(i){(async()=>{document.querySelector("#shared-url").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Generating Shared URL...</div>';var e=endpointsModule.get_exhibits_endpoints(),t=authModule.get_user_token();!1===t?setTimeout(()=>{document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Unable to get session token</div>',authModule.logout()},1e3):void 0!==(e=await httpModule.req({method:"POST",url:e.exhibits.exhibit_shared.get.endpoint+"?uuid="+i,headers:{"Content-Type":"application/json","x-access-token":t}}))&&201===e.status&&(document.querySelector("#shared-url-copy").innerText=e.data.shared_url,setTimeout(async()=>{document.querySelector("#shared-url").innerHTML=`<div class="d-flex align-items-center">
                                                                                    <p>
                                                                                    - Shared URL created.&nbsp;&nbsp; 
                                                                                    <button type="button" class="btn btn-sm btn-primary" onclick="exhibitsModule.copy();">
                                                                                    <i class="fa fa-copy"> Copy</i>
                                                                                    </button>
                                                                                    <br>
                                                                                    - Shared URL expires in 7 days.
                                                                                    </p>
                                                                                </div>`},900))})()},e.copy=function(){try{(async()=>{var e=document.querySelector("#shared-url-copy").textContent;await navigator.clipboard.writeText(e),document.querySelector("#copy-message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> URL copied to clipboard!</div>',setTimeout(()=>{document.querySelector("#copy-message").innerHTML=""},5e3)})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Failed to copy shared URL to clipboard. Error: ${e.message}</div>`}},e.init=async function(){try{var e=authModule.get_user_token();await authModule.check_auth(e),await exhibitsModule.display_exhibits(),helperModule.show_form(),navModule.set_logout_link()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e})();