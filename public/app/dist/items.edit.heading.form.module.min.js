let itemsEditHeadingFormModule=(()=>{let u=window.localStorage.getItem("exhibits_app_path"),c=endpointsModule.get_exhibits_endpoints();var e={};let n={};async function a(){var e=await(async()=>{try{var e,t=helperModule.get_parameter_by_name("exhibit_id"),a=helperModule.get_parameter_by_name("item_id"),r=authModule.get_user_token(),i=authModule.get_user_profile_data(),o=c.exhibits.heading_records.get.endpoint.replace(":exhibit_id",t).replace(":heading_id",a);return!1===r?(document.querySelector("#message").innerHTML="ERROR: Unable to get API endpoints",setTimeout(()=>{window.location.replace(u+"/login")},1e3),!1):void 0!==(e=await httpModule.req({method:"GET",url:o+"?type=edit&uid="+i.uid,headers:{"Content-Type":"application/json","x-access-token":r}}))&&200===e.status?e.data.data[0]:void 0}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})();let t;var a=e.is_published,r=e.created_by,i=new Date(e.created),o=e.updated_by,l=e.updated,l=new Date(l);let n="";i=helperModule.format_date(i),l=helperModule.format_date(l);if(helperModule.check_if_locked(e,"#item-submit-card"),null!==r&&(n+=`<em>Created by ${r} on ${i}</em>`),null!==o&&(n+=` | <em>Last updated by ${o} on ${l}</em>`),document.querySelector("#created").innerHTML=n,document.querySelector("#item-heading-text-input").value=helperModule.unescape(e.text),null!==document.querySelector("#is-published")&&1===a?document.querySelector("#is-published").value=!0:null!==document.querySelector("#is-published")&&0===a&&(document.querySelector("#is-published").value=!1),"string"==typeof e.styles&&(t=JSON.parse(e.styles)),0!==Object.keys(t).length){void 0!==t.backgroundColor&&0!==t.backgroundColor.length&&(document.querySelector("#heading-background-color").value=t.backgroundColor,document.querySelector("#heading-background-color-picker").value=t.backgroundColor),void 0!==t.color&&0!==t.color.length&&(document.querySelector("#heading-font-color").value=t.color,document.querySelector("#heading-font-color-picker").value=t.color),void 0!==t.fontSize?document.querySelector("#heading-font-size").value=t.fontSize.replace("px",""):document.querySelector("#heading-font-size").value="";var d=document.querySelector("#heading-font");for(let e=0;e<d.length;e++)d[e].value===t.fontFamily&&(document.querySelector("#heading-font").value=t.fontFamily)}return!1}return e.update_item_heading_record=async function(){try{scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Updating heading record...</div>';var e=helperModule.get_parameter_by_name("exhibit_id"),t=helperModule.get_parameter_by_name("item_id"),a=authModule.get_user_token(),r=itemsCommonHeadingFormModule.get_common_heading_form_fields(n);if(!1===r)return!1;if(void 0===e||void 0===t)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get record ID</div>');if(!1===a)return setTimeout(()=>{document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get session token</div>',authModule.logout()},1e3),!1;var i=JSON.parse(sessionStorage.getItem("exhibits_user"));if(null===i.name)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to retrieve your name</div>');r.updated_by=i.name;var o,l=c.exhibits.heading_records.put.endpoint.replace(":exhibit_id",e).replace(":heading_id",t);void 0!==(o=await httpModule.req({method:"PUT",url:l,data:r,headers:{"Content-Type":"application/json","x-access-token":a}}))&&201===o.status&&(document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Heading record updated</div>',setTimeout(()=>{window.location.reload()},900))}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.init=async function(){try{var e=helperModule.get_parameter_by_name("exhibit_id"),t="/items/heading/details?exhibit_id="+e+"&item_id="+helperModule.get_parameter_by_name("item_id")+"&status=403";await authModule.check_permissions(["update_item","update_any_item"],"heading_item",e,t),await exhibitsModule.set_exhibit_title(e),document.querySelector("#save-heading-btn").addEventListener("click",await itemsEditHeadingFormModule.update_item_heading_record),await a()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e})();