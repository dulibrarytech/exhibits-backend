let itemsAddStandardItemFormModule=(()=>{let x=window.localStorage.getItem("exhibits_app_path"),b=endpointsModule.get_exhibits_endpoints(),S={};return S.create_item_record=async function(){if(this._is_creating_item)return!1;this._is_creating_item=!0;let t=document.querySelector("#message");let e=300;var a=(e,t,a)=>{var i,r;e&&(t=["info","success","danger","warning"].includes(t)?t:"danger",(i=document.createElement("div")).className="alert alert-"+t,i.setAttribute("role","alert"),(r=document.createElement("i")).className=o(t),i.appendChild(r),t=document.createTextNode(" "+a),i.appendChild(t),e.style.opacity="1",e.style.transition="",e.textContent="",e.appendChild(i))};let o=e=>({info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"})[e]||"fa fa-exclamation",i=()=>-1!==window.location.pathname.indexOf("media")?"media":"text";let r=(e,t,a)=>{var i;window.history?.pushState&&(i=new URLSearchParams({exhibit_id:e,item_id:t}),i=x+`/items/standard/${a}/edit?`+i.toString(),window.history.pushState({mode:"edit",exhibit_id:e,item_id:t,item_form:a},"",i))},n=e=>{document.title&&(document.title=e);var t=document.querySelector("h1, .page-title");t&&(t.textContent=e)},d=async()=>{"function"==typeof display_edit_record&&await display_edit_record()},s=()=>{var e=document.querySelector("form#item-form, form");e&&(e.onsubmit=async function(e){return e.preventDefault(),!(!S.update_item_record||"function"!=typeof S.update_item_record)&&S.update_item_record()},e=e.querySelector('input[name="mode"]'))&&(e.value="edit")},l=()=>{var e=document.querySelector('button[type="submit"], #submit-button');e&&((t=e.querySelector(".button-text"))?t.textContent="Update Item":e.querySelector("i")?e.childNodes.forEach(e=>{e.nodeType===Node.TEXT_NODE&&(e.textContent=" Update Item")}):e.textContent="Update Item"),document.querySelectorAll('.edit-only, [data-mode="edit"]').forEach(e=>{e.style.display="",e.classList.remove("hidden")});document.querySelectorAll('.create-only, [data-mode="create"]').forEach(e=>{e.style.display="none",e.classList.add("hidden")});var t=document.querySelector("#created, .metadata-section");t&&(t.style.display="block",t.classList.remove("hidden"))},c=(e,t)=>{var a=i(),e=new URLSearchParams({exhibit_id:e,item_id:t}),t=x+`/items/standard/${a}/edit?`+e.toString();window.location.replace(t)},m=null;try{window.scrollTo({top:0,behavior:"smooth"});var u=helperModule.get_parameter_by_name("exhibit_id");if(!u)return a(t,"warning","Missing exhibit ID. Cannot create item record."),!1;var _=authModule.get_user_token();if(!_||!1===_)return a(t,"danger","Session expired. Please log in again."),m=setTimeout(()=>{authModule.logout()},1e3),!1;var f=itemsCommonStandardItemFormModule.get_common_standard_item_form_fields();if(!f||!1===f||void 0===f)return a(t,"danger","Unable to get form field values. Please check all required fields."),!1;a(t,"info","Creating item record...");var h=helperModule.get_user_name(),p=helperModule.get_owner();if(h&&(f.created_by=h),p&&(f.owner=p),!b?.exhibits?.item_records?.post?.endpoint)return a(t,"danger","API endpoint configuration missing"),!1;var y=b.exhibits.item_records.post.endpoint.replace(":exhibit_id",encodeURIComponent(u)),g=await httpModule.req({method:"POST",url:y,data:f,headers:{"Content-Type":"application/json","x-access-token":_},timeout:3e4});if(!g||201!==g.status)throw new Error("Failed to create item record");var v=g.data?.data;if(v)return a(t,"success","Item record created successfully"),await(async(t,a)=>{try{var e=i();r(t,a,e),n("Edit Item"),await d(),s(),l()}catch(e){console.error("Error transitioning to edit mode:",e),c(t,a)}})(u,v),m=setTimeout(()=>{t&&(t.style.transition=`opacity ${e}ms ease-out`,t.style.opacity="0",setTimeout(()=>{t.textContent="",t.style.opacity="1",t.style.transition=""},e))},3e3),!0;throw new Error("Server did not return a valid item ID")}catch(e){m&&clearTimeout(m),console.error("Error creating item record:",e);var w=e.user_message||e.message||"Unable to create item record. Please try again.";return a(t,"danger",w),!1}finally{this._is_creating_item=!1}},S.create_item_record__=async function(){try{window.scrollTo(0,0);let a=helperModule.get_parameter_by_name("exhibit_id");if(void 0===a)return!(document.querySelector("#message").innerHTML='<div class="alert alert-warning" role="alert"><i class="fa fa-info"></i> Unable to create item record.</div>');var e=itemsCommonStandardItemFormModule.get_common_standard_item_form_fields();if(void 0===e)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get form field values</div>');if(!1===e)return!1;document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Creating item record...</div>',e.created_by=helperModule.get_user_name(),e.owner=helperModule.get_owner();var t=authModule.get_user_token(),i=await httpModule.req({method:"POST",url:b.exhibits.item_records.post.endpoint.replace(":exhibit_id",a),data:e,headers:{"Content-Type":"application/json","x-access-token":t}});if(void 0!==i&&201===i.status){document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Item record created</div>';let t=i.data.data;setTimeout(()=>{let e="text";-1!==window.location.pathname.indexOf("media")&&(e="media"),window.location.replace(`${x}/items/standard/${e}/edit?exhibit_id=${a}&item_id=`+t)},900)}}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},S.init=async function(){try{var e=helperModule.get_parameter_by_name("exhibit_id"),t="/items?exhibit_id="+e+"&status=403";await authModule.check_permissions(["add_item","add_item_to_any_exhibit"],"item",e,null,t),exhibitsModule.set_exhibit_title(e),document.querySelector("#save-item-btn").addEventListener("click",itemsAddStandardItemFormModule.create_item_record),-1!==window.location.pathname.indexOf("media")&&await helperModule.create_subjects_menu()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},S})();