let userModule=(()=>{let d=window.localStorage.getItem("exhibits_app_path"),c=endpointsModule.get_users_endpoints();var e={};async function r(){try{var e=helperModule.get_parameter_by_name("user_id"),a=authModule.get_user_token(),t=await httpModule.req({method:"GET",url:c.users.get_user.endpoint.replace(":user_id",e),headers:{"Content-Type":"application/json","x-access-token":a}});if(200===t.status)return t.data}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}function a(e,a){return 0===a.length?!(document.querySelector("#"+e+"-error").innerHTML='<span style="color: red"><i class="fa fa-exclamation-circle"></i> Please enter a value</span>'):(document.querySelector("#"+e+"-error").innerHTML="",a)}function l(){return{first_name:a("first-name-input",document.querySelector("#first-name-input").value),last_name:a("last-name-input",document.querySelector("#last-name-input").value),email:a("email-input",document.querySelector("#email-input").value),du_id:a("du-id-input",document.querySelector("#du-id-input").value),role_id:a("user-roles",document.querySelector("#user-roles").value)}}return e.display_user_records=async function(){try{var l=await(async()=>{try{var e=authModule.get_user_token(),a=await httpModule.req({method:"GET",url:c.users.endpoint,headers:{"Content-Type":"application/json","x-access-token":e}});return void 0!==a&&200===a.status?a.data:void 0!==a&&void 0}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})();if(!1===l)return document.querySelector("#add-user").style.display="none",!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> You do not have permission to view users.</div>');let i="";if(!1===l)document.querySelector("#user-card").innerHTML="";else{if(0===l.length)return document.querySelector(".card").innerHTML="",!(document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><span id="exhibit-title"></span> No User Profiles found.</div>');let s=!1;for(let r=0;r<l.length;r++){var n=l[r].is_active;let e,a="",t="";var o=JSON.parse(window.sessionStorage.getItem("exhibits_user"));if(null===o)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get your user id</div>');parseInt(o.uid)===l[r].id&&"Administrator"===l[r].role&&(s=!0),1===n?t=(a=parseInt(o.uid)===l[r].id?(e='<span id="inactive" title="active"><i class="fa fa-user" style="color: green"></i><br>Active</span>',`<a href="${d}/users/edit?user_id=${l[r].id}" title="Edit"><i class="fa fa-edit pr-1"></i> </a>`):(e=!0===s?`<a href="#" id="${l[r].id}" class="inactive-user"><span id="inactive" title="active"><i class="fa fa-user" style="color: green"></i><br>Active</span></a>`:'<span id="inactive" title="active"><i class="fa fa-user" style="color: green"></i><br>Active</span>','<i title="Can only edit if inactive" style="color: #d3d3d3" class="fa fa-edit pr-1"></i>'),'<i title="Can only delete if inactive" style="color: #d3d3d3" class="fa fa-trash pr-1"></i>'):0===n&&(t=!0===s?(e=`<a href="#" id="${l[r].id}" class="active-user"><span id="active" title="inactive"><i class="fa fa-user" style="color: darkred"></i><br>Inactive</span></a>`,a=`<a href="${d}/users/edit?user_id=${l[r].id}" title="Edit"><i class="fa fa-edit pr-1"></i> </a>`,`<a href="${d}/users/delete?user_id=${l[r].id}" title="Delete"><i class="fa fa-trash pr-1"></i></a>`):(e='<span id="active" title="inactive"><i class="fa fa-user" style="color: darkred"></i><br>Inactive</span>',a='<i title="Can only edit if inactive" style="color: #d3d3d3" class="fa fa-edit pr-1"></i>','<i title="Can only delete if inactive" style="color: #d3d3d3" class="fa fa-trash pr-1"></i>')),i=(i=(i=(i=(i+="<tr>")+`<td style="width: 35%;padding-left: 7%">
                    <p><i class="fa fa-user"></i>&nbsp;&nbsp;<strong>${l[r].first_name} ${l[r].last_name}</strong></p>
                    </td>`)+`<td style="width: 15%;text-align: center">${l[r].role}</td>`)+`<td style="width: 5%;text-align: center"><small>${e}</small></td>`)+`<td style="width: 10%">
                                <div class="card-text text-sm-center">
                                    ${a}
                                    &nbsp;
                                    ${t}
                                </div>
                               </td>`+"</tr>"}document.querySelector("#user-data").innerHTML=i,new DataTable("#users",{order:[[0,"asc"]]});try{Array.from(document.getElementsByClassName("active-user")).forEach(r=>{r.addEventListener("click",async e=>{var a,t=r.getAttribute("id");t=t,a=authModule.get_user_token(),200===(t=await httpModule.req({method:"PUT",url:c.users.user_status.endpoint.replace(":id",t).replace(":is_active","1"),headers:{"Content-Type":"application/json","x-access-token":a}})).status&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-check"></i> User activated</div>',setTimeout(()=>{location.reload()},500))})})}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}try{Array.from(document.getElementsByClassName("inactive-user")).forEach(t=>{t.addEventListener("click",async()=>{var e,a=t.getAttribute("id");a=a,e=authModule.get_user_token(),200===(a=await httpModule.req({method:"PUT",url:c.users.user_status.endpoint.replace(":id",a).replace(":is_active","0"),headers:{"Content-Type":"application/json","x-access-token":e}})).status&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-check"></i> User deactivated</div>',setTimeout(()=>{location.reload()},500))})})}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}helperModule.show_form()}return!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.display_user=async function(e){return r()},e.display_user_record=async function(){try{helperModule.get_parameter_by_name("user_id");var e=await r(),a=await(async()=>{try{var e=helperModule.get_parameter_by_name("user_id"),a=authModule.get_user_token(),t=await httpModule.req({method:"GET",url:"/exhibits-dashboard/auth/role?user_id="+e,headers:{"Content-Type":"application/json","x-access-token":a}});if(200===t.status)return t.data[0]}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})(),t=e.pop();return"Administrator"===t.role?(await userModule.list_roles(a),document.querySelector("#first-name-input").value=t.first_name,document.querySelector("#last-name-input").value=t.last_name,document.querySelector("#email-input").value=t.email,document.querySelector("#du-id-input").value=t.du_id):(document.querySelector("#user-form").style.display="none",document.querySelector("#user-form-view-only").style.display="block",document.querySelector("#save-user-btn").style.display="none",document.querySelector("#first-name-disabled").value=t.first_name,document.querySelector("#last-name-disabled").value=t.last_name,document.querySelector("#email-disabled").value=t.email,document.querySelector("#du-id-disabled").value=t.du_id,document.querySelector("#role-disabled").value=a.role),!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.update_user_record=async function(e){try{window.scrollTo(0,0),e.preventDefault();var a,t,r=helperModule.get_parameter_by_name("user_id"),s=l(),i=authModule.get_user_token();if(void 0===r)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get user ID</div>');if(!1===i)setTimeout(()=>{document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get session token</div>',authModule.logout()},1e3);else{if(void 0===s)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get form field values</div>');!1!==s&&(document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Updating user record...</div>',a=c.users.update_user.put.endpoint.replace(":user_id",r),void 0!==(t=await httpModule.req({method:"PUT",url:a,data:s,headers:{"Content-Type":"application/json","x-access-token":i}})))&&201===t.status&&(document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> User record updated</div>',setTimeout(()=>{window.location.reload()},900))}return!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.save_user_record=async function(e){try{window.scrollTo(0,0),e.preventDefault();var a=l(),t=authModule.get_user_token();if(!1===t)setTimeout(()=>{document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get session token</div>',authModule.logout()},1e3);else{if(void 0===a)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get form field values</div>');if(!1!==a){document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Saving user record...</div>';var r=c.users.endpoint,s=await httpModule.req({method:"POST",url:r,data:a,headers:{"Content-Type":"application/json","x-access-token":t}});if(void 0!==s&&201===s.status){let e=s.data[0];document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> User record saved</div>',setTimeout(()=>{window.location.replace(d+"/users/edit?user_id="+e)},900)}else 200===s.status&&(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> User already exists</div>')}}return!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.delete_user=async function(){try{document.querySelector("#delete-message").innerHTML="Deleting user...";var e=helperModule.get_parameter_by_name("user_id"),a=authModule.get_user_token(),t=await httpModule.req({method:"DELETE",url:c.users.delete_user.delete.endpoint.replace(":user_id",e),headers:{"Content-Type":"application/json","x-access-token":a}});void 0!==t&&204===t.status?setTimeout(()=>{window.location.replace(d+"/users")},900):document.querySelector("#exhibit-no-delete").innerHTML='<i class="fa fa-exclamation"></i> '+t.data.message}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.check_user_data=function(){return null!==window.sessionStorage.getItem("exhibits_user")},e.list_roles=async function(t){try{var r=await(async()=>{try{var e=authModule.get_user_token(),a=await httpModule.req({method:"GET",url:"/exhibits-dashboard/auth/roles",headers:{"Content-Type":"application/json","x-access-token":e}});if(200===a.status)return a.data}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})();let a="";a=a+'<option value="">Select From Menu</option>'+'<option value="">----------</option>';for(let e=0;e<r.length;e++)void 0!==t&&t.role_id===r[e].id?a+=`<option value="${r[e].id}" selected>${r[e].role}</option>`:a+=`<option value="${r[e].id}">${r[e].role}</option>`;document.querySelector("#user-roles").innerHTML=a}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.init=async function(){await userModule.list_roles()},e})();