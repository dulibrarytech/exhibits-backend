let exhibitsModule=(()=>{let g=window.localStorage.getItem("exhibits_app_path");var e={};let i;async function a(a){try{var e=endpointsModule.get_exhibits_endpoints(),t=authModule.get_user_token(),i=await httpModule.req({method:"POST",url:e.exhibits.exhibit_publish.post.endpoint.replace(":exhibit_id",a.replace("-status","")),headers:{"Content-Type":"application/json","x-access-token":t}});return void 0!==i&&200===i.status&&(setTimeout(()=>{let t=document.getElementById(a);document.getElementById(a).classList.remove("publish-exhibit"),document.getElementById(a).classList.add("suppress-exhibit"),document.getElementById(a).replaceWith(t.cloneNode(!0)),document.getElementById(a).innerHTML='<span id="suppress" title="published"><i class="fa fa-cloud" style="color: green"></i><br>Published</span>',document.getElementById(a).addEventListener("click",async e=>{e.preventDefault(),await s(t.getAttribute("id"))},!1)},0),setTimeout(()=>{a=a.replace("-status","");var e=`<a href="${g}/items?exhibit_id=${a}" title="View Exhibit Items"><i class="fa fa-list pr-1"></i></a>&nbsp;`,t=a+"-actions",t=document.getElementById(t),i=`<a href="${g}/exhibits/exhibit/details?exhibit_id=${a}" title="View details" aria-label="exhibit-details"><i class="fa fa-folder-open pr-1"></i> </a>`;g;t.innerHTML=`
                        ${e}&nbsp;
                        ${i}&nbsp;
                        <i title="Can only delete if unpublished" style="color: #d3d3d3" class="fa fa-trash pr-1" aria-label="delete-exhibit"></i>`},0)),void 0!==i&&204===i.status?(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-warning" role="alert"><i class="fa fa-warning"></i> Exhibit must contain at least one item to publish</div>',setTimeout(()=>{document.querySelector("#message").innerHTML=""},5e3)):void 0===i&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-danger"></i> You do not have permission to publish this record.</div>',setTimeout(()=>{document.querySelector("#message").innerHTML=""},5e3)),!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}async function s(s){try{var e=endpointsModule.get_exhibits_endpoints(),t=authModule.get_user_token(),i=await httpModule.req({method:"POST",url:e.exhibits.exhibit_suppress.post.endpoint.replace(":exhibit_id",s.replace("-status","")),headers:{"Content-Type":"application/json","x-access-token":t}});return void 0!==i&&200===i.status?(setTimeout(()=>{let t=document.getElementById(s);document.getElementById(s).classList.remove("suppress-exhibit"),document.getElementById(s).classList.add("publish-exhibit"),document.getElementById(s).replaceWith(t.cloneNode(!0)),document.getElementById(s).innerHTML='<span id="publish" title="suppressed"><i class="fa fa-cloud-upload" style="color: darkred"></i><br>Unpublished</span>',document.getElementById(s).addEventListener("click",async e=>{e.preventDefault(),await a(t.getAttribute("id"))},!1)},0),setTimeout(()=>{s=s.replace("-status","");var e=`<a href="${g}/items?exhibit_id=${s}" title="View Exhibit Items"><i class="fa fa-list pr-1"></i></a>&nbsp;`,t=s+"-actions",t=document.getElementById(t),i=(g,`<a href="${g}/exhibits/exhibit/edit?exhibit_id=${s}" title="Edit" aria-label="edit-exhibit"><i class="fa fa-edit pr-1"></i> </a>`),a=`<a href="${g}/exhibits/exhibit/delete?exhibit_id=${s}" title="Delete exhibit" aria-label="delete-exhibit"><i class="fa fa-trash pr-1"></i></a>`;t.innerHTML=`
                        ${e}&nbsp;
                        ${i}&nbsp;
                        `+a},0)):void 0===i&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-danger"></i> You do not have permission to unplublish this record.</div>',setTimeout(()=>{},3e3)),!1}catch(e){document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> An error occurred while suppressing exhibit</div>',setTimeout(()=>{},5e3)}}return e.display_exhibits=async function(){var o=await(async()=>{try{var e=endpointsModule.get_exhibits_endpoints(),t=authModule.get_user_token(),i=await httpModule.req({method:"GET",url:e.exhibits.exhibit_records.endpoint,headers:{"Content-Type":"application/json","x-access-token":t}});if(void 0!==i&&200===i.status)return i.data.data}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})();let d="";if(!1===o)return document.querySelector("#exhibit-card").innerHTML="",!1;if(void 0===o&&authModule.redirect_to_auth(),0===o.length)return document.querySelector(".card").innerHTML="",!(document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert">No Exhibits found.</div>');for(let n=0;n<o.length;n++){var c=o[n].uuid,u=o[n].is_published,h=o[n].is_featured,p=o[n].is_locked,b=g+"/preview?uuid="+c,m=`<a href="${g}/items?exhibit_id=${c}" title="View Exhibit Items"><i class="fa fa-list pr-1"></i></a>&nbsp;`,f=new Date(o[n].created),x=new Date(o[n].updated),f=helperModule.format_date(f),x=helperModule.format_date(x),y="Exhibit created by "+o[n].created_by;let e="",t="",i,a="",s="",l="",r="";1===u?(i=`<a href="#" id="${c}-status" class="suppress-exhibit" aria-label="exhibit-status"><span id="suppress" title="published"><i class="fa fa-cloud" style="color: green"></i><br>Published</span></a>`,l=`<a href="${g}/exhibits/exhibit/details?exhibit_id=${c}" title="View details" aria-label="exhibit-details"><i class="fa fa-folder-open pr-1"></i> </a>`,r='<i title="Can only delete if unpublished" style="color: #d3d3d3" class="fa fa-trash pr-1" aria-label="delete-exhibit"></i>'):0===u&&(i=`<a href="#" id="${c}-status" class="publish-exhibit" aria-label="exhibit-status"><span id="publish" title="suppressed"><i class="fa fa-cloud-upload" style="color: darkred"></i><br>Unpublished</span></a>`,l=`<a href="${g}/exhibits/exhibit/edit?exhibit_id=${c}" title="Edit" aria-label="edit-exhibit"><i class="fa fa-edit pr-1"></i> </a>`,r=`<a href="${g}/exhibits/exhibit/delete?exhibit_id=${c}" title="Delete exhibit" aria-label="delete-exhibit"><i class="fa fa-trash pr-1"></i></a>`),1===h&&(a='&nbsp;&nbsp;<i class="fa fa-star" title="Featured" aria-label="featured exhibit" style="color: #BA8E23"></i>'),1===p&&(s='&nbsp;&nbsp;<i class="fa fa-lock" title="Record is currently locked" aria-label="exhibit-is-locked" style="color: #BA8E23"></i>'),t=`<p><img src="${e=0<o[n].thumbnail.length?g+`/api/v1/exhibits/${c}/media/`+o[n].thumbnail:g+"/static/images/image-tn.png"}" alt="${c}-thumbnail" height="100" width="100"></p>`,u=helperModule.strip_html(helperModule.unescape(o[n].title)),d=(d=(d=(d=(d+=`<tr id="${c}">`)+`<td style="width: 35%">
                    <p><strong>${u}</strong> ${a} ${s}</p>
                    ${t}
                    <div class="d-flex justify-content-between align-items-center">
                                <div class="btn-group">
                                     <span id="preview-link">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="exhibitsModule.open_preview('${b}');">
                                        <i class=" menu-icon fa fa-eye"></i>
                                        <small>Preview</small>
                                    </button>
                                    </span>
                                    &nbsp;&nbsp;
                                    <span id="share-link">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" data-toggle="modal" data-target=".shared-url-modal" onclick="exhibitsModule.create_shared_preview_url('${c}');">
                                        <i class="fa fa-share-alt"></i>
                                        <small>Share</small>
                                    </button>
                                    </span>
                                </div>
                            </div>
                            <p>
                                <span style="font-size: x-small"><em>${y}</em></span>
                            </p>
                    </td>`)+`<td style="width: 5%;text-align: center"><small>${i}</small></td>`)+`<td style="width: 10%">
                                <div class="card-text text-sm-center" id="${c}-actions">
                                    ${m}&nbsp;
                                    <!--<a href="${g}/items/standard?exhibit_id=${c}" title="Add Items" aria-label="add-items"><i class="fa fa-plus pr-1"></i> </a>-->
                                    &nbsp;
                                    ${l}
                                    &nbsp;
                                    ${r}
                                </div>
                            </td>`+`<td style="width: 4%" class="item-order" aria-label="exhibit-created"><span style="padding-left: 4px;">${f}</span></td>`)+`<td style="width: 4%" class="item-order" aria-label="exhibit-updated"><span style="padding-left: 4px;">${x}</span></td>`+"</tr>"}document.querySelector("#exhibits-data").innerHTML=d;var e=new DataTable("#exhibits",{paging:!0,order:[[4,"desc"]],rowReorder:!1,language:{bottomEnd:{paging:{firstLast:!1}}}}),e=(e.on("click","tbody tr .publish-exhibit",async e=>{e.preventDefault(),await a(e.currentTarget.getAttribute("id"))}),e.on("click","tbody tr .suppress-exhibit",async e=>{e.preventDefault(),await s(e.currentTarget.getAttribute("id"))}),helperModule.get_parameter_by_name("exhibit_id"));null!==e&&(history.replaceState({},"",g+"/exhibits"),history.pushState({},"",g+"/exhibits"),location.href="#"+e)},e.get_exhibit_title=async function(e){try{var t=endpointsModule.get_exhibits_endpoints(),i=authModule.get_user_token(),a=await httpModule.req({method:"GET",url:t.exhibits.exhibit_records.endpoints.get.endpoint.replace(":exhibit_id",e),headers:{"Content-Type":"application/json","x-access-token":i}});if(void 0!==a&&200===a.status)return helperModule.strip_html(helperModule.unescape(a.data.data[0].title))}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.set_exhibit_title=async function(e){e=await exhibitsModule.get_exhibit_title(e);return document.querySelector("#exhibit-title").innerHTML=""+e,!1},e.open_preview=function(e){scrollTo(0,0);let t=authModule.get_user_token();void 0!==i&&exhibitsModule.close_preview(),document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> Building Exhibit Preview...</div>',setTimeout(()=>{i=window.open(e+"&t="+t,"_blank","location=yes,scrollbars=yes,status=yes"),document.querySelector("#message").innerHTML=""},900)},e.close_preview=function(){i.close()},e.delete_exhibit=function(){try{(async()=>{document.querySelector("#delete-message").innerHTML="Deleting exhibit...";var e=endpointsModule.get_exhibits_endpoints(),t=helperModule.get_parameter_by_name("exhibit_id"),i=authModule.get_user_token();void 0!==(e=await httpModule.req({method:"DELETE",url:e.exhibits.exhibit_records.endpoints.delete.endpoint.replace(":exhibit_id",t),headers:{"Content-Type":"application/json","x-access-token":i}}))&&204===e.status?setTimeout(()=>{window.location.replace(g+"/exhibits")},900):void 0!==e&&200===e.status?(scrollTo(0,0),document.querySelector("#delete-card").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-warning" role="alert"><i class="fa fa-warning"></i> Cannot delete an exhibit that contains items.</div>'):void 0===e&&(scrollTo(0,0),document.querySelector("#delete-card").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> You do not have permission to delete this record.</div>')})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}return!1},e.create_shared_preview_url=function(i){(async()=>{document.querySelector("#shared-url").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Generating Shared URL...</div>';var e=endpointsModule.get_exhibits_endpoints(),t=authModule.get_user_token();!1===t?setTimeout(()=>{document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Unable to get session token</div>',authModule.logout()},1e3):void 0!==(e=await httpModule.req({method:"POST",url:e.exhibits.exhibit_shared.get.endpoint+"?uuid="+i,headers:{"Content-Type":"application/json","x-access-token":t}}))&&201===e.status&&(document.querySelector("#shared-url-copy").innerText=e.data.shared_url,setTimeout(async()=>{document.querySelector("#shared-url").innerHTML=`<div class="d-flex align-items-center">
                                                                                    <p>
                                                                                    - Shared URL created.&nbsp;&nbsp; 
                                                                                    <button type="button" class="btn btn-sm btn-primary" onclick="exhibitsModule.copy();">
                                                                                    <i class="fa fa-copy"> Copy</i>
                                                                                    </button>
                                                                                    <br>
                                                                                    - Shared URL expires in 7 days.
                                                                                    </p>
                                                                                </div>`},900))})()},e.copy=function(){try{(async()=>{var e=document.querySelector("#shared-url-copy").textContent;await navigator.clipboard.writeText(e),document.querySelector("#copy-message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> URL copied to clipboard!</div>',setTimeout(()=>{document.querySelector("#copy-message").innerHTML=""},5e3)})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Failed to copy shared URL to clipboard. Error: ${e.message}</div>`}},e.init=async function(){try{var e=authModule.get_user_token();await authModule.check_auth(e),await exhibitsModule.display_exhibits(),helperModule.show_form(),navModule.set_logout_link()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e})();