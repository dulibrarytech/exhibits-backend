let helperModule=(()=>{var e={};function p(e,t="danger"){var a=document.querySelector("#message");a&&(a.innerHTML=`<div class="alert alert-${t}" role="alert">${e}</div>`)}return e.get_parameter_by_name=function(e,t){try{t=t||window.location.href,e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(DOMPurify.sanitize(a[2].replace(/\+/g," "))):"":null}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.unescape=function(e){try{var t=document.createElement("textarea");return t.innerHTML=e,t.value}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.strip_html=function(e){try{return e.replace(/(<([^>]+)>)/gi,"")}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.clean_html=function(e){try{var t=document.createElement("div"),a=(t.innerHTML=e,["script","iframe","html","head","body","head","title","img","embed","applet","object","style","link","form","input","video","source","math","maction","picture","map","svg","details","frameset","comment","base"]);for(let e=0;e<a.length;e++)for(var r=t.getElementsByTagName(a[e]);r[0];)r[0].parentNode.removeChild(r[0]);return t.innerHTML.replace(/&amp;/g,"&")}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.preview_html=function(e){try{var t=helperModule.clean_html(document.querySelector("#"+e).value);return document.querySelector("#preview-html").innerHTML=t,document.querySelector("#"+e).value=t,!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.get_checked_radio_button=function(t){try{for(let e=0;e<t.length;e++)if(t[e].checked)return t[e].value}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.get_current_year=function(){try{var e=(new Date).getFullYear();domModule.html("#cdate",DOMPurify.sanitize(e))}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.format_date=function(e){return(1+e.getMonth()).toString().padStart(2,"0")+`/${e.getDate().toString().padStart(2,"0")}/${e.getFullYear()} @ ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:`+e.getSeconds().toString().padStart(2,"0")},e.show_form=function(){try{let e=Array.from(document.getElementsByClassName("card"));setTimeout(()=>{e.forEach(e=>{e.style.visibility="visible"})},250)}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.reorder_exhibits=async function(e,r){try{var t=endpointsModule.get_exhibits_endpoints(),i=helperModule.get_parameter_by_name("exhibit_id");let a={};var n=[];for(let e=0,t=r.length;e<t;e++){var o=r[e].node.getAttribute("id").split("_");a.type=o.pop(),a.uuid=o.pop(),a.order=r[e].node.childNodes[0].childNodes[1].innerText,n.push(a),a={}}var l=authModule.get_user_token(),d=await httpModule.req({method:"POST",url:t.exhibits.reorder_exhibits_records.post.endpoint.replace(":exhibit_id",i),data:n,headers:{"Content-Type":"application/json","x-access-token":l}});void 0!==d&&201===d.status?console.log(d):document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> An HTTP request error occurred while reordering items.</div>'}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.reorder_items=async function(e,r){try{if(0===r.length)return!1;var t=endpointsModule.get_exhibits_endpoints(),i=helperModule.get_parameter_by_name("exhibit_id"),n=helperModule.get_parameter_by_name("grid_id");let a={};var o=[];for(let e=0,t=r.length;e<t;e++){var l=r[e].node.getAttribute("id").split("_");a.type=l.pop(),a.uuid=l.pop(),a.order=r[e].node.childNodes[0].childNodes[1].innerText,null!==n&&(a.grid_id=n),o.push(a),a={}}var d=authModule.get_user_token(),s=await httpModule.req({method:"POST",url:t.exhibits.reorder_records.post.endpoint.replace(":exhibit_id",i),data:o,headers:{"Content-Type":"application/json","x-access-token":d}});void 0!==s&&201===s.status?console.log("items reordered"):document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> An HTTP request error occurred while reordering items.</div>'}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.reorder_grid_items=async function(e,r){try{if(0===r.length)return!1;var t=endpointsModule.get_exhibits_endpoints(),i=helperModule.get_parameter_by_name("exhibit_id"),n=helperModule.get_parameter_by_name("grid_id");let a={};var o=[];for(let e=0,t=r.length;e<t;e++){var l=r[e].node.getAttribute("id").split("_");a.grid_id=n,a.uuid=l[0],a.type="griditem",a.order=r[e].node.childNodes[0].childNodes[1].innerText,o.push(a),a={}}var d=authModule.get_user_token(),s=await httpModule.req({method:"POST",url:t.exhibits.reorder_records.post.endpoint.replace(":exhibit_id",i),data:o,headers:{"Content-Type":"application/json","x-access-token":d}});void 0!==s&&201===s.status?console.log("items reordered"):document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> An HTTP request error occurred while reordering items.</div>'}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.check_if_locked=function(e,i){(async()=>{try{var t=authModule.get_user_profile_data();if(1===e.is_locked&&e.locked_by_user!==parseInt(t.uid)){document.querySelector(i).style.display="none";var a=await authModule.get_user_role(parseInt(t.uid)),r=document.querySelector("#message");let e="";null!==r&&("Administrator"===a&&(e=`<br><span><div class="btn-group float-right">
                        <button id="unlock-record" class="btn btn-xs btn-secondary"><i class="fa fa-unlock-alt"></i> Unlock</button>
                        </div></span>`),document.querySelector("#message").innerHTML=`<div class="alert alert-warning" role="alert"><i class="fa fa-lock"></i> This record is currently being worked on by another user.  ${e}</div>`,null!==document.querySelector("#unlock-record"))&&document.querySelector("#unlock-record").addEventListener("click",()=>{helperModule.unlock_record()})}}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})()},e.unlock_record=async function(){try{var i=endpointsModule.get_exhibits_endpoints();let t=window.location.pathname,e=helperModule.get_parameter_by_name("exhibit_id");var n=[{paths:["exhibits/exhibit/edit"],endpoint_key:"exhibits.exhibit_unlock_record.post.endpoint",params:{exhibit_id:e}},{paths:["items/heading/edit"],endpoint_key:"exhibits.heading_unlock_record.post.endpoint",params:()=>({exhibit_id:e,heading_id:helperModule.get_parameter_by_name("item_id")})},{paths:["items/standard/text/edit","items/standard/media/edit"],endpoint_key:"exhibits.item_unlock_record.post.endpoint",params:()=>({exhibit_id:e,item_id:helperModule.get_parameter_by_name("item_id")})},{paths:["items/grid/item/media/edit","items/grid/item/text/edit"],endpoint_key:"exhibits.grid_item_unlock_record.post.endpoint",params:()=>({exhibit_id:e,grid_id:helperModule.get_parameter_by_name("grid_id"),item_id:helperModule.get_parameter_by_name("item_id")})},{paths:["items/vertical-timeline/item/media/edit","items/vertical-timeline/item/text/edit"],endpoint_key:"exhibits.timeline_item_unlock_record.post.endpoint",params:()=>({exhibit_id:e,timeline_id:helperModule.get_parameter_by_name("timeline_id"),item_id:helperModule.get_parameter_by_name("item_id")})}];let a=null,r={};for(let e of n)if(e.paths.some(e=>t.includes(e))){a=(m=i,e.endpoint_key.split(".").reduce((e,t)=>e?.[t],m)),r="function"==typeof e.params?e.params():e.params;break}if(a){let e=a;for(var[o,l]of Object.entries(r))e=e.replace(":"+o,l);var d,s,c=authModule.get_user_profile_data(),u=authModule.get_user_token();c?.uid&&u?(d=await httpModule.req({method:"POST",url:e+"?uid="+c.uid,headers:{"Content-Type":"application/json","x-access-token":u}}),(s=document.querySelector("#message"))&&(200===d.status?s.innerHTML='<div class="alert alert-success" role="alert">Unlocked</div>':s.innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> An HTTP request error occurred unlocking record.</div>')):(console.error("Missing authentication data"),p("Authentication error: unable to unlock record.","danger"))}else console.error("No matching endpoint found for current path:",t),p("An error occurred: unable to determine record type.","danger")}catch(e){console.error("Error in unlock_record:",e.message);n=document.querySelector("#message");n&&(n.innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> An error occurred unlocking record.</div>')}var m},e.unlock_record__=async function(){var e,t=endpointsModule.get_exhibits_endpoints(),a=helperModule.get_parameter_by_name("exhibit_id");let r;!0===window.location.pathname.includes("exhibits/exhibit/edit")&&(r=t.exhibits.exhibit_unlock_record.post.endpoint.replace(":exhibit_id",a)),!0===window.location.pathname.includes("items/heading/edit")&&(i=helperModule.get_parameter_by_name("item_id"),e=t.exhibits.heading_unlock_record.post.endpoint.replace(":exhibit_id",a),r=e.replace(":heading_id",i)),!0!==window.location.pathname.includes("items/standard/text/edit")&&!0!==window.location.pathname.includes("items/standard/media/edit")||(e=helperModule.get_parameter_by_name("item_id"),i=t.exhibits.item_unlock_record.post.endpoint.replace(":exhibit_id",a),r=i.replace(":item_id",e)),!0!==window.location.pathname.includes("items/grid/item/media/edit")&&!0!==window.location.pathname.includes("items/grid/item/text/edit")||(i=helperModule.get_parameter_by_name("grid_id"),e=helperModule.get_parameter_by_name("item_id"),i=t.exhibits.grid_item_unlock_record.post.endpoint.replace(":exhibit_id",a).replace(":grid_id",i),r=i.replace(":item_id",e)),!0!==window.location.pathname.includes("items/vertical-timeline/item/media/edit")&&!0!==window.location.pathname.includes("items/vertical-timeline/item/text/edit")||(i=helperModule.get_parameter_by_name("timeline_id"),e=helperModule.get_parameter_by_name("item_id"),t=t.exhibits.timeline_item_unlock_record.post.endpoint.replace(":exhibit_id",a).replace(":timeline_id",i),r=t.replace(":item_id",e));var a=authModule.get_user_profile_data(),i=authModule.get_user_token();200===(await httpModule.req({method:"POST",url:r+"?uid="+a.uid,headers:{"Content-Type":"application/json","x-access-token":i}})).status?document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert">Unlocked</div>':document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> An HTTP request error occurred unlocking record.</div>'},e.get_user_name=function(){return authModule.get_user_profile_data().name},e.get_owner=function(){var e=authModule.get_user_profile_data();return parseInt(e.uid)},e.create_subjects_menu=async function(e=[]){try{let a=await this.get_item_subjects(),t=document.getElementById("dropdownHeader"),n=document.getElementById("dropdownList"),o=document.getElementById("virtualList"),r=document.getElementById("arrow"),i=document.getElementById("selectedText"),l=document.getElementById("resultList"),d=document.getElementById("searchBox"),s=document.getElementById("searchInput"),c=new Set(e),u=a,m=new Map,p=!1,h=48,_=50,g;function v(){o.innerHTML="",m.clear();var e=n.scrollTop||0,t=Math.max(0,Math.floor(e/h)-_),a=Math.min(u.length,Math.ceil((e+n.clientHeight)/h)+_);o.style.height=u.length*h+"px",o.style.position="relative";for(let e=t;e<a;e++){let t=u[e];var r=document.createElement("div");r.className="dropdown-item",r.style.position="absolute",r.style.top=e*h+"px",r.style.width="100%";let a=document.createElement("input");a.type="checkbox",a.value=t,a.className="form-check-input",a.checked=c.has(t);var i=document.createElement("label");i.className="ms-2",i.style.cursor="pointer",i.style.marginBottom="0",i.textContent=t,i.style.paddingLeft="30px",a.addEventListener("change",e=>{e.target.checked?c.add(t):c.delete(t),y()}),i.addEventListener("click",e=>{e.stopPropagation(),a.checked=!a.checked,a.dispatchEvent(new Event("change"))}),r.appendChild(a),r.appendChild(i),o.appendChild(r),m.set(t,a)}}function y(){var e,t,a;0===c.size?(i.innerHTML='<span class="placeholder">Select subjects...</span>',l.innerHTML='<li style="color: #999;">None selected</li>'):(e=Array.from(c),t=c.size,a=e.length<=2?e.join(", "):`${e[0]}, ${e[1]}...`,i.innerHTML=a+` <span class="selected-count">${t}</span>`,l.innerHTML=e.sort().map(e=>`<li>
                            <span>${e}</span>
                            <button class="uncheck-btn" title="Remove subject" data-item="${e}" style="background: none; border: none; cursor: pointer; color: #999; padding: 0 5px; font-size: 18px; line-height: 1;">×</button>
                        </li>`).join(""),l.querySelectorAll(".uncheck-btn").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();e=t.dataset.item,c.delete(e),e=m.get(e);e&&(e.checked=!1),y()})}),document.querySelector("#selected-subjects").value=e.join("|"))}s.addEventListener("input",e=>{clearTimeout(g),g=setTimeout(()=>{let t=e.target.value.toLowerCase();u=t?a.filter(e=>e.toLowerCase().includes(t)):a,v()},150)}),n.addEventListener("scroll",()=>{v()}),t.addEventListener("click",()=>{p=!p,n.classList.toggle("show"),t.classList.toggle("active"),r.classList.toggle("rotate"),d.classList.toggle("show"),p?(s.focus(),v()):(s.value="",u=a)}),document.addEventListener("click",e=>{e.target.closest(".dropdown-container")||(p=!1,n.classList.remove("show"),t.classList.remove("active"),r.classList.remove("rotate"),d.classList.remove("show"),s.value="",u=a)}),v(),y()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.get_item_subjects=async function(){try{var e=endpointsModule.get_exhibits_endpoints(),t=authModule.get_user_token(),a=await httpModule.req({method:"GET",url:e.exhibits.item_subjects.endpoint,headers:{"Content-Type":"application/json","x-access-token":t}});if(void 0!==a&&200===a.status)return a.data.data}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.check_bandwidth=function(a){let r=(new Date).getTime(),i,n=0;!async function e(){var t;200===(await httpModule.req({method:"GET",url:"https://upload.wikimedia.org/wikipedia/commons/9/90/ODJBcard.JPG"})).status&&(t=(new Date).getTime()-r,t=Number(55/(t/1e3)),i=((i||t)+t)/2,++n<10?(r=(new Date).getTime(),await e()):a(i.toFixed(0)))}()},e.check_app_env=function(){var e=window.location.hostname;"localhost"!==e&&"libwebapw01-vlt.du.edu"!==e&&"exhibits.dev"!==e||null!==(e=document.querySelector("#app-message"))&&(e.innerHTML='<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> <strong>"STOP! Do not use Development Site"</strong>&nbsp;&nbsp;&nbsp;<a class="btn btn-info" href="https://exhibits-backend.library.du.edu/exhibits-dashboard/auth" target="_blank">Go to Live Site </a> </div>')},e.init=function(){},e})();helperModule.init();