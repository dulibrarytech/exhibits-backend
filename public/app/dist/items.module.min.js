let itemsModule=(()=>{let y={OK:200,NO_CONTENT:204,FORBIDDEN:403},f=()=>{try{return endpointsModule.get_exhibits_endpoints()}catch(e){return console.error("Error getting exhibits endpoints:",e),null}},v=(()=>{try{var e=window.localStorage.getItem("exhibits_app_path");return e?e:(console.error("App path not found in localStorage"),"")}catch(e){return console.error("Error accessing localStorage:",e),""}})(),x={};function t(e){if(!e||!e.message)return"An unexpected error occurred. Please try again.";var t,i,a=e.message.toLowerCase();for([t,i]of Object.entries({network:"Network error. Please check your connection and try again.",timeout:"Request timed out. Please try again.",token:"Session expired. Please log in again.",auth:"Authentication failed. Please log in again.",permission:"You do not have permission to access this resource.","not found":"The requested resource was not found.",invalid:"Invalid request. Please try again.",uuid:"Invalid identifier provided."}))if(a.includes(t))return i;return"An error occurred. Please try again."}let w=(e,t,i)=>{var a,r;e?(t=["info","success","danger","warning"].includes(t)?t:"danger",(a=document.createElement("div")).className="alert alert-"+t,a.setAttribute("role","alert"),(r=document.createElement("i")).className=n(t),r.setAttribute("aria-hidden","true"),a.appendChild(r),t=document.createTextNode(" "+i),a.appendChild(t),e.textContent="",e.appendChild(a)):console.error("Message element not found:",i)},n=e=>({info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"})[e]||"fa fa-exclamation";function S(a,r,n,o){var s=document.getElementById(a+"-item-actions");if(s){var d=document.createElement("div");d.className="card-text text-sm-center";let e="";let t=null,i="item";var l=encodeURIComponent(n),m=encodeURIComponent(a);switch(r){case"heading":i="heading",e=o?v+`/items/heading/details?exhibit_id=${l}&item_id=`+m:v+`/items/heading/edit?exhibit_id=${l}&item_id=`+m;break;case"text":e=o?v+`/items/standard/text/details?exhibit_id=${l}&item_id=`+m:v+`/items/standard/text/edit?exhibit_id=${l}&item_id=`+m;break;case"grid":i="grid",e=o?v+`/items/grid/details?exhibit_id=${l}&item_id=`+m:v+`/items/grid/edit?exhibit_id=${l}&item_id=`+m;var u=v+`/items/grid/items?exhibit_id=${l}&grid_id=`+m,u=((t=document.createElement("a")).href=u,t.setAttribute("title","View grid items"),t.setAttribute("aria-label","view-grid-items"),document.createElement("i"));u.className="fa fa-list pr-1",u.setAttribute("aria-hidden","true"),t.appendChild(u);break;case"timeline":i="timeline",e=o?v+`/items/vertical-timeline/details?exhibit_id=${l}&item_id=`+m:v+`/items/vertical-timeline/edit?exhibit_id=${l}&item_id=`+m;u=v+`/items/timeline/items?exhibit_id=${l}&timeline_id=`+m,u=((t=document.createElement("a")).href=u,t.setAttribute("title","View timeline items"),t.setAttribute("aria-label","view-timeline-items"),document.createElement("i"));u.className="fa fa-list pr-1",u.setAttribute("aria-hidden","true"),t.appendChild(u);break;default:e=o?v+`/items/standard/media/details?exhibit_id=${l}&item_id=`+m:v+`/items/standard/media/edit?exhibit_id=${l}&item_id=`+m}n=v+`/items/delete?exhibit_id=${l}&item_id=${m}&type=`+encodeURIComponent(i),t&&(d.appendChild(t),d.appendChild(document.createTextNode(" ")));var a=document.createElement("a"),r=(a.href=e,a.setAttribute("title",o?"View details":"Edit item"),a.setAttribute("aria-label",o?"view-item-details":"edit-item"),document.createElement("i"));r.className=o?"fa fa-folder-open pr-1":"fa fa-edit pr-1",r.setAttribute("aria-hidden","true"),a.appendChild(r),d.appendChild(a),d.appendChild(document.createTextNode(" ")),o?((r=document.createElement("i")).className="fa fa-trash pr-1",r.setAttribute("title","Can only delete if unpublished"),r.setAttribute("aria-label","delete-disabled"),r.style.color="#d3d3d3",r.setAttribute("aria-hidden","true"),d.appendChild(r)):((a=document.createElement("a")).href=n,a.setAttribute("title","Delete item"),a.setAttribute("aria-label","delete-item"),(r=document.createElement("i")).className="fa fa-trash pr-1",r.setAttribute("aria-hidden","true"),a.appendChild(r),d.appendChild(a)),s.textContent="",s.appendChild(d)}}return x.get_items=async function(e){if(e&&"string"==typeof e){var t=f();if(t?.exhibits?.item_records?.endpoint){var i=authModule.get_user_token();if(i&&!1!==i){t=t.exhibits.item_records.endpoint.replace(":exhibit_id",encodeURIComponent(e)),e=await httpModule.req({method:"GET",url:t,headers:{"Content-Type":"application/json","x-access-token":i},timeout:3e4,validateStatus:e=>200<=e&&e<600});if(e?.status===y.FORBIDDEN){let e=document.querySelector("#message");w(e,"danger","You do not have permission to view items for this exhibit")}else{if(e?.status===y.OK&&e.data?.data)return(e=>{try{window.localStorage.removeItem("items"),window.localStorage.setItem("items",JSON.stringify(e))}catch(e){return console.error("Error saving items to localStorage:",e)}})(e.data.data),e.data.data;if(e){let e=document.querySelector("#message");w(e,"danger","Failed to retrieve items. Please try again.")}else{let e=document.querySelector("#message");w(e,"danger","Unable to retrieve items. Please check your connection and try again.")}}}else{let e=document.querySelector("#message");w(e,"danger","Session expired. Please log in again.")}}else{let e=document.querySelector("#message");w(e,"danger","Item records endpoint not configured")}}else{let e=document.querySelector("#message");w(e,"danger","Invalid exhibit UUID")}return!1},x.display_items=async function(){try{var e=helperModule.get_parameter_by_name("exhibit_id");if(!e)return _=document.querySelector("#message"),w(_,"warning","No exhibit ID provided"),!1;var i,a,r,n,o,s=await x.get_items(e);if(!1===s)return(i=document.querySelector("#item-card"))&&(i.textContent=""),!1;if(!s||0===s.length)return(a=document.querySelector(".card"))&&(a.textContent=""),r=document.querySelector("#message"),(n=document.createElement("div")).className="alert alert-info",n.setAttribute("role","alert"),(o=document.createElement("span")).id="exhibit-title",n.appendChild(o),n.appendChild(document.createTextNode(" exhibit is empty.")),r.textContent="",r.appendChild(n),await exhibitsModule.set_exhibit_title(e),!1;let t="";for(let e=0;e<s.length;e++){var d=s[e].type,l=s[e];switch(d){case"heading":t+=await itemsListDisplayModule.display_heading_items(l);break;case"item":t+=await itemsListDisplayModule.display_standard_items(l);break;case"grid":t+=await itemsListDisplayModule.display_grids(l);break;case"vertical_timeline":t+=await itemsListDisplayModule.display_timelines(l);break;default:console.warn("Unknown item type: "+d)}}var m=document.querySelector("#item-data"),u=(m&&(m.innerHTML=t),document.querySelector("#items"));u&&DataTable.isDataTable("#items")&&new DataTable("#items").destroy();new DataTable("#items",{paging:!1,rowReorder:!0}).on("row-reordered",async(e,t)=>{await helperModule.reorder_items(e,t)});var c,p,h=document.querySelector("#items tbody"),g=(h&&(h._publishSuppressHandler&&h.removeEventListener("click",h._publishSuppressHandler),c=async e=>{var t=e.target.closest(".publish-item, .suppress-item");if(t){e.preventDefault();e=t.getAttribute("id");if(e){if(t.classList.contains("publish-item")){var i=e;if(i){var a=helperModule.get_parameter_by_name("exhibit_id");if(a){var r=document.getElementsByTagName("tr");let t=null;for(let e=0;e<r.length;e++)if(r[e].id&&-1!==r[e].id.indexOf(i)){var n=r[e].id.split("_");t=n[n.length-1];break}if(t){console.log("Publishing item type:",t);var o=f();if(o?.exhibits?.item_records?.item_publish?.post?.endpoint){var o=o.exhibits.item_records.item_publish.post.endpoint.replace(":exhibit_id",encodeURIComponent(a)).replace(":item_id",encodeURIComponent(i))+"?type="+encodeURIComponent(t),s=authModule.get_user_token();if(s&&!1!==s){o=await httpModule.req({method:"POST",url:o,headers:{"Content-Type":"application/json","x-access-token":s},timeout:3e4,validateStatus:e=>200<=e&&e<600});if(o?.status===y.FORBIDDEN){window.scrollTo({top:0,behavior:"smooth"});let e=document.querySelector("#message");w(e,"danger","You do not have permission to publish this record")}else{if(o?.status===y.OK)return void await(((e,t,i)=>{var a,r,n=document.getElementById(e);n?(n.classList.remove("publish-item"),n.classList.add("suppress-item"),(a=document.createElement("span")).id="suppress-"+e,a.setAttribute("title","Published - click to unpublish"),(r=document.createElement("i")).className="fa fa-cloud",r.style.color="green",r.setAttribute("aria-hidden","true"),a.appendChild(r),a.appendChild(document.createElement("br")),a.appendChild(document.createTextNode("Published")),n.textContent="",n.appendChild(a),S(e,t,i,!0)):console.error("Status element not found for UUID: "+e)})(i,t,a),!0);if(422===o?.status){window.scrollTo({top:0,behavior:"smooth"});let e=document.querySelector("#message");w(e,"warning","Cannot publish item. Exhibit must be published.")}else if(o){window.scrollTo({top:0,behavior:"smooth"});let e=document.querySelector("#message");w(e,"danger","Failed to publish item. Please try again.")}else{window.scrollTo({top:0,behavior:"smooth"});let e=document.querySelector("#message");w(e,"danger","Unable to publish item. Please check your connection and try again.")}}}else{let e=document.querySelector("#message");w(e,"danger","Session expired. Please log in again.")}}else{let e=document.querySelector("#message");w(e,"danger","Publish endpoint not configured")}}else{let e=document.querySelector("#message");w(e,"danger","Could not determine item type")}}else{let e=document.querySelector("#message");w(e,"danger","Exhibit ID not found")}}else{let e=document.querySelector("#message");w(e,"danger","Invalid item UUID")}}else if(t.classList.contains("suppress-item")){var d=e;if(d){s=helperModule.get_parameter_by_name("exhibit_id");if(s){var l=document.getElementsByTagName("tr");let t=null;for(let e=0;e<l.length;e++)if(l[e].id&&-1!==l[e].id.indexOf(d)){var m=l[e].id.split("_");t=m[m.length-1];break}if(t){console.log("Suppressing item type:",t);a=f();if(a?.exhibits?.item_records?.item_suppress?.post?.endpoint){a=a.exhibits.item_records.item_suppress.post.endpoint.replace(":exhibit_id",encodeURIComponent(s)).replace(":item_id",encodeURIComponent(d))+"?type="+encodeURIComponent(t),o=authModule.get_user_token();if(o&&!1!==o){a=await httpModule.req({method:"POST",url:a,headers:{"Content-Type":"application/json","x-access-token":o},timeout:3e4,validateStatus:e=>200<=e&&e<600});if(a?.status===y.FORBIDDEN){window.scrollTo({top:0,behavior:"smooth"});let e=document.querySelector("#message");w(e,"danger","You do not have permission to unpublish this record")}else{if(a?.status===y.OK)return void await(((e,t,i)=>{var a,r,n=document.getElementById(e);n?(n.classList.remove("suppress-item"),n.classList.add("publish-item"),(a=document.createElement("span")).id="publish-"+e,a.setAttribute("title","Unpublished - click to publish"),(r=document.createElement("i")).className="fa fa-cloud-upload",r.style.color="darkred",r.setAttribute("aria-hidden","true"),a.appendChild(r),a.appendChild(document.createElement("br")),a.appendChild(document.createTextNode("Unpublished")),n.textContent="",n.appendChild(a),S(e,t,i,!1)):console.error("Status element not found for UUID: "+e)})(d,t,s),!0);if(a){window.scrollTo({top:0,behavior:"smooth"});let e=document.querySelector("#message");w(e,"danger","Failed to unpublish item. Please try again.")}else{window.scrollTo({top:0,behavior:"smooth"});let e=document.querySelector("#message");w(e,"danger","Unable to unpublish item. Please check your connection and try again.")}}}else{let e=document.querySelector("#message");w(e,"danger","Session expired. Please log in again.")}}else{let e=document.querySelector("#message");w(e,"danger","Suppress endpoint not configured")}}else{let e=document.querySelector("#message");w(e,"danger","Could not determine item type")}}else{let e=document.querySelector("#message");w(e,"danger","Exhibit ID not found")}}else{let e=document.querySelector("#message");w(e,"danger","Invalid item UUID")}}}else console.warn("Publish/suppress button missing ID")}},h._publishSuppressHandler=c,h.addEventListener("click",c)),helperModule.get_parameter_by_name("id")),b=helperModule.get_parameter_by_name("type");return g&&b&&(p=v+"/exhibits?exhibit_id="+encodeURIComponent(e),window.history.replaceState({},"",p),window.history.pushState({},"",p),window.location.href=`#${g}_`+b),!0}catch(e){console.error("Error displaying items:",e);var _=document.querySelector("#message");return w(_,"danger",t(e)),!1}},x.delete_item=async function(){var e=document.querySelector("#delete-message");e&&(e.textContent="Deleting item...");let t=helperModule.get_parameter_by_name("exhibit_id");var e=helperModule.get_parameter_by_name("item_id"),i=helperModule.get_parameter_by_name("type");if(t&&e&&i){var a=f();if(a?.exhibits?.item_records?.delete?.endpoint){var r=authModule.get_user_token();if(r&&!1!==r){a=a.exhibits.item_records.delete.endpoint.replace(":exhibit_id",encodeURIComponent(t)).replace(":item_id",encodeURIComponent(e))+"?type="+encodeURIComponent(i),e=await httpModule.req({method:"DELETE",url:a,headers:{"Content-Type":"application/json","x-access-token":r},timeout:3e4,validateStatus:e=>200<=e&&e<600});if(e?.status===y.FORBIDDEN){window.scrollTo({top:0,behavior:"smooth"});let e=document.querySelector("#delete-card"),t=(e&&(e.textContent=""),document.querySelector("#message"));w(t,"danger","You do not have permission to delete this record")}else{if(e?.status===y.NO_CONTENT)return setTimeout(()=>{var e=v+"/items?exhibit_id="+encodeURIComponent(t);window.location.replace(e)},900),!0;if(e){window.scrollTo({top:0,behavior:"smooth"});let e=document.querySelector("#delete-card"),t=(e&&(e.textContent=""),document.querySelector("#message"));w(t,"danger","Failed to delete item. Please try again.")}else{window.scrollTo({top:0,behavior:"smooth"});let e=document.querySelector("#delete-card"),t=(e&&(e.textContent=""),document.querySelector("#message"));w(t,"danger","Unable to delete item. Please check your connection and try again.")}}}else{let e=document.querySelector("#message");w(e,"danger","Session expired. Please log in again.")}}else{let e=document.querySelector("#message");w(e,"danger","Delete endpoint not configured")}}else{let e=document.querySelector("#message");w(e,"danger","Missing required parameters for delete operation")}return!1},x.init=async function(){try{let t=helperModule.get_parameter_by_name("exhibit_id");"403"===helperModule.get_parameter_by_name("status")&&(i=document.querySelector("#message"),w(i,"danger","You do not have permission to add item."),setTimeout(()=>{var e=v+"/items?exhibit_id="+encodeURIComponent(t);window.history.replaceState({page:"items"},"",e)},0));var e=authModule.get_user_token();await authModule.check_auth(e),exhibitsModule.set_exhibit_title(t),await x.display_items(),helperModule.show_form(),navModule.set_preview_link(),navModule.set_item_nav_menu_links(),navModule.set_logout_link(),console.log("Items module initialized")}catch(e){console.error("Error initializing items module:",e);var i=document.querySelector("#message");w(i,"danger",t(e))}},x})();