let exhibitsEditFormModule=(()=>{let x=window.localStorage.getItem("exhibits_app_path"),S=endpointsModule.get_exhibits_endpoints();var e={};async function t(){try{var t,o,i,r,a=await(async()=>{try{var e=helperModule.get_parameter_by_name("exhibit_id"),t=authModule.get_user_token(),o=authModule.get_user_profile_data();if(!1===t||null===S)return document.querySelector("#message").innerHTML="ERROR: Unable to get API endpoints",setTimeout(()=>{window.location.replace(x+"/dashboard/login")},1e3),!1;document.querySelector("#exhibit-title").innerHTML=await exhibitsModule.get_exhibit_title(e);var i=S.exhibits.exhibit_records.endpoints.get.endpoint.replace(":exhibit_id",e)+"?type=edit&uid="+o.uid,r=await httpModule.req({method:"GET",url:i,headers:{"Content-Type":"application/json","x-access-token":t}});return void 0!==r&&200===r.status?r.data.data[0]:void 0}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})(),n=a.is_published,l=a.created_by,u=new Date(a.created),c=a.updated_by,d=a.updated,m=new Date(d);let e="";var s=helperModule.format_date(u),h=helperModule.format_date(m),b=(helperModule.check_if_locked(a,"#exhibit-submit-card"),null!==l&&(e+=`<em>Created by ${l} on ${s}</em>`),null!==c&&(e+=` | <em>Last updated by ${c} on ${h}</em>`),document.querySelector("#created").innerHTML=e,null!==document.querySelector("#is-published")&&1===n?document.querySelector("#is-published").value=!0:null!==document.querySelector("#is-published")&&0===n&&(document.querySelector("#is-published").value=!1),document.querySelector("#exhibit-title-input").value=helperModule.unescape(a.title),document.querySelector("#exhibit-sub-title-input").value=helperModule.unescape(a.subtitle),document.querySelector("#exhibit-description-input").value=helperModule.unescape(a.description),document.querySelector("#exhibit-about-the-curators-input").value=helperModule.unescape(a.about_the_curators),document.querySelector("#exhibit-owner").value=a.owner,1===a.is_featured?document.querySelector("#is-featured").checked=!0:document.querySelector("#is-featured").checked=!1,1===a.is_student_curated?document.querySelector("#is-student-curated").checked=!0:document.querySelector("#is-student-curated").checked=!1,0<a.alert_text.length&&(document.querySelector("#is-content-advisory").checked=!0,document.querySelector("#exhibit-alert-text-input").value=helperModule.unescape(a.alert_text)),0<a.hero_image.length&&(t=`${x}/api/v1/exhibits/${a.uuid}/media/`+a.hero_image,o=`<p><img alt="${a.hero_image}" src="${t}" height="200"></p>`,document.querySelector("#hero-image-display").innerHTML=o,document.querySelector("#hero-image-filename-display").innerHTML=`<span style="font-size: 11px">${a.hero_image}</span>`,document.querySelector("#hero-image").value=a.hero_image,document.querySelector("#hero-image-prev").value=a.hero_image,document.querySelector("#hero-trash").style.display="inline"),0<a.thumbnail.length&&(i=`${x}/api/v1/exhibits/${a.uuid}/media/`+a.thumbnail,r=`<p><img alt="${a.thumbnail}" src="${i}" height="200"></p>`,document.querySelector("#thumbnail-image-display").innerHTML=r,document.querySelector("#thumbnail-filename-display").innerHTML=`<span style="font-size: 11px">${a.thumbnail}</span>`,document.querySelector("#thumbnail-image").value=a.thumbnail,document.querySelector("#thumbnail-image-prev").value=a.thumbnail,document.querySelector("#thumbnail-trash").style.display="inline"),document.getElementsByName("banner_template"));for(let e=0;e<b.length;e++)b[e].value===a.banner_template&&(document.querySelector("#"+b[e].id).checked=!0);var v=JSON.parse(a.styles);if(void 0!==v.exhibit.navigation){void 0!==v.exhibit.navigation.backgroundColor&&0!==v.exhibit.navigation.backgroundColor.length&&(document.querySelector("#nav-background-color").value=v.exhibit.navigation.backgroundColor,document.querySelector("#nav-background-color-picker").value=v.exhibit.navigation.backgroundColor),void 0!==v.exhibit.navigation.color&&0!==v.exhibit.navigation.color.length&&(document.querySelector("#nav-font-color").value=v.exhibit.navigation.color,document.querySelector("#nav-font-color-picker").value=v.exhibit.navigation.color);var y=document.querySelector("#nav-font");for(let e=0;e<y.length;e++)y[e].value===v.exhibit.navigation.fontFamily&&(document.querySelector("#nav-font").value=v.exhibit.navigation.fontFamily);void 0!==v.exhibit.navigation.fontSize&&(document.querySelector("#nav-font-size").value=v.exhibit.navigation.fontSize.replace("px",""))}if(void 0!==v.exhibit.template&&0!==v.exhibit.template.length){void 0!==v.exhibit.template.backgroundColor&&0!==v.exhibit.template.backgroundColor.length&&(document.querySelector("#template-background-color").value=v.exhibit.template.backgroundColor,document.querySelector("#template-background-color-picker").value=v.exhibit.template.backgroundColor),void 0!==v.exhibit.template.color&&0!==v.exhibit.template.color.length&&(document.querySelector("#template-font-color").value=v.exhibit.template.color,document.querySelector("#template-font-color-picker").value=v.exhibit.template.color);var g=document.querySelector("#template-font");for(let e=0;e<g.length;e++)g[e].value===v.exhibit.template.fontFamily&&(document.querySelector("#template-font").value=v.exhibit.template.fontFamily);void 0!==v.exhibit.template.fontSize&&(document.querySelector("#template-font-size").value=v.exhibit.template.fontSize.replace("px",""))}if(void 0!==v.exhibit.introduction){void 0!==v.exhibit.introduction.backgroundColor&&0!==v.exhibit.introduction.backgroundColor.length&&0<v.exhibit.introduction.backgroundColor.length&&(document.querySelector("#introduction-background-color").value=v.exhibit.introduction.backgroundColor,document.querySelector("#introduction-background-color-picker").value=v.exhibit.introduction.backgroundColor),void 0!==v.exhibit.introduction.color&&0<v.exhibit.introduction.color.length&&0!==v.exhibit.introduction.color.length&&(document.querySelector("#introduction-font-color").value=v.exhibit.introduction.color,document.querySelector("#introduction-font-color-picker").value=v.exhibit.introduction.color);var p=document.querySelector("#introduction-font");for(let e=0;e<p.length;e++)p[e].value===v.exhibit.introduction.fontFamily&&(document.querySelector("#introduction-font").value=v.exhibit.introduction.fontFamily);void 0!==v.exhibit.introduction.fontSize&&(document.querySelector("#introduction-font-size").value=v.exhibit.introduction.fontSize.replace("px",""))}return!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}function o(){try{(async()=>{var e=helperModule.get_parameter_by_name("exhibit_id"),t=document.querySelector("#hero-image").value,e=S.exhibits.exhibit_media.get.endpoint.replace(":exhibit_id",e).replace(":media",t),t=authModule.get_user_token();void 0!==(e=await httpModule.req({method:"DELETE",url:e,headers:{"Content-Type":"application/json","x-access-token":t}}))&&204===e.status&&(document.querySelector("#hero-image").value="",document.querySelector("#hero-image-filename-display").innerHTML="",document.querySelector("#hero-trash").style.display="none",document.querySelector("#hero-image-display").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Hero image deleted</div>',setTimeout(()=>{document.querySelector("#message").innerHTML="",window.location.reload()},900))})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}return!1}function i(){try{(async()=>{var e=helperModule.get_parameter_by_name("exhibit_id"),t=document.querySelector("#thumbnail-image").value,e=S.exhibits.exhibit_media.get.endpoint.replace(":exhibit_id",e).replace(":media",t),t=authModule.get_user_token();void 0!==(e=await httpModule.req({method:"DELETE",url:e,headers:{"Content-Type":"application/json","x-access-token":t}}))&&204===e.status&&(document.querySelector("#thumbnail-image").value="",document.querySelector("#thumbnail-filename-display").innerHTML="",document.querySelector("#thumbnail-trash").style.display="none",document.querySelector("#thumbnail-image-display").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Thumbnail deleted</div>',setTimeout(()=>{document.querySelector("#message").innerHTML="",window.location.reload()},900))})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}return!1}return e.update_exhibit_record=async function(){try{scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Updating exhibit record...</div>';var e,t,o=helperModule.get_parameter_by_name("exhibit_id"),i=(()=>{try{var e=exhibitsCommonFormModule.get_common_form_fields();return e.styles=exhibitsCommonFormModule.get_exhibit_styles(),e.hero_image_prev=document.querySelector("#hero-image-prev").value,e.thumbnail_prev=document.querySelector("#thumbnail-image-prev").value,e}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})(),r=authModule.get_user_token();return void 0===o?!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get record UUID</div>'):!1===r?(setTimeout(()=>{document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get session token</div>',authModule.logout()},1e3),!1):null===(t=JSON.parse(sessionStorage.getItem("exhibits_user"))).name?!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to retrieve your name</div>'):(i.updated_by=t.name,void(void 0!==(e=await httpModule.req({method:"PUT",url:S.exhibits.exhibit_records.endpoints.put.endpoint.replace(":exhibit_id",o),data:i,headers:{"Content-Type":"application/json","x-access-token":r}}))&&201===e.status&&(document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Exhibit record updated</div>',setTimeout(()=>{window.location.reload()},900))))}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.init=async function(){try{navModule.back_to_exhibits(),document.querySelector("#save-exhibit-btn").addEventListener("click",exhibitsEditFormModule.update_exhibit_record),setTimeout(async()=>{await t(),0===document.querySelector("#hero-image").value.length?(document.querySelector("#hero-trash").removeEventListener("click",o),document.querySelector("#hero-trash").addEventListener("click",exhibitsCommonFormModule.delete_hero_image)):0!==document.querySelector("#hero-image").value&&(document.querySelector("#hero-trash").removeEventListener("click",exhibitsCommonFormModule.delete_hero_image),document.querySelector("#hero-trash").addEventListener("click",o)),0===document.querySelector("#thumbnail-image").value.length?(document.querySelector("#thumbnail-trash").removeEventListener("click",i),document.querySelector("#thumbnail-trash").addEventListener("click",exhibitsCommonFormModule.delete_thumbnail_image)):0!==document.querySelector("#thumbnail-image").value.length&&(document.querySelector("#thumbnail-trash").removeEventListener("click",exhibitsCommonFormModule.delete_thumbnail_image),document.querySelector("#thumbnail-trash").addEventListener("click",i))},500)}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e})();