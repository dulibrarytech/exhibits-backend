let itemsAddStandardItemFormModule=(()=>{let b=window.localStorage.getItem("exhibits_app_path"),v=endpointsModule.get_exhibits_endpoints(),S={};function l(e,t,i){var r,o;e&&(t=["info","success","danger","warning"].includes(t)?t:"info",(r=document.createElement("div")).className="alert alert-"+t,r.setAttribute("role","alert"),(o=document.createElement("i")).className={info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"}[t]||"fa fa-info",r.appendChild(o),t=document.createTextNode(" "+i),r.appendChild(t),e.textContent="",e.appendChild(r))}return S.create_item_record=async function(){var e=helperModule.get_parameter_by_name("item_id");if(e)return console.log("Item ID exists - already in edit mode, preventing duplicate creation"),console.log("Current URL:",window.location.href),console.log("item_id:",e),S.update_item_record&&"function"==typeof S.update_item_record?(console.log("Redirecting to update function..."),S.update_item_record()):(l(document.querySelector("#message"),"warning","Already in edit mode. Update function not available."),console.error("ERROR: update_item_record function not found!"),!1);if(console.log("CREATE FUNCTION CALLED - No item_id, proceeding with creation"),this._is_creating_item)return console.log("Already creating, preventing duplicate submission"),!1;this._is_creating_item=!0;try{var t=document.querySelector("#message");window.scrollTo({top:0,behavior:"smooth"});let r=helperModule.get_parameter_by_name("exhibit_id");if(!r)return l(t,"warning","Missing exhibit ID. Cannot create item record."),!1;l(t,"info","Creating item record...");var i=authModule.get_user_token();if(!i||!1===i)return l(t,"danger","Session expired. Please log in again."),setTimeout(()=>{authModule.logout()},1e3),!1;var a=itemsCommonStandardItemFormModule.get_common_standard_item_form_fields();if(!a||!1===a||void 0===a)return!1;var n=helperModule.get_user_name(),d=helperModule.get_owner();if(n&&(a.created_by=n),d&&(a.owner=d),!v?.exhibits?.item_records?.post?.endpoint)return l(t,"danger","API endpoint configuration missing"),!1;var c=v.exhibits.item_records.post.endpoint.replace(":exhibit_id",encodeURIComponent(r)),s=await httpModule.req({method:"POST",url:c,data:a,headers:{"Content-Type":"application/json","x-access-token":i},timeout:3e4});if(!s||201!==s.status)throw new Error("Failed to create item record");let o=s.data?.data;if(o)return console.log("✅ Item record created successfully, ID:",o),l(t,"success","Item record created successfully. Redirecting to edit page..."),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{{var t=r,i=o;console.log("=== REDIRECTING TO ITEM EDIT PAGE ==="),console.log("exhibit_id:",t),console.log("item_id:",i);let e="text";-1!==window.location.pathname.indexOf("media")?(e="media",console.log("Media form detected from URL path")):console.log("Text form detected (default)"),t=new URLSearchParams({exhibit_id:t,item_id:i}),i=`${b}/items/standard/${e}/edit?`+t.toString(),console.log("Item form type:",e),console.log("Redirecting to:",i),console.log("Note: Back button will NOT return to create page"),window.location.replace(i)}},1200),!0;throw new Error("Server did not return a valid item ID")}catch(e){return console.error("❌ Error creating item record:",e),l(document.querySelector("#message"),"danger",e.user_message||e.message||"Unable to create item record. Please try again."),!1}finally{this._is_creating_item=!1}},S.create_item_record__=async function(){if(this._is_creating_item)return!1;this._is_creating_item=!0;let t=document.querySelector("#message");let e=300;var i=(e,t,i)=>{var r,o;e&&(t=["info","success","danger","warning"].includes(t)?t:"danger",(r=document.createElement("div")).className="alert alert-"+t,r.setAttribute("role","alert"),(o=document.createElement("i")).className=a(t),r.appendChild(o),t=document.createTextNode(" "+i),r.appendChild(t),e.style.opacity="1",e.style.transition="",e.textContent="",e.appendChild(r))};let a=e=>({info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"})[e]||"fa fa-exclamation",r=()=>-1!==window.location.pathname.indexOf("media")?"media":"text";let o=(e,t,i)=>{var r;window.history?.pushState&&(r=new URLSearchParams({exhibit_id:e,item_id:t}),r=b+`/items/standard/${i}/edit?`+r.toString(),window.history.pushState({mode:"edit",exhibit_id:e,item_id:t,item_form:i},"",r))},n=e=>{document.title&&(document.title=e);var t=document.querySelector("h1, .page-title");t&&(t.textContent=e)},d=async()=>{"function"==typeof display_edit_record&&await display_edit_record()},c=()=>{var e=document.querySelector("form#item-form, form");e&&(e.onsubmit=async function(e){return e.preventDefault(),!(!S.update_item_record||"function"!=typeof S.update_item_record)&&S.update_item_record()},e=e.querySelector('input[name="mode"]'))&&(e.value="edit")},s=()=>{var e=document.querySelector('button[type="submit"], #submit-button');e&&((t=e.querySelector(".button-text"))?t.textContent="Update Item":e.querySelector("i")?e.childNodes.forEach(e=>{e.nodeType===Node.TEXT_NODE&&(e.textContent=" Update Item")}):e.textContent="Update Item"),document.querySelectorAll('.edit-only, [data-mode="edit"]').forEach(e=>{e.style.display="",e.classList.remove("hidden")});document.querySelectorAll('.create-only, [data-mode="create"]').forEach(e=>{e.style.display="none",e.classList.add("hidden")});var t=document.querySelector("#created, .metadata-section");t&&(t.style.display="block",t.classList.remove("hidden"))},l=(e,t)=>{var i=r(),e=new URLSearchParams({exhibit_id:e,item_id:t}),t=b+`/items/standard/${i}/edit?`+e.toString();window.location.replace(t)},m=null;try{window.scrollTo({top:0,behavior:"smooth"});var u=helperModule.get_parameter_by_name("exhibit_id");if(!u)return i(t,"warning","Missing exhibit ID. Cannot create item record."),!1;var _=authModule.get_user_token();if(!_||!1===_)return i(t,"danger","Session expired. Please log in again."),m=setTimeout(()=>{authModule.logout()},1e3),!1;var p=itemsCommonStandardItemFormModule.get_common_standard_item_form_fields();if(!p||!1===p||void 0===p)return i(t,"danger","Unable to get form field values. Please check all required fields."),!1;i(t,"info","Creating item record...");var g=helperModule.get_user_name(),h=helperModule.get_owner();if(g&&(p.created_by=g),h&&(p.owner=h),!v?.exhibits?.item_records?.post?.endpoint)return i(t,"danger","API endpoint configuration missing"),!1;var f=v.exhibits.item_records.post.endpoint.replace(":exhibit_id",encodeURIComponent(u)),y=await httpModule.req({method:"POST",url:f,data:p,headers:{"Content-Type":"application/json","x-access-token":_},timeout:3e4});if(!y||201!==y.status)throw new Error("Failed to create item record");var w=y.data?.data;if(w)return i(t,"success","Item record created successfully"),await(async(t,i)=>{try{var e=r();o(t,i,e),n("Edit Item"),await d(),c(),s()}catch(e){console.error("Error transitioning to edit mode:",e),l(t,i)}})(u,w),m=setTimeout(()=>{t&&(t.style.transition=`opacity ${e}ms ease-out`,t.style.opacity="0",setTimeout(()=>{t.textContent="",t.style.opacity="1",t.style.transition=""},e))},3e3),!0;throw new Error("Server did not return a valid item ID")}catch(e){m&&clearTimeout(m),console.error("Error creating item record:",e);var x=e.user_message||e.message||"Unable to create item record. Please try again.";return i(t,"danger",x),!1}finally{this._is_creating_item=!1}},S.init=async function(){try{var e=helperModule.get_parameter_by_name("exhibit_id"),t="/items?exhibit_id="+e+"&status=403";await authModule.check_permissions(["add_item","add_item_to_any_exhibit"],"item",e,null,t),exhibitsModule.set_exhibit_title(e),document.querySelector("#save-item-btn").addEventListener("click",itemsAddStandardItemFormModule.create_item_record),-1!==window.location.pathname.indexOf("media")&&await helperModule.create_subjects_menu()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},S})();