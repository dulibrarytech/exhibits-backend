let helperMediaModule=(()=>{let r={};return r.get_repo_item_data=async function(a){var i=()=>({message:document.querySelector("#message"),repo_uuid_input:document.querySelector("#repo-uuid"),repo_item_metadata:document.querySelector("#repo-item-metadata"),thumbnail:document.querySelector("#tn"),item_mime_type:document.querySelector("#item-mime-type"),item_type:document.querySelector("#item-type"),is_repo_item:document.querySelector("#is-repo-item"),image_alt_text:document.querySelector("#image-alt-text")}),r=(e,t,a)=>{var i,r;e&&(t=["info","success","danger","warning"].includes(t)?t:"danger",(i=document.createElement("div")).className="alert alert-"+t,i.setAttribute("role","alert"),(r=document.createElement("i")).className=(e=>{const t={info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"};return t[e]||"fa fa-exclamation"})(t),i.appendChild(r),t=document.createTextNode(" "+a),i.appendChild(t),e.textContent="",e.appendChild(i))};var n=(e,t)=>{var a;e&&((a=document.createElement("p")).style.color="red",a.textContent=t,e.textContent="",e.appendChild(a))};var l=(e,t)=>{var a,i,r,n=e.mime_type,l=(l=n)?-1!==(l=l.toLowerCase()).indexOf("image")?"image":-1!==l.indexOf("video")?"video":-1!==l.indexOf("audio")?"audio":-1!==l.indexOf("pdf")?"pdf":"unknown":"unknown",o=(t.thumbnail&&e.thumbnail?.data&&(a=helperMediaModule.render_repo_thumbnail(e.thumbnail.data),i=t.thumbnail,a=a,i)&&((r=document.createElement("img")).src=a,r.alt="Repository item thumbnail",r.height=200,r.width=200,r.style.border="solid",i.textContent="",i.appendChild(r)),t.item_mime_type&&(t.item_mime_type.value=n),t.item_type&&(t.item_type.value=l),t.repo_item_metadata&&(a=t.repo_item_metadata,i=e.title,r=n,a)&&(n=document.createElement("p"),(o=document.createElement("strong")).textContent=i,n.appendChild(o),i=document.createElement("br"),n.appendChild(i),(o=document.createElement("em")).textContent=r,n.appendChild(o),a.textContent="",a.appendChild(n)),t.is_repo_item&&(t.is_repo_item.value="1"),"image"==l&&t.image_alt_text&&(t.image_alt_text.style.display="block"),e.f_subjects);void 0===o&&0===o.length||helperModule.create_subjects_menu(o)};try{var o,d,m,u,c,s=i();let e=!0,t=a;if(null==t){if(!s.repo_uuid_input)return r(s.message,"danger","Repository UUID input field not found"),!1;t=s.repo_uuid_input.value.trim(),e=!1,"function"==typeof helperMediaModule?.clear_media_fields&&helperMediaModule.clear_media_fields("repo_media")}return t&&0!==t.length?(p=t)&&"string"==typeof p&&/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(p.trim())?(o=authModule.get_user_token())&&!1!==o?(d=endpointsModule.get_exhibits_endpoints())?.exhibits?.repo_items?.endpoint?(m=d.exhibits.repo_items.endpoint.replace(":uuid",encodeURIComponent(t)),(u=await httpModule.req({method:"GET",url:m,headers:{"Content-Type":"application/json","x-access-token":o},timeout:3e4}))&&200===u.status?u.data?.data?1===(c=u.data.data).is_compound||!0===c.is_compound?(n(s.repo_item_metadata,"Repository compound objects are not supported."),!1):(l(c,s),!0!==e||c):(n(s.repo_item_metadata,"Invalid response structure from repository."),!1):(n(s.repo_item_metadata,"Metadata record not found in repository."),!1)):(r(s.message,"danger","API endpoint configuration missing"),!1):(r(s.message,"danger","Session expired. Please log in again."),!1):(r(s.message,"danger","Invalid UUID format. Please check and try again."),!1):(r(s.message,"danger","Please enter a Repository UUID"),!1)}catch(e){console.error("Error fetching repository item data:",e);var a=i(),p=e.user_message||e.message||"Unable to fetch repository item data. Please try again.";return r(a.message,"danger",p),!1}},r.render_repo_thumbnail=function(t,a="image/jpeg"){var i,r=e=>{var t,a,i=document.querySelector("#message");i?((t=document.createElement("div")).className="alert alert-danger",t.setAttribute("role","alert"),(a=document.createElement("i")).className="fa fa-exclamation",t.appendChild(a),a=document.createTextNode(" "+e),t.appendChild(a),i.textContent="",i.appendChild(t)):console.error("Message element not found:",e)};try{var n=(i=t)?Array.isArray(i)||i instanceof Uint8Array||"object"==typeof i&&"number"==typeof i.length?0===i.length?{valid:!1,error:"Thumbnail data array is empty"}:10485760<i.length?{valid:!1,error:"Thumbnail data exceeds maximum size limit"}:{valid:!0}:{valid:!1,error:"Invalid thumbnail data format. Expected array or array-like object."}:{valid:!1,error:"Thumbnail data is required"};if(!n.valid)return r(n.error),null;var l=(e=>{if(e&&"string"==typeof e){var t=e.toLowerCase().trim();if(["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/svg+xml","image/bmp"].includes(t))return t;console.warn(`Invalid MIME type "${e}", using default image/jpeg`)}return"image/jpeg"})(a);let e;e=t instanceof Uint8Array?t:new Uint8Array(t);var o=new Blob([e],{type:l});if(!o||0===o.size)throw new Error("Failed to create blob from thumbnail data");if(!window.URL||"function"!=typeof window.URL.createObjectURL)throw new Error("Browser does not support URL.createObjectURL");var d=window.URL.createObjectURL(o);if(d)return console.log("Created object URL for thumbnail:",d),d;throw new Error("Failed to create object URL")}catch(e){return console.error("Error rendering repository thumbnail:",e),r(e.message||"Unable to render thumbnail. Please try again."),null}},r.revoke_thumbnail_url=function(e){if(e&&"string"==typeof e)try{window.URL&&"function"==typeof window.URL.revokeObjectURL&&(window.URL.revokeObjectURL(e),console.log("Revoked object URL:",e))}catch(e){console.error("Error revoking object URL:",e)}},r.display_repo_thumbnail_safe=function(t,a,i="image/jpeg"){if(a&&a instanceof HTMLImageElement){let e=r.render_repo_thumbnail(t,i);e?(a.src=e,a.onload=function(){setTimeout(()=>{r.revoke_thumbnail_url(e)},100)},a.onerror=function(){r.revoke_thumbnail_url(e),console.error("Failed to load thumbnail image")}):console.error("Failed to create thumbnail URL")}else console.error("Valid image element required")},r.clear_media_fields=function(e){var t,a,i;try{var r,n,l=["uploaded_media","repo_media","kaltura_media"];return e&&l.includes(e)?((n={uploaded_media:{clear_repo:!0,clear_kaltura:!0},repo_media:{clear_repo:!(r={repo_uuid:document.querySelector("#repo-uuid"),audio_video:document.querySelector("#audio-video"),is_kaltura_item:document.querySelector("#is-kaltura-item"),is_repo_item:document.querySelector("#is-repo-item"),item_type:document.querySelector("#item-type"),item_mime_type:document.querySelector("#item-mime-type"),item_media:document.querySelector("#item-media"),media_thumbnail_display:document.querySelector("#item-media-thumbnail-image-display"),media_filename_display:document.querySelector("#item-media-filename-display"),media_trash:document.querySelector("#item-media-trash")}),clear_kaltura:!0},kaltura_media:{clear_repo:!0,clear_kaltura:!1}}[e]).clear_repo&&((i=r).repo_uuid&&(i.repo_uuid.value=""),i.is_repo_item)&&(i.is_repo_item.value="0"),n.clear_kaltura&&((a=r).audio_video&&(a.audio_video.value=""),a.is_kaltura_item)&&(a.is_kaltura_item.value="0"),(t=r).item_type&&(t.item_type.value=""),t.item_mime_type&&(t.item_mime_type.value=""),t.item_media&&(t.item_media.value=""),t.media_thumbnail_display&&(t.media_thumbnail_display.textContent=""),t.media_filename_display&&(t.media_filename_display.textContent=""),t.media_trash&&(t.media_trash.style.display="none"),console.log("Media fields cleared for type: "+e),!0):(console.warn(`Invalid media type "${e}". Expected one of: `+l.join(", ")),!1)}catch(e){return console.error("Error clearing media fields:",e),!1}},r.get_kaltura_item_data=async function(a){var i=()=>({message:document.querySelector("#message"),audio_video_input:document.querySelector("#audio-video"),kaltura_item_data:document.querySelector("#kaltura-item-data"),kaltura_thumbnail:document.querySelector("#kaltura-thumbnail"),kaltura_item_type:document.querySelector("#kaltura-item-type")}),r=(e,t,a)=>{var i,r;e&&(t=["info","success","danger","warning"].includes(t)?t:"danger",(i=document.createElement("div")).className="alert alert-"+t,i.setAttribute("role","alert"),(r=document.createElement("i")).className=(e=>{const t={info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"};return t[e]||"fa fa-exclamation"})(t),i.appendChild(r),t=document.createTextNode(" "+a),i.appendChild(t),e.textContent="",e.appendChild(i))};var n=(e,t)=>{var a;e&&((a=document.createElement("p")).style.color="red",a.textContent=t,e.textContent="",e.appendChild(a))};var l=(e,t)=>{var a,i,r,n;t.kaltura_item_data&&(a=t.kaltura_item_data,i=e,a)&&(r=document.createElement("p"),(n=document.createElement("strong")).textContent=i.title||"Untitled",r.appendChild(n),r.appendChild(document.createElement("br")),n=document.createTextNode(" ("),r.appendChild(n),(n=document.createElement("em")).textContent=i.item_type||"unknown",r.appendChild(n),i=document.createTextNode(")"),r.appendChild(i),a.textContent="",a.appendChild(r)),t.kaltura_thumbnail&&e.thumbnail&&(t.kaltura_thumbnail.src=e.thumbnail,t.kaltura_thumbnail.alt=e.title||"Kaltura item thumbnail",t.kaltura_thumbnail.style.visibility="visible"),t.kaltura_item_type&&(t.kaltura_item_type.value=e.item_type||"")};try{var o=i();let e=!0,t=a;if(null==t){if(!o.audio_video_input)return r(o.message,"danger","Kaltura ID input field not found"),!1;t=o.audio_video_input.value.trim(),e=!1,"function"==typeof helperMediaModule?.clear_media_fields&&helperMediaModule.clear_media_fields("kaltura_media")}var d,m,u,c,s,p,_,y=(h=t)&&"string"==typeof h?0===(h=h.trim()).length?{valid:!1,error:"Please enter a Kaltura ID"}:(/^[0-9]_[a-zA-Z0-9_-]+$/.test(h)||console.warn(`Entry ID "${h}" has non-standard format`),50<h.length?{valid:!1,error:"Entry ID appears to be invalid (too long)"}:{valid:!0,id:h}):{valid:!1,error:"Entry ID is required"};return y.valid?(d=y.id,(m=authModule.get_user_token())&&!1!==m?(u=endpointsModule.get_exhibits_endpoints())?.exhibits?.kaltura_items?.endpoint?(c=u.exhibits.kaltura_items.endpoint.replace(":entry_id",encodeURIComponent(d)),(s=await httpModule.req({method:"GET",url:c,headers:{"Content-Type":"application/json","x-access-token":m},timeout:3e4}))&&200===s.status?s.data?.data?(p=s.data.data).item_type&&void 0!==p.item_type?(l(p,o),console.log("Kaltura item loaded:",d),!0!==e||p):(_=p.message||"Kaltura item is invalid or unavailable",n(o.kaltura_item_data,_),!1):(n(o.kaltura_item_data,"Invalid response structure from Kaltura service."),!1):(n(o.kaltura_item_data,"Kaltura item not found or unavailable."),!1)):(r(o.message,"danger","API endpoint configuration missing"),!1):(r(o.message,"danger","Session expired. Please log in again."),!1)):(r(o.message,"danger",y.error),!1)}catch(e){console.error("Error fetching Kaltura item data:",e);var a=i(),h=e.user_message||e.message||"Unable to fetch Kaltura item data. Please try again.";return r(a.message,"danger",h),!1}},r.toggle_alt_text=function(){var e,t,a,i,r,n,l=e=>{var t,a,i=document.querySelector("#message");i?((t=document.createElement("div")).className="alert alert-danger",t.setAttribute("role","alert"),(a=document.createElement("i")).className="fa fa-exclamation",t.appendChild(a),a=document.createTextNode(" "+e),t.appendChild(a),i.textContent="",i.appendChild(t)):console.error("Message element not found:",e)};try{var o,d=document.querySelector("#item-alt-text-input");return d?(o=!d.disabled,n=d.disabled=o,(r=d)&&(n?(r.setAttribute("aria-label","Alt text (decorative image - disabled)"),r.setAttribute("aria-disabled","true")):(r.setAttribute("aria-label","Alt text for image"),r.setAttribute("aria-disabled","false"))),i=o,(a=d)&&(i?(a.setAttribute("data-previous-value",a.value),a.value="",a.placeholder="Decorative image (no alt text needed)"):((i=a.getAttribute("data-previous-value"))&&(a.value=i,a.removeAttribute("data-previous-value")),a.placeholder="Enter descriptive alt text for the image")),e=o,(t=document.querySelector("#is-decorative-image, #image-is-decorative"))&&(t.checked=e),console.log(`Alt text input ${o?"disabled":"enabled"} (decorative: ${o})`),{disabled:o,is_decorative:o}):(console.error("Alt text input element (#item-alt-text-input) not found"),l("Alt text input field not found"),!1)}catch(e){return console.error("Error toggling alt text:",e),l("Unable to toggle alt text field. Please try again."),!1}},r.set_alt_text=function(e){try{var t=document.querySelector("#item-alt-text-input"),a=document.querySelector("#is-decorative-image, #image-is-decorative");return t?(null!=e.alt_text?(t.value=helperModule.unescape(e.alt_text)||"",t.disabled=!1,t.setAttribute("aria-label","Alt text for image"),t.setAttribute("aria-disabled","false"),a&&(a.checked=!1)):(t.value="",1!==e.is_decorative&&!0!==e.is_decorative||(t.disabled=!0,t.placeholder="Decorative image (no alt text needed)",a&&(a.checked=!0))),!0):(console.warn("Alt text input not found"),!1)}catch(e){return console.error("Error setting alt text:",e),!1}},r.validate_alt_text=function(){try{var e=document.querySelector("#item-alt-text-input"),a=document.querySelector("#item-type");if(a&&"image"!==a.value)return{valid:!0};if(!e)return{valid:!1,error:"Alt text field not found"};if(e.disabled)return{valid:!0,is_decorative:!0};let t=e.value.trim();return 0===t.length?{valid:!1,error:"Alt text is required for non-decorative images"}:["image","picture","photo","alt text","description"].some(e=>t.toLowerCase()===e)?{valid:!1,error:"Please provide descriptive alt text (avoid generic terms)"}:{valid:!0,alt_text:t}}catch(e){return console.error("Error validating alt text:",e),{valid:!1,error:"Validation error"}}},r.set_alt_text=function(e){let t=(e,t)=>{e&&(t?(e.setAttribute("aria-label","Alt text (decorative image - disabled)"),e.setAttribute("aria-disabled","true"),e.setAttribute("aria-required","false")):(e.setAttribute("aria-label","Alt text for image"),e.setAttribute("aria-disabled","false"),e.setAttribute("aria-required","true")))};var a,i,r,n,l;try{var o=(l=e)&&"object"==typeof l?(null!=l.is_alt_text_decorative&&0!==(l=l.is_alt_text_decorative)&&1!==l&&!0!==l&&!1!==l&&console.warn("Unexpected is_alt_text_decorative value:",l),{valid:!0}):{valid:!1,error:"Invalid record: must be an object"};if(!o.valid)return console.error(o.error),!1;var d={image_alt_text_container:document.querySelector("#image-alt-text"),is_alt_text_decorative:document.querySelector("#is-alt-text-decorative"),alt_text_input:document.querySelector("#item-alt-text-input")};if(!d.alt_text_input)return console.error("Alt text input element (#item-alt-text-input) not found"),!1;(n=d.image_alt_text_container)&&(n.style.display="block",void 0!==n.style.opacity)&&(n.style.opacity="0",n.style.transition="opacity 0.3s ease-in",n.style.opacity="1");var m=1===e.is_alt_text_decorative||!0===e.is_alt_text_decorative;return d.is_alt_text_decorative&&(d.is_alt_text_decorative.checked=m),m?((r=d).alt_text_input&&(r.alt_text_input.disabled=!0,r.alt_text_input.value="",r.alt_text_input.placeholder="Decorative image (no alt text needed)",t(r.alt_text_input,!0),r.alt_text_input.setAttribute("data-is-decorative","1")),console.log("Alt text set: decorative image")):(a=d,i=e.alt_text,a.alt_text_input&&(a.alt_text_input.disabled=!1,i=i?helperModule.unescape(i):"",a.alt_text_input.value=i,a.alt_text_input.placeholder="Enter descriptive alt text for the image",t(a.alt_text_input,!1),a.alt_text_input.removeAttribute("data-is-decorative")),console.log("Alt text set:",e.alt_text||"(empty)")),!0}catch(e){return console.error("Error setting alt text:",e),!1}},r.clear_alt_text=function(){try{var e=document.querySelector("#item-alt-text-input"),t=document.querySelector("#is-alt-text-decorative");return e&&(e.value="",e.disabled=!1,e.placeholder="Enter descriptive alt text for the image",e.removeAttribute("data-is-decorative")),t&&(t.checked=!1),!0}catch(e){return console.error("Error clearing alt text:",e),!1}},r.get_alt_text_data=function(){try{var e,t=document.querySelector("#item-alt-text-input"),a=document.querySelector("#is-alt-text-decorative");return t?{alt_text:(e=t.disabled||a&&a.checked)?"":t.value.trim(),is_alt_text_decorative:e?1:0}:null}catch(e){return console.error("Error getting alt text data:",e),null}},r.validate_alt_text_submission=function(){try{var e=document.querySelector("#item-alt-text-input"),a=document.querySelector("#item-type");if(!a||"image"!==a.value)return{valid:!0};if(!e)return{valid:!1,error:"Alt text field not found"};if(e.disabled)return{valid:!0,is_decorative:!0};let t=e.value.trim();return 0===t.length?{valid:!1,error:"Alt text is required for non-decorative images",field:e}:t.length<3?{valid:!1,error:"Alt text must be at least 3 characters long",field:e}:["image","picture","photo","img","alt text","description","graphic"].some(e=>t.toLowerCase()===e)?{valid:!1,error:'Please provide descriptive alt text (avoid generic terms like "image" or "picture")',field:e}:{valid:!0,alt_text:t}}catch(e){return console.error("Error validating alt text:",e),{valid:!1,error:"Validation error occurred"}}},r.delete_thumbnail_image=function(){try{(async()=>{var e=endpointsModule.get_exhibits_endpoints(),t=document.querySelector("#item-thumbnail").value,a=authModule.get_user_token();void 0!==(e=await httpModule.req({method:"DELETE",url:e.exhibits.media.delete.endpoint+"?media="+t,headers:{"Content-Type":"application/json","x-access-token":a}}))&&204===e.status&&(document.querySelector("#item-thumbnail").value="",document.querySelector("#item-thumbnail-image-display").innerHTML="",document.querySelector("#item-thumbnail-filename-display").innerHTML="",document.querySelector("#item-thumbnail-trash").style.display="none",document.querySelector("#item-media-thumbnail-image-display").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Thumbnail image deleted</div>',setTimeout(()=>{document.querySelector("#message").innerHTML=""},3e3))})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}return!1},r.delete_media=function(){try{(async()=>{var e=endpointsModule.get_exhibits_endpoints(),t=document.querySelector("#item-media").value,a=authModule.get_user_token();void 0!==(e=await httpModule.req({method:"DELETE",url:e.exhibits.media.delete.endpoint+"?media="+t,headers:{"Content-Type":"application/json","x-access-token":a}}))&&204===e.status&&(document.querySelector("#item-type").value="",document.querySelector("#item-mime-type").value="",document.querySelector("#item-media").value="",document.querySelector("#item-media-thumbnail-image-display").innerHTML="",document.querySelector("#item-media-filename-display").innerHTML="",document.querySelector("#item-media-trash").style.display="none",document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Media deleted</div>',document.querySelector("#toggle-open-to-page").style.visibility="hidden",document.querySelector("#image-alt-text").style.display="none",setTimeout(()=>{document.querySelector("#message").innerHTML=""},3e3))})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}return!1},r.delete_media_edit=async function(){if(this._is_deleting_media)return!1;this._is_deleting_media=!0;let t=document.querySelector("#message");let e=300;var a=(e,t,a)=>{var i,r;e&&(t=["info","success","danger","warning"].includes(t)?t:"danger",(i=document.createElement("div")).className="alert alert-"+t,i.setAttribute("role","alert"),(r=document.createElement("i")).className=n(t),i.appendChild(r),t=document.createTextNode(" "+a),i.appendChild(t),e.style.opacity="1",e.style.transition="",e.textContent="",e.appendChild(i))};let n=e=>({info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"})[e]||"fa fa-exclamation";var i,r,l,o,d,m,u,c;let s=null;try{var p=helperModule.get_parameter_by_name("exhibit_id"),_=helperModule.get_parameter_by_name("item_id"),y=document.querySelector("#item-media");if(!y)return a(t,"danger","Media input element not found"),!1;var h=y.value,g=(u=_,c=h,(m=p)&&u&&c?255<m.length||255<u.length||255<c.length?{valid:!1,error:"Invalid parameter length"}:{valid:!0}:{valid:!1,error:"Missing required parameters: exhibit_id, item_id, or media filename"});if(!g.valid)return a(t,"danger",g.error),!1;var v=authModule.get_user_token();if(!v||!1===v)return a(t,"danger","Session expired. Please log in again."),s=setTimeout(()=>{authModule.logout()},1e3),!1;var b=endpointsModule.get_exhibits_endpoints();if(!b?.exhibits?.item_media?.delete?.endpoint)return a(t,"danger","API endpoint configuration missing"),!1;var f=-1!==(d=window.location.pathname).indexOf("items/standard/media")?"standard_item":-1!==d.indexOf("items/grid/item/media")?"grid_item":-1!==d.indexOf("items/vertical-timeline/item/media")?"timeline_item":"standard_item",x=(console.log("Item type detected:",f),console.log("Current pathname:",window.location.pathname),b.exhibits.item_media.delete.endpoint.replace(":exhibit_id",encodeURIComponent(p)).replace(":item_id",encodeURIComponent(_)).replace(":media",encodeURIComponent(h))),q=x+"?"+new URLSearchParams({type:f}).toString(),S=await httpModule.req({method:"DELETE",url:q,headers:{"Content-Type":"application/json","x-access-token":v},timeout:3e4});if(S&&204===S.status)return i=document.querySelector("#item-media"),r=document.querySelector("#item-media-filename-display"),l=document.querySelector("#item-media-trash"),o=document.querySelector("#item-media-thumbnail-image-display"),i&&(i.value=""),r&&(r.textContent=""),l&&(l.style.display="none"),o&&(o.textContent=""),a(t,"success","Media deleted successfully"),s=setTimeout(()=>{t&&(t.style.transition=`opacity ${e}ms ease-out`,t.style.opacity="0",setTimeout(()=>{t.textContent="",t.style.opacity="1",t.style.transition=""},e))},3e3),!0;throw new Error("Failed to delete media file")}catch(e){s&&clearTimeout(s),console.error("Error deleting media:",e);var k=e.user_message||e.message||"Unable to delete media. Please try again.";return a(t,"danger",k),!1}finally{this._is_deleting_media=!1}},r.delete_thumbnail_image_edit=async function(){if(this._is_deleting_thumbnail)return!1;this._is_deleting_thumbnail=!0,console.log("DELETE MEDIA THUMBNAIL");let t=document.querySelector("#message");let e=300;var a=(e,t,a)=>{var i,r;e&&(t=["info","success","danger","warning"].includes(t)?t:"danger",(i=document.createElement("div")).className="alert alert-"+t,i.setAttribute("role","alert"),(r=document.createElement("i")).className=n(t),i.appendChild(r),t=document.createTextNode(" "+a),i.appendChild(t),e.style.opacity="1",e.style.transition="",e.textContent="",e.appendChild(i))};let n=e=>({info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"})[e]||"fa fa-exclamation";var i,r,l,o,d,m,u,c;let s=null;try{var p=helperModule.get_parameter_by_name("exhibit_id"),_=helperModule.get_parameter_by_name("item_id"),y=document.querySelector("#item-thumbnail");if(!y)return a(t,"danger","Thumbnail input element not found"),!1;var h=y.value,g=(u=_,c=h,(m=p)&&u&&c?255<m.length||255<u.length||255<c.length?{valid:!1,error:"Invalid parameter length"}:{valid:!0}:{valid:!1,error:"Missing required parameters: exhibit_id, item_id, or thumbnail filename"});if(!g.valid)return a(t,"danger",g.error),!1;var v=authModule.get_user_token();if(!v||!1===v)return a(t,"danger","Session expired. Please log in again."),s=setTimeout(()=>{authModule.logout()},1e3),!1;var b=endpointsModule.get_exhibits_endpoints();if(!b?.exhibits?.item_media?.delete?.endpoint)return a(t,"danger","API endpoint configuration missing"),!1;var f=-1!==(d=window.location.pathname).indexOf("items/standard/media")?"standard_item":-1!==d.indexOf("items/grid/item/media")?"grid_item":-1!==d.indexOf("items/vertical-timeline/item/media")?"timeline_item":"standard_item",x=b.exhibits.item_media.delete.endpoint.replace(":exhibit_id",encodeURIComponent(p)).replace(":item_id",encodeURIComponent(_)).replace(":media",encodeURIComponent(h))+"?"+new URLSearchParams({type:f}).toString(),q=await httpModule.req({method:"DELETE",url:x,headers:{"Content-Type":"application/json","x-access-token":v},timeout:3e4});if(q&&204===q.status)return i=document.querySelector("#item-thumbnail"),r=document.querySelector("#item-thumbnail-filename-display"),l=document.querySelector("#item-thumbnail-trash"),o=document.querySelector("#item-thumbnail-image-display"),i&&(i.value=""),r&&(r.textContent=""),l&&(l.style.display="none"),o&&(o.textContent=""),a(t,"success","Thumbnail deleted successfully"),s=setTimeout(()=>{t&&(t.style.transition=`opacity ${e}ms ease-out`,t.style.opacity="0",setTimeout(()=>{t.textContent="",t.style.opacity="1",t.style.transition=""},e))},3e3),!0;throw new Error("Failed to delete thumbnail")}catch(e){s&&clearTimeout(s),console.error("Error deleting thumbnail:",e);var S=e.user_message||e.message||"Unable to delete thumbnail. Please try again.";return a(t,"danger",S),!1}finally{this._is_deleting_thumbnail=!1}},r.process_media_fields_common=function(e){var t=[],a=(e.description=document.querySelector("#item-description-input").value,e.caption=document.querySelector("#item-caption-input").value,e.pdf_open_to_page=document.querySelector("#pdf-open-to-page").value,e.is_alt_text_decorative=document.querySelector("#is-alt-text-decorative").checked,document.querySelector("#embed-item")),i=document.querySelector("#wrap-text"),r=document.querySelector("#media-padding");return a&&(e.is_embedded=a.checked),i&&(e.media_padding=i.checked),r&&(e.media_padding=r.checked),!0===e.wrap_text?e.wrap_text=1:!1===e.wrap_text&&(e.wrap_text=0),!0===e.is_embedded?e.is_embedded=1:!1===e.is_embedded&&(e.is_embedded=0),!0===e.media_padding?e.media_padding=0:!1===e.media_padding&&(e.media_padding=1),e.thumbnail=document.querySelector("#item-thumbnail").value,e.thumbnail_prev=document.querySelector("#item-thumbnail-image-prev").value,e.item_type=document.querySelector("#item-type").value,e.mime_type=document.querySelector("#item-mime-type").value,e.media=document.querySelector("#item-media").value,e.media_prev=document.querySelector("#item-media-prev").value,e.kaltura=document.querySelector("#audio-video").value,e.repo_uuid=document.querySelector("#repo-uuid").value,e.is_repo_item=parseInt(document.querySelector("#is-repo-item").value),e.is_kaltura_item=parseInt(document.querySelector("#is-kaltura-item").value),0<e.media.length&&0<e.repo_uuid.length&&e.media===e.repo_uuid&&(e.repo_uuid=""),0<e.media.length&&0<e.kaltura.length&&e.media===e.kaltura&&(e.kaltura=""),0<e.media.length&&t.push(e.media),0<e.kaltura.length&&(t.push(e.kaltura),e.item_type="kaltura"),0<e.repo_uuid.length&&t.push(e.repo_uuid),1<t.length?!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Please upload or import only one media item</div>'):("kaltura"===e.item_type&&(e.item_type=document.querySelector("#kaltura-item-type").value),e)},r.display_media_fields_common=async function(e){let i=(e,t="Thumbnail")=>{var a=document.createElement("p"),i=document.createElement("img");return i.src=e,i.alt=t,i.height=200,a.appendChild(i),a},r=(e,t,a="Thumbnail")=>{e&&(e.textContent="",t=i(t,a),e.appendChild(t))},n=(e,t)=>{var a;e&&((a=document.createElement("span")).style.fontSize="11px",a.textContent=t,e.textContent="",e.appendChild(a))},t=(e,t)=>{e={upload:{tab:e.upload_media_tab,content:e.upload_media},repo:{tab:e.import_repo_media_tab,content:e.import_repo_media},kaltura:{tab:e.import_audio_video_tab,content:e.import_audio_video}},Object.values(e).forEach(({tab:e,content:t})=>{e&&(e.classList.remove("active"),e.setAttribute("aria-selected","false")),t&&t.classList.remove("active","show")}),e=e[t];e&&(e.tab&&(e.tab.classList.add("active"),e.tab.setAttribute("aria-selected","true")),e.content)&&e.content.classList.add("show","active")};var a,l,o,d,m,u,c,s,p,_=(e,t,a)=>{var i;0===e.is_repo_item&&0===e.is_kaltura_item&&((a=((e,t,a)=>{switch(e){case"image":return a.exhibits.exhibit_media.get.endpoint.replace(":exhibit_id",encodeURIComponent(t.is_member_of_exhibit)).replace(":media",encodeURIComponent(t.media));case"video":return"/exhibits-dashboard/static/images/video-tn.png";case"audio":return"/exhibits-dashboard/static/images/audio-tn.png";case"pdf":return"/exhibits-dashboard/static/images/pdf-tn.png";default:return null}})(i=(i=e.mime_type)?-1!==(i=i.toLowerCase()).indexOf("image")?"image":-1!==i.indexOf("video")?"video":-1!==i.indexOf("audio")?"audio":-1!==i.indexOf("pdf")?"pdf":"unknown":"unknown",e,a))?(r(t.media_thumbnail_display,a,"Media thumbnail"),"image"==i&&"function"==typeof helperMediaModule?.set_alt_text&&helperMediaModule.set_alt_text(e),"pdf"==i&&t.toggle_open_to_page&&(t.toggle_open_to_page.style.visibility="visible")):console.log("Unable to determine media type:",e.mime_type),t.media_filename_display&&e.media&&n(t.media_filename_display,e.media),t.media_trash)&&(t.media_trash.style.display="inline")};try{return e?(a={description_input:document.querySelector("#item-description-input"),caption_input:document.querySelector("#item-caption-input"),pdf_open_to_page:document.querySelector("#pdf-open-to-page"),embed_item:document.querySelector("#embed-item"),wrap_text:document.querySelector("#wrap-text"),media_padding:document.querySelector("#media-padding"),item_type:document.querySelector("#item-type"),item_mime_type:document.querySelector("#item-mime-type"),item_media:document.querySelector("#item-media"),item_media_prev:document.querySelector("#item-media-prev"),item_thumbnail:document.querySelector("#item-thumbnail"),item_thumbnail_prev:document.querySelector("#item-thumbnail-image-prev"),media_trash:document.querySelector("#item-media-trash"),media_filename_display:document.querySelector("#item-media-filename-display"),media_thumbnail_display:document.querySelector("#item-media-thumbnail-image-display"),thumbnail_trash:document.querySelector("#item-thumbnail-trash"),thumbnail_filename_display:document.querySelector("#item-thumbnail-filename-display"),thumbnail_image_display:document.querySelector("#item-thumbnail-image-display"),toggle_open_to_page:document.querySelector("#toggle-open-to-page"),repo_uuid:document.querySelector("#repo-uuid"),is_repo_item:document.querySelector("#is-repo-item"),audio_video:document.querySelector("#audio-video"),is_kaltura_item:document.querySelector("#is-kaltura-item"),kaltura_item_type:document.querySelector("#kaltura-item-type"),upload_media_tab:document.getElementById("upload-media-tab"),import_repo_media_tab:document.getElementById("import-repo-media-tab"),import_audio_video_tab:document.getElementById("import-audio-video-tab"),upload_media:document.getElementById("upload-media"),import_repo_media:document.getElementById("import-repo-media"),import_audio_video:document.getElementById("import-audio-video")},(l=endpointsModule.get_exhibits_endpoints())?.exhibits?.exhibit_media?.get?.endpoint?(a.description_input&&(a.description_input.value=helperModule.unescape(e.description)||""),a.caption_input&&(a.caption_input.value=helperModule.unescape(e.caption)||""),a.pdf_open_to_page&&(a.pdf_open_to_page.value=e.pdf_open_to_page||""),a.embed_item&&(a.embed_item.checked=1===e.is_embedded),a.wrap_text&&(a.wrap_text.checked=1===e.wrap_text),a.media_padding&&(a.media_padding.checked=0===e.media_padding),e.media&&0<e.media.length&&(1===e.is_repo_item?(p=a,await(!(s=e).is_repo_item||1!==s.is_repo_item||(t(p,"repo"),p.repo_uuid&&(p.repo_uuid.value=s.media||""),p.is_repo_item&&(p.is_repo_item.value="1"),"function"==typeof helperMediaModule?.get_repo_item_data&&await helperMediaModule.get_repo_item_data(null),"image"!==s.item_type)||"function"!=typeof helperMediaModule?.set_alt_text||!helperMediaModule.set_alt_text(s))):1===e.is_kaltura_item?(c=a,await!((u=e).is_kaltura_item&&1===u.is_kaltura_item&&(t(c,"kaltura"),c.audio_video&&(c.audio_video.value=u.media||""),c.is_kaltura_item&&(c.is_kaltura_item.value="1"),"function"==typeof helperMediaModule?.get_kaltura_item_data&&await helperMediaModule.get_kaltura_item_data(null),c.kaltura_item_type&&(c.kaltura_item_type.value=u.item_type||""),c.item_type)&&(c.item_type.value="kaltura"))):_(e,a,l),a.item_type&&(a.item_type.value=e.item_type||""),a.item_mime_type&&(a.item_mime_type.value=helperModule.unescape(e.mime_type)||""),a.item_media&&(a.item_media.value=e.media),a.item_media_prev)&&(a.item_media_prev.value=e.media),d=a,m=l,(o=e).thumbnail&&0!==o.thumbnail.length&&(m=m.exhibits.exhibit_media.get.endpoint.replace(":exhibit_id",encodeURIComponent(o.is_member_of_exhibit)).replace(":media",encodeURIComponent(o.thumbnail)),r(d.thumbnail_image_display,m,"Item thumbnail"),d.thumbnail_filename_display&&n(d.thumbnail_filename_display,o.thumbnail),d.item_thumbnail&&(d.item_thumbnail.value=o.thumbnail),d.item_thumbnail_prev&&(d.item_thumbnail_prev.value=o.thumbnail),d.thumbnail_trash)&&(d.thumbnail_trash.style.display="inline"),!0):(console.error("API endpoint configuration missing"),!1)):(console.error("No record provided to display_media_fields_common"),!1)}catch(e){return console.error("Error in display_media_fields_common:",e),!1}},r.media_common_init=function(){uploadsModule.upload_item_media(),uploadsModule.upload_item_thumbnail();let e=document.querySelector("#item-media-trash"),t=document.querySelector("#item-thumbnail-trash");var a=document.querySelector("#is-media-only-description"),i=document.querySelector("#is-media-only-caption");e&&(e.style.display="none"),t&&(t.style.display="none"),a&&(a.style.display="block"),i&&(i.style.display="block"),setTimeout(()=>{t.addEventListener("click",helperMediaModule.delete_thumbnail_image),e.addEventListener("click",helperMediaModule.delete_media)},1e3),document.querySelector("#repo-uuid-btn").addEventListener("click",async()=>{await helperMediaModule.get_repo_item_data(null)}),document.querySelector("#kaltura-btn").addEventListener("click",async()=>{await helperMediaModule.get_kaltura_item_data(null)})},r.media_edit_init=function(){setTimeout(()=>{0===document.querySelector("#item-media").value.length?(document.querySelector("#item-media-trash").removeEventListener("click",helperMediaModule.delete_media_edit),document.querySelector("#item-media-trash").addEventListener("click",helperMediaModule.delete_media)):0!==document.querySelector("#item-media").value&&(document.querySelector("#item-media-trash").removeEventListener("click",helperMediaModule.delete_media),document.querySelector("#item-media-trash").addEventListener("click",helperMediaModule.delete_media_edit)),0===document.querySelector("#item-thumbnail").value.length?(document.querySelector("#item-thumbnail-trash").removeEventListener("click",helperMediaModule.delete_thumbnail_image_edit),document.querySelector("#item-thumbnail-trash").addEventListener("click",helperMediaModule.delete_thumbnail_image)):0!==document.querySelector("#item-thumbnail").value.length&&(document.querySelector("#item-thumbnail-trash").removeEventListener("click",helperMediaModule.delete_thumbnail_image),document.querySelector("#item-thumbnail-trash").addEventListener("click",helperMediaModule.delete_thumbnail_image_edit))},1e3)},r.init=function(){document.querySelector("#is-alt-text-decorative")&&document.querySelector("#is-alt-text-decorative").addEventListener("click",()=>{helperMediaModule.toggle_alt_text()})},r})();helperMediaModule.init();