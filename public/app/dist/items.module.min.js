let itemsModule=(()=>{let m=window.localStorage.getItem("exhibits_app_path"),a=endpointsModule.get_exhibits_endpoints();var e={};async function c(s){try{let l=helperModule.get_parameter_by_name("exhibit_id");var e=s,i=document.getElementsByTagName("tr");let t;for(let e=0;e<i.length;e++)if(0!==i[e].id.length&&-1!==i[e].id.indexOf(s)){var a=i[e].id.split("_");t=a.pop();break}var r=endpointsModule.get_exhibits_endpoints().exhibits.item_records.item_publish.post.endpoint.replace(":exhibit_id",l).replace(":item_id",e),d=authModule.get_user_token(),n=await httpModule.req({method:"POST",url:r+"?type="+t,headers:{"Content-Type":"application/json","x-access-token":d}});return void 0!==n&&200===n.status&&(setTimeout(()=>{let t=document.getElementById(s);document.getElementById(s).classList.remove("publish-item"),document.getElementById(s).classList.add("suppress-item"),document.getElementById(s).replaceWith(t.cloneNode(!0)),document.getElementById(s).innerHTML='<span id="suppress" title="published"><i class="fa fa-cloud" style="color: green"></i><br>Published</span>',document.getElementById(s).addEventListener("click",async e=>{e.preventDefault(),await o(t.getAttribute("id"))},!1)},0),setTimeout(()=>{var e=Array.from(document.querySelectorAll("tr")).map(e=>e.id).filter(e=>e).find(e=>{e=e.split("_");return s===e[0]}).split("_");let i,t="";if("item"===e[1]){var a=JSON.parse(window.localStorage.getItem("items"));let t;for(let e=0;e<a.length;e++)if(a[e].uuid===s){t=a[e].item_type;break}i="text"===t?`${m}/items/standard/text/edit?exhibit_id=${l}&item_id=`+s:`${m}/items/standard/media/edit?exhibit_id=${l}&item_id=`+s}"heading"===e[1]?i=`${m}/items/heading/details?exhibit_id=${l}&item_id=`+s:"grid"===e[1]?(i=`${m}/items/grid/edit?exhibit_id=${l}&item_id=`+s,t=`<a href="${m}/items/grid/items?exhibit_id=${l}&grid_id=${s}" title="View grid Items" aria-label="view-grid-items"><i class="fa fa-list pr-1"></i></a>`):"timeline"===e[1]&&(i=`${m}/items/vertical-timeline/edit?exhibit_id=${l}&item_id=`+s,t=`<a href="${m}/items/timeline/items?exhibit_id=${l}&timeline_id=${s}" title="View Timeline Items" aria-label="view-timeline-items"><i class="fa fa-list pr-1"></i></a>`);var e=document.getElementById(s+"-item-actions"),r=`<a href="${i}" title="View details" aria-label="item-details"><i class="fa fa-folder-open pr-1"></i> </a>`;e.innerHTML=`
                        <div class="card-text text-sm-center">
                        ${t}&nbsp;
                        ${r}&nbsp;
                        <i title="Can only delete if unpublished" style="color: #d3d3d3" class="fa fa-trash pr-1" aria-label="delete-exhibit"></i>
                        </div>`},0)),void 0!==n&&204===n.status?(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-warning" role="alert"><i class="fa fa-warning"></i> Exhibit must be published in order to publish this item</div>',setTimeout(()=>{document.querySelector("#message").innerHTML=""},5e3)):void 0===n&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-danger"></i> You do not have permission to publish this record.</div>'),!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}async function o(o){try{let n=helperModule.get_parameter_by_name("exhibit_id");var e=o,i=document.getElementsByTagName("tr");let t;for(let e=0;e<i.length;e++)if(0!==i[e].id.length&&-1!==i[e].id.indexOf(o)){var a=i[e].id.split("_");t=a.pop();break}var r=endpointsModule.get_exhibits_endpoints().exhibits.item_records.item_suppress.post.endpoint.replace(":exhibit_id",n).replace(":item_id",e),l=authModule.get_user_token(),s=await httpModule.req({method:"POST",url:r+"?type="+t,headers:{"Content-Type":"application/json","x-access-token":l}});return void 0!==s&&200===s.status?(setTimeout(()=>{let t=document.getElementById(o);document.getElementById(o).classList.remove("suppress-item"),document.getElementById(o).classList.add("publish-item"),document.getElementById(o).replaceWith(t.cloneNode(!0)),document.getElementById(o).innerHTML='<span id="publish" title="suppressed"><i class="fa fa-cloud-upload" style="color: darkred"></i><br>Unpublished</span>',document.getElementById(o).addEventListener("click",async e=>{e.preventDefault(),await c(t.getAttribute("id"))},!1)},0),setTimeout(()=>{let t=Array.from(document.querySelectorAll("tr")).map(e=>e.id).filter(e=>e).find(e=>{e=e.split("_");return o===e[0]}).split("_"),e,i="item",a="";if("item"===t[1]){var r=JSON.parse(window.localStorage.getItem("items"));for(let e=0;e<r.length;e++)if(r[e].uuid===o){t=r[e].item_type;break}e="text"===t?`${m}/items/standard/text/edit?exhibit_id=${n}&item_id=`+o:`${m}/items/standard/media/edit?exhibit_id=${n}&item_id=`+o}"heading"===t[1]?(e=`${m}/items/heading/edit?exhibit_id=${n}&item_id=`+o,i="heading"):"grid"===t[1]?(e=`${m}/items/grid/edit?exhibit_id=${n}&item_id=`+o,i="grid",a=`<a href="${m}/items/grid/items?exhibit_id=${n}&grid_id=${o}" title="View grid Items" aria-label="view-grid-items"><i class="fa fa-list pr-1"></i></a>`):"timeline"===t[1]&&(e=`${m}/items/vertical-timeline/edit?exhibit_id=${n}&item_id=`+o,i="timeline",a=`<a href="${m}/items/timeline/items?exhibit_id=${n}&timeline_id=${o}" title="View Timeline Items" aria-label="view-timeline-items"><i class="fa fa-list pr-1"></i></a>`);var l=`${m}/items/delete?exhibit_id=${n}&item_id=${o}&type=`+i,s=document.getElementById(o+"-item-actions"),d=`<a href="${e}" title="Edit item" aria-label="edit-item"><i class="fa fa-edit pr-1"></i> </a>`;s.innerHTML=`
                        <div class="card-text text-sm-center">
                        ${a}&nbsp;
                        ${d}&nbsp;
                        ${`<a href="${l}" title="Delete item" aria-label="delete-item"><i class="fa fa-trash pr-1"></i></a>`}
                        </div>`},0)):void 0===s&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-danger"></i> You do not have permission to unpublish this record.</div>'),!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}return e.get_items=async function(e){try{var t=authModule.get_user_token(),i=await httpModule.req({method:"GET",url:a.exhibits.item_records.endpoint.replace(":exhibit_id",e),headers:{"Content-Type":"application/json","x-access-token":t}});if(void 0!==i&&200===i.status)return window.localStorage.removeItem("items"),window.localStorage.setItem("items",JSON.stringify(i.data.data)),i.data.data}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.display_items=async function(){try{var e=helperModule.get_parameter_by_name("exhibit_id"),i=await itemsModule.get_items(e);let t="";var a=[];if(!1===i)return document.querySelector("#item-card").innerHTML="",!1;if(0===i.length)return document.querySelector(".card").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><span id="exhibit-title"></span> exhibit is empty.</div>',await exhibitsModule.set_exhibit_title(e),!1;for(let e=0;e<i.length;e++){var r=i[e].type,l=i[e];switch(a.push(i[e].order),r){case"heading":t+=await itemsListDisplayModule.display_heading_items(l);break;case"item":t+=await itemsListDisplayModule.display_standard_items(l);break;case"grid":t+=await itemsListDisplayModule.display_grids(l);break;case"vertical_timeline":t+=await itemsListDisplayModule.display_timelines(l);break;default:console.log("Item type not available")}}document.querySelector("#item-data").innerHTML=t,new DataTable("#items",{paging:!1,rowReorder:!0}).on("row-reordered",async(e,t)=>{await helperModule.reorder_items(e,t)});try{Array.from(document.getElementsByClassName("publish-item")).forEach(t=>{t.addEventListener("click",async e=>{e.preventDefault(),await c(t.getAttribute("id"))})})}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}try{Array.from(document.getElementsByClassName("suppress-item")).forEach(t=>{t.addEventListener("click",async e=>{e.preventDefault(),await o(t.getAttribute("id"))})})}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}var s=helperModule.get_parameter_by_name("id"),d=helperModule.get_parameter_by_name("type");null!==s&&null!==d&&(history.replaceState({},"",m+"/exhibits?exhibit_id="+e),history.pushState({},"",m+"/exhibits?exhibit_id="+e),location.href="#"+s+"_"+d)}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.delete_item=async function(){try{document.querySelector("#delete-message").innerHTML="Deleting item...";var t=endpointsModule.get_exhibits_endpoints();let e=helperModule.get_parameter_by_name("exhibit_id");var i=helperModule.get_parameter_by_name("item_id"),a=helperModule.get_parameter_by_name("type"),r=authModule.get_user_token(),l=t.exhibits.item_records.delete.endpoint.replace(":exhibit_id",e).replace(":item_id",i),s=await httpModule.req({method:"DELETE",url:l+"?type="+a,headers:{"Content-Type":"application/json","x-access-token":r}});void 0!==s&&204===s.status?setTimeout(()=>{window.location.replace(m+"/items?exhibit_id="+e)},900):void 0===s&&(scrollTo(0,0),document.querySelector("#delete-card").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> You do not have permission to delete this record.</div>')}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.init=function(e){try{let e=helperModule.get_parameter_by_name("exhibit_id");var t=helperModule.get_parameter_by_name("status");null!==t&&"403"===t&&(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> You do not have permission to add item.</div>',setTimeout(()=>{window.history.replaceState({page:"items"},"","/exhibits-dashboard/items?exhibit_id="+e)},0)),(async()=>{var e=authModule.get_user_token();await authModule.check_auth(e)})(),exhibitsModule.set_exhibit_title(e),itemsModule.display_items(),helperModule.show_form(),navModule.set_preview_link(),navModule.set_item_nav_menu_links(),navModule.set_logout_link()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e})();