let helperMediaModule=(()=>{var e={get_repo_item_data:async function(e){try{var a=endpointsModule.get_exhibits_endpoints();let t=!0;null===e&&(e=document.querySelector("#repo-uuid").value,helperMediaModule.clear_media_fields("repo_media"),t=!1),0===e.length&&(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Please enter a Repository UUID</div>');var i=authModule.get_user_token(),l=await httpModule.req({method:"GET",url:a.exhibits.repo_items.endpoint.replace(":uuid",e),headers:{"Content-Type":"application/json","x-access-token":i}});if(void 0!==l&&200===l.status){if(1===l.data.data.is_compound)return!(document.querySelector("#repo-item-metadata").innerHTML='<p style="color:red">Repository compound objects are not supported.</p>');var d=l.data.data.mime_type;let e;var r,n=document.querySelector("#tn"),o=document.querySelector("#item-mime-type"),m=document.querySelector("#item-type"),u=document.querySelector("#repo-item-metadata"),c=document.querySelector("#is-repo-item");return null!==n&&(r=helperMediaModule.render_repo_thumbnail(l.data.data.thumbnail.data),n.innerHTML=`<img src="${r}" alt="thumbnail" height="200" width="200" style="border: solid"">`),null!==o&&(o.value=d),-1!==d.indexOf("image")?(e="image",null!==document.querySelector("#image-alt-text")&&(document.querySelector("#image-alt-text").style.display="block")):e=-1!==d.indexOf("video")?"video":-1!==d.indexOf("audio")?"audio":-1!==d.indexOf("pdf")?"pdf":"Unable to Determine Type",null!==m&&(m.value=e),null!==u&&(u.innerHTML=`<p><strong>${l.data.data.title}</strong><br><em>${d}</em></p>`),null!==c&&(c.value=1),!0===t?l.data.data:void 0}document.querySelector("#repo-item-metadata").innerHTML='<p style="color:red">Metadata record not found in repository.</p>'}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},render_repo_thumbnail:function(e){try{var t=new Uint8Array(e),a=new Blob([t],{type:"image/jpeg"});return(window.URL||window.webkitURL).createObjectURL(a)}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},clear_media_fields:function(e){"uploaded_media"===e&&(document.querySelector("#repo-uuid").value="",document.querySelector("#audio-video").value="",document.querySelector("#is-kaltura-item").value=0,document.querySelector("#is-repo-item").value=0),"repo_media"===e&&(document.querySelector("#audio-video").value="",document.querySelector("#is-kaltura-item").value=0),"kaltura_media"===e&&(document.querySelector("#repo-uuid").value="",document.querySelector("#is-repo-item").value=0),document.querySelector("#item-type").value="",document.querySelector("#item-mime-type").value="",document.querySelector("#item-media").value="",document.querySelector("#item-media-thumbnail-image-display").innerHTML="",document.querySelector("#item-media-filename-display").innerHTML="",document.querySelector("#item-media-trash").style.display="none"},get_kaltura_item_data:async function(t){try{var a=endpointsModule.get_exhibits_endpoints();let e=!0;null===t&&(t=document.querySelector("#audio-video").value,helperMediaModule.clear_media_fields("kaltura_media"),e=!1),0===t.length&&(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Please enter a Kaltura ID</div>');var i=authModule.get_user_token(),l=await httpModule.req({method:"GET",url:a.exhibits.kaltura_items.endpoint.replace(":entry_id",t),headers:{"Content-Type":"application/json","x-access-token":i}});if(void 0!==l&&200===l.status)return void 0===l.data.data.item_type?(document.querySelector("#kaltura-item-data").innerHTML=`<p style="color:red">${l.data.data.message}</p>`,!1):(document.querySelector("#kaltura-item-data").innerHTML=`<p>
                    <strong>${l.data.data.title}</strong><br>
                     (<em>${l.data.data.item_type}</em>)
                    <!--<small>${l.data.data.description}</small><br>-->
                    </p>`,document.querySelector("#kaltura-thumbnail").src=l.data.data.thumbnail,document.querySelector("#kaltura-item-type").value=l.data.data.item_type,document.querySelector("#kaltura-thumbnail").style.visibility="visible",!0===e?l.data.data:void 0);document.querySelector("#repo-item-metadata").innerHTML='<p style="color:red">Metadata record not found in repository.</p>'}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},toggle_alt_text:function(){try{var e=document.querySelector("#item-alt-text-input"),t=e.disabled;return!1===t?e.disabled=!0:!0===t&&(e.disabled=!1),!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},set_alt_text:function(e){document.querySelector("#image-alt-text").style.display="block",1===e.is_alt_text_decorative?(document.querySelector("#is-alt-text-decorative").checked=!0,document.querySelector("#item-alt-text-input").disabled=!0):(document.querySelector("#is-alt-text-decorative").checked=!1,document.querySelector("#item-alt-text-input").value=helperModule.unescape(e.alt_text))}};return e.delete_thumbnail_image=function(){try{(async()=>{var e=endpointsModule.get_exhibits_endpoints(),t=document.querySelector("#item-thumbnail").value,a=authModule.get_user_token();void 0!==(e=await httpModule.req({method:"DELETE",url:e.exhibits.media.delete.endpoint+"?media="+t,headers:{"Content-Type":"application/json","x-access-token":a}}))&&204===e.status&&(document.querySelector("#item-thumbnail").value="",document.querySelector("#item-thumbnail-image-display").innerHTML="",document.querySelector("#item-thumbnail-filename-display").innerHTML="",document.querySelector("#item-thumbnail-trash").style.display="none",document.querySelector("#item-media-thumbnail-image-display").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Thumbnail image deleted</div>',setTimeout(()=>{document.querySelector("#message").innerHTML=""},3e3))})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}return!1},e.delete_media=function(){try{(async()=>{var e=endpointsModule.get_exhibits_endpoints(),t=document.querySelector("#item-media").value,a=authModule.get_user_token();void 0!==(e=await httpModule.req({method:"DELETE",url:e.exhibits.media.delete.endpoint+"?media="+t,headers:{"Content-Type":"application/json","x-access-token":a}}))&&204===e.status&&(document.querySelector("#item-type").value="",document.querySelector("#item-mime-type").value="",document.querySelector("#item-media").value="",document.querySelector("#item-media-thumbnail-image-display").innerHTML="",document.querySelector("#item-media-filename-display").innerHTML="",document.querySelector("#item-media-trash").style.display="none",document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Media deleted</div>',document.querySelector("#toggle-open-to-page").style.visibility="hidden",document.querySelector("#image-alt-text").style.display="none",setTimeout(()=>{document.querySelector("#message").innerHTML=""},3e3))})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}return!1},e.delete_media_edit=async function(){if(this._is_deleting_media)return!1;this._is_deleting_media=!0;let t=document.querySelector("#message");let e=300;var a=(e,t,a)=>{var i,l;e&&(t=["info","success","danger","warning"].includes(t)?t:"danger",(i=document.createElement("div")).className="alert alert-"+t,i.setAttribute("role","alert"),(l=document.createElement("i")).className=d(t),i.appendChild(l),t=document.createTextNode(" "+a),i.appendChild(t),e.style.opacity="1",e.style.transition="",e.textContent="",e.appendChild(i))};let d=e=>({info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"})[e]||"fa fa-exclamation";var i,l,r,n,o,m,u,c;let s=null;try{var p=helperModule.get_parameter_by_name("exhibit_id"),y=helperModule.get_parameter_by_name("item_id"),h=document.querySelector("#item-media");if(!h)return a(t,"danger","Media input element not found"),!1;var _=h.value,g=(u=y,c=_,(m=p)&&u&&c?255<m.length||255<u.length||255<c.length?{valid:!1,error:"Invalid parameter length"}:{valid:!0}:{valid:!1,error:"Missing required parameters: exhibit_id, item_id, or media filename"});if(!g.valid)return a(t,"danger",g.error),!1;var v=authModule.get_user_token();if(!v||!1===v)return a(t,"danger","Session expired. Please log in again."),s=setTimeout(()=>{authModule.logout()},1e3),!1;var b=endpointsModule.get_exhibits_endpoints();if(!b?.exhibits?.item_media?.delete?.endpoint)return a(t,"danger","API endpoint configuration missing"),!1;var q=-1!==(o=window.location.pathname).indexOf("items/standard/media")?"standard_item":-1!==o.indexOf("items/grid/item/media")?"grid_item":-1!==o.indexOf("items/vertical-timeline/item/media")?"timeline_item":"standard_item",S=(console.log("Item type detected:",q),console.log("Current pathname:",window.location.pathname),b.exhibits.item_media.delete.endpoint.replace(":exhibit_id",encodeURIComponent(p)).replace(":item_id",encodeURIComponent(y)).replace(":media",encodeURIComponent(_))),f=S+"?"+new URLSearchParams({type:q}).toString(),M=await httpModule.req({method:"DELETE",url:f,headers:{"Content-Type":"application/json","x-access-token":v},timeout:3e4});if(M&&204===M.status)return i=document.querySelector("#item-media"),l=document.querySelector("#item-media-filename-display"),r=document.querySelector("#item-media-trash"),n=document.querySelector("#item-media-thumbnail-image-display"),i&&(i.value=""),l&&(l.textContent=""),r&&(r.style.display="none"),n&&(n.textContent=""),a(t,"success","Media deleted successfully"),s=setTimeout(()=>{t&&(t.style.transition=`opacity ${e}ms ease-out`,t.style.opacity="0",setTimeout(()=>{t.textContent="",t.style.opacity="1",t.style.transition=""},e))},3e3),!0;throw new Error("Failed to delete media file")}catch(e){s&&clearTimeout(s),console.error("Error deleting media:",e);var x=e.user_message||e.message||"Unable to delete media. Please try again.";return a(t,"danger",x),!1}finally{this._is_deleting_media=!1}},e.delete_thumbnail_image_edit=async function(){if(this._is_deleting_thumbnail)return!1;this._is_deleting_thumbnail=!0,console.log("DELETE MEDIA THUMBNAIL");let t=document.querySelector("#message");let e=300;var a=(e,t,a)=>{var i,l;e&&(t=["info","success","danger","warning"].includes(t)?t:"danger",(i=document.createElement("div")).className="alert alert-"+t,i.setAttribute("role","alert"),(l=document.createElement("i")).className=d(t),i.appendChild(l),t=document.createTextNode(" "+a),i.appendChild(t),e.style.opacity="1",e.style.transition="",e.textContent="",e.appendChild(i))};let d=e=>({info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"})[e]||"fa fa-exclamation";var i,l,r,n,o,m,u,c;let s=null;try{var p=helperModule.get_parameter_by_name("exhibit_id"),y=helperModule.get_parameter_by_name("item_id"),h=document.querySelector("#item-thumbnail");if(!h)return a(t,"danger","Thumbnail input element not found"),!1;var _=h.value,g=(u=y,c=_,(m=p)&&u&&c?255<m.length||255<u.length||255<c.length?{valid:!1,error:"Invalid parameter length"}:{valid:!0}:{valid:!1,error:"Missing required parameters: exhibit_id, item_id, or thumbnail filename"});if(!g.valid)return a(t,"danger",g.error),!1;var v=authModule.get_user_token();if(!v||!1===v)return a(t,"danger","Session expired. Please log in again."),s=setTimeout(()=>{authModule.logout()},1e3),!1;var b=endpointsModule.get_exhibits_endpoints();if(!b?.exhibits?.item_media?.delete?.endpoint)return a(t,"danger","API endpoint configuration missing"),!1;var q=-1!==(o=window.location.pathname).indexOf("items/standard/media")?"standard_item":-1!==o.indexOf("items/grid/item/media")?"grid_item":-1!==o.indexOf("items/vertical-timeline/item/media")?"timeline_item":"standard_item",S=(console.log("Item type detected:",q),console.log("Current pathname:",window.location.pathname),console.log("Deleting thumbnail:",_),b.exhibits.item_media.delete.endpoint.replace(":exhibit_id",encodeURIComponent(p)).replace(":item_id",encodeURIComponent(y)).replace(":media",encodeURIComponent(_))),f=S+"?"+new URLSearchParams({type:q}).toString(),M=await httpModule.req({method:"DELETE",url:f,headers:{"Content-Type":"application/json","x-access-token":v},timeout:3e4});if(M&&204===M.status)return i=document.querySelector("#item-thumbnail"),l=document.querySelector("#item-thumbnail-filename-display"),r=document.querySelector("#item-thumbnail-trash"),n=document.querySelector("#item-thumbnail-image-display"),i&&(i.value=""),l&&(l.textContent=""),r&&(r.style.display="none"),n&&(n.textContent=""),a(t,"success","Thumbnail deleted successfully"),s=setTimeout(()=>{t&&(t.style.transition=`opacity ${e}ms ease-out`,t.style.opacity="0",setTimeout(()=>{t.textContent="",t.style.opacity="1",t.style.transition=""},e))},3e3),!0;throw new Error("Failed to delete thumbnail")}catch(e){s&&clearTimeout(s),console.error("Error deleting thumbnail:",e);var x=e.user_message||e.message||"Unable to delete thumbnail. Please try again.";return a(t,"danger",x),!1}finally{this._is_deleting_thumbnail=!1}},e.delete_thumbnail_image_edit__=function(){console.log("DELETE MEDIA THUMBNAIL");try{(async()=>{var e=endpointsModule.get_exhibits_endpoints(),t=helperModule.get_parameter_by_name("exhibit_id"),a=helperModule.get_parameter_by_name("item_id"),i=document.querySelector("#item-thumbnail").value,e=e.exhibits.item_media.delete.endpoint.replace(":exhibit_id",t).replace(":item_id",a).replace(":media",i),t=authModule.get_user_token();void 0!==(a=await httpModule.req({method:"DELETE",url:e,headers:{"Content-Type":"application/json","x-access-token":t}}))&&204===a.status&&(document.querySelector("#item-thumbnail").value="",document.querySelector("#item-thumbnail-filename-display").innerHTML="",document.querySelector("#item-thumbnail-trash").style.display="none",document.querySelector("#item-thumbnail-image-display").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Thumbnail deleted</div>',setTimeout(()=>{document.querySelector("#message").innerHTML="",window.location.reload()},900))})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}return!1},e.process_media_fields_common=function(e){var t=[],a=(e.description=document.querySelector("#item-description-input").value,e.caption=document.querySelector("#item-caption-input").value,e.pdf_open_to_page=document.querySelector("#pdf-open-to-page").value,e.is_alt_text_decorative=document.querySelector("#is-alt-text-decorative").checked,document.querySelector("#embed-item")),i=document.querySelector("#wrap-text"),l=document.querySelector("#media-padding");return a&&(e.is_embedded=a.checked),i&&(e.media_padding=i.checked),l&&(e.media_padding=l.checked),!0===e.wrap_text?e.wrap_text=1:!1===e.wrap_text&&(e.wrap_text=0),!0===e.is_embedded?e.is_embedded=1:!1===e.is_embedded&&(e.is_embedded=0),!0===e.media_padding?e.media_padding=0:!1===e.media_padding&&(e.media_padding=1),e.thumbnail=document.querySelector("#item-thumbnail").value,e.thumbnail_prev=document.querySelector("#item-thumbnail-image-prev").value,e.item_type=document.querySelector("#item-type").value,e.mime_type=document.querySelector("#item-mime-type").value,e.media=document.querySelector("#item-media").value,e.media_prev=document.querySelector("#item-media-prev").value,e.kaltura=document.querySelector("#audio-video").value,e.repo_uuid=document.querySelector("#repo-uuid").value,e.is_repo_item=parseInt(document.querySelector("#is-repo-item").value),e.is_kaltura_item=parseInt(document.querySelector("#is-kaltura-item").value),0<e.media.length&&0<e.repo_uuid.length&&e.media===e.repo_uuid&&(e.repo_uuid=""),0<e.media.length&&0<e.kaltura.length&&e.media===e.kaltura&&(e.kaltura=""),0<e.media.length&&t.push(e.media),0<e.kaltura.length&&(t.push(e.kaltura),e.item_type="kaltura"),0<e.repo_uuid.length&&t.push(e.repo_uuid),1<t.length?!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Please upload or import only one media item</div>'):("kaltura"===e.item_type&&(e.item_type=document.querySelector("#kaltura-item-type").value),e)},e.display_media_fields_common=async function(e){var t=endpointsModule.get_exhibits_endpoints();let a="",i="";var l=document.querySelector("#wrap-text"),d=document.querySelector("#media-padding"),r=document.querySelector("#embed-item");document.querySelector("#item-description-input").value=helperModule.unescape(e.description),document.querySelector("#item-caption-input").value=helperModule.unescape(e.caption),document.querySelector("#pdf-open-to-page").value=e.pdf_open_to_page,r&&(1===e.is_embedded?r.checked=!0:r.checked=!1),l&&(1===e.wrap_text?l.checked=!0:l.checked=!1),d&&(1===e.media_padding?d.checked=!1:0===e.media_padding&&(d.checked=!0)),0<e.media.length&&(0===e.is_repo_item&&0===e.is_kaltura_item&&(-1!==e.mime_type.indexOf("image")?(i=t.exhibits.exhibit_media.get.endpoint.replace(":exhibit_id",e.is_member_of_exhibit).replace(":media",e.media),a=`<p><img src="${i}" height="200" ></p>`,helperMediaModule.set_alt_text(e)):-1!==e.mime_type.indexOf("video")?(i="/exhibits-dashboard/static/images/video-tn.png",a=`<p><img src="${i}" height="200" ></p>`):-1!==e.mime_type.indexOf("audio")?(i="/exhibits-dashboard/static/images/audio-tn.png",a=`<p><img src="${i}" height="200" ></p>`):-1!==e.mime_type.indexOf("pdf")?(i="/exhibits-dashboard/static/images/pdf-tn.png",a=`<p><img src="${i}" height="200" ></p>`,document.querySelector("#toggle-open-to-page").style.visibility="visible"):console.log("Unable to Determine Type"),document.querySelector("#item-media-trash").style.display="inline",document.querySelector("#item-media-filename-display").innerHTML=`<span style="font-size: 11px">${e.media}</span>`),document.querySelector("#item-type").value=e.item_type,1===e.is_repo_item&&(document.getElementById("upload-media-tab").classList.remove("active"),document.getElementById("import-repo-media-tab").classList.add("active"),document.getElementById("upload-media").classList.remove("active"),document.getElementById("upload-media").classList.remove("show"),document.getElementById("import-repo-media").classList.add("show"),document.getElementById("import-repo-media").classList.add("active"),document.getElementById("upload-media-tab").setAttribute("aria-selected","false"),document.getElementById("import-repo-media-tab").setAttribute("aria-selected","true"),document.querySelector("#repo-uuid").value=e.media,document.querySelector("#is-repo-item").value=1,await helperMediaModule.get_repo_item_data(null),"image"===e.item_type)&&helperMediaModule.set_alt_text(e),1===e.is_kaltura_item&&(document.getElementById("upload-media-tab").classList.remove("active"),document.getElementById("import-audio-video-tab").classList.add("active"),document.getElementById("upload-media").classList.remove("active"),document.getElementById("upload-media").classList.remove("show"),document.getElementById("import-audio-video").classList.add("show"),document.getElementById("import-audio-video").classList.add("active"),document.getElementById("upload-media-tab").setAttribute("aria-selected","false"),document.getElementById("import-audio-video-tab").setAttribute("aria-selected","true"),document.querySelector("#audio-video").value=e.media,document.querySelector("#is-kaltura-item").value=1,await helperMediaModule.get_kaltura_item_data(null),document.querySelector("#kaltura-item-type").value=e.item_type,document.querySelector("#item-type").value="kaltura"),document.querySelector("#item-mime-type").value=helperModule.unescape(e.mime_type),document.querySelector("#item-media-thumbnail-image-display").innerHTML=a,document.querySelector("#item-media").value=e.media,document.querySelector("#item-media-prev").value=e.media),0<e.thumbnail.length&&(i=t.exhibits.exhibit_media.get.endpoint.replace(":exhibit_id",e.is_member_of_exhibit).replace(":media",e.thumbnail),a=`<p><img src="${i}" height="200" ></p>`,document.querySelector("#item-thumbnail-image-display").innerHTML=a,document.querySelector("#item-thumbnail-filename-display").innerHTML=`<span style="font-size: 11px">${e.thumbnail}</span>`,document.querySelector("#item-thumbnail").value=e.thumbnail,document.querySelector("#item-thumbnail-image-prev").value=e.thumbnail,document.querySelector("#item-thumbnail-trash").style.display="inline")},e.media_common_init=function(){uploadsModule.upload_item_media(),uploadsModule.upload_item_thumbnail();let e=document.querySelector("#item-media-trash"),t=document.querySelector("#item-thumbnail-trash");var a=document.querySelector("#is-media-only-description"),i=document.querySelector("#is-media-only-caption");e&&(e.style.display="none"),t&&(t.style.display="none"),a&&(a.style.display="block"),i&&(i.style.display="block"),setTimeout(()=>{t.addEventListener("click",helperMediaModule.delete_thumbnail_image),e.addEventListener("click",helperMediaModule.delete_media)},1e3),document.querySelector("#repo-uuid-btn").addEventListener("click",async()=>{await helperMediaModule.get_repo_item_data(null)}),document.querySelector("#kaltura-btn").addEventListener("click",async()=>{await helperMediaModule.get_kaltura_item_data(null)})},e.media_edit_init=function(){setTimeout(()=>{0===document.querySelector("#item-media").value.length?(document.querySelector("#item-media-trash").removeEventListener("click",helperMediaModule.delete_media_edit),document.querySelector("#item-media-trash").addEventListener("click",helperMediaModule.delete_media)):0!==document.querySelector("#item-media").value&&(document.querySelector("#item-media-trash").removeEventListener("click",helperMediaModule.delete_media),document.querySelector("#item-media-trash").addEventListener("click",helperMediaModule.delete_media_edit)),0===document.querySelector("#item-thumbnail").value.length?(document.querySelector("#item-thumbnail-trash").removeEventListener("click",helperMediaModule.delete_thumbnail_image_edit),document.querySelector("#item-thumbnail-trash").addEventListener("click",helperMediaModule.delete_thumbnail_image)):0!==document.querySelector("#item-thumbnail").value.length&&(document.querySelector("#item-thumbnail-trash").removeEventListener("click",helperMediaModule.delete_thumbnail_image),document.querySelector("#item-thumbnail-trash").addEventListener("click",helperMediaModule.delete_thumbnail_image_edit))},1e3)},e.init=function(){document.querySelector("#is-alt-text-decorative")&&document.querySelector("#is-alt-text-decorative").addEventListener("click",()=>{helperMediaModule.toggle_alt_text()})},e})();helperMediaModule.init();