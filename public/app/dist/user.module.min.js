let userModule=(()=>{let o=window.localStorage.getItem("exhibits_app_path"),c=endpointsModule.get_users_endpoints();var e={};async function a(){try{var e=helperModule.get_parameter_by_name("user_id"),a=authModule.get_user_token(),t=await httpModule.req({method:"GET",url:c.users.get_user.endpoint.replace(":user_id",e),headers:{"Content-Type":"application/json","x-access-token":a}});if(200===t.status)return t.data}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}function t(e,a){return 0===a.length?!(document.querySelector("#"+e+"-error").innerHTML='<span style="color: red"><i class="fa fa-exclamation-circle"></i> Please enter a value</span>'):(document.querySelector("#"+e+"-error").innerHTML="",a)}function l(){return{first_name:t("first-name-input",document.querySelector("#first-name-input").value),last_name:t("last-name-input",document.querySelector("#last-name-input").value),email:t("email-input",document.querySelector("#email-input").value),du_id:t("du-id-input",document.querySelector("#du-id-input").value)}}return e.display_user=async function(e){return a()},e.display_user_records=async function(){try{var i=await(async()=>{try{var e=authModule.get_user_token(),a=await httpModule.req({method:"GET",url:c.users.endpoint,headers:{"Content-Type":"application/json","x-access-token":e}});if(200===a.status)return a.data}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})();let s="";if(!1===i)document.querySelector("#user-card").innerHTML="";else{if(0===i.length)return document.querySelector(".card").innerHTML="",!(document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><span id="exhibit-title"></span> No User Profiles found.</div>');for(let r=0;r<i.length;r++){var l=i[r].is_active;let e,a="",t="";var n=JSON.parse(window.sessionStorage.getItem("exhibits_user"));if(null===n)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get your user id</div>');1===l?t=(a=parseInt(n.uid)===i[r].id?(e='<span id="inactive" title="active"><i class="fa fa-user" style="color: green"></i><br>Active</span>',`<a href="${o}/users/edit?user_id=${i[r].id}" title="Edit"><i class="fa fa-edit pr-1"></i> </a>`):(e=`<a href="#" id="${i[r].id}" class="inactive-user"><span id="inactive" title="active"><i class="fa fa-user" style="color: green"></i><br>Active</span></a>`,'<i title="Can only edit if unpublished" style="color: #d3d3d3" class="fa fa-edit pr-1"></i>'),'<i title="Can only delete if unpublished" style="color: #d3d3d3" class="fa fa-trash pr-1"></i>'):0===l&&(e=`<a href="#" id="${i[r].id}" class="active-user"><span id="active" title="inactive"><i class="fa fa-user" style="color: darkred"></i><br>Inactive</span></a>`,a=`<a href="${o}/users/edit?user_id=${i[r].id}" title="Edit"><i class="fa fa-edit pr-1"></i> </a>`,t=`<a href="${o}/users/delete?user_id=${i[r].id}" title="Delete"><i class="fa fa-trash pr-1"></i></a>`),s=(s=(s=(s+="<tr>")+`<td style="width: 35%;padding-left: 7%">
                    <p><i class="fa fa-user"></i>&nbsp;&nbsp;<strong>${i[r].first_name} ${i[r].last_name}</strong></p>
                    <p><i class="fa fa-envelope"></i>&nbsp;&nbsp;${i[r].email}</p>
                    </td>`)+`<td style="width: 5%;text-align: center"><small>${e}</small></td>`)+`<td style="width: 10%">
                                <div class="card-text text-sm-center">
                                    ${a}
                                    &nbsp;
                                    ${t}
                                </div>
                               </td>`+"</tr>"}document.querySelector("#user-data").innerHTML=s,new DataTable("#users",{order:[[0,"asc"]]});try{Array.from(document.getElementsByClassName("active-user")).forEach(r=>{r.addEventListener("click",async e=>{var a,t=r.getAttribute("id");t=t,a=authModule.get_user_token(),200===(t=await httpModule.req({method:"PUT",url:c.users.user_status.endpoint.replace(":id",t).replace(":is_active","1"),headers:{"Content-Type":"application/json","x-access-token":a}})).status&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-check"></i> User activated</div>',setTimeout(()=>{location.reload()},500))})})}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}try{Array.from(document.getElementsByClassName("inactive-user")).forEach(t=>{t.addEventListener("click",async()=>{var e,a=t.getAttribute("id");a=a,e=authModule.get_user_token(),200===(a=await httpModule.req({method:"PUT",url:c.users.user_status.endpoint.replace(":id",a).replace(":is_active","0"),headers:{"Content-Type":"application/json","x-access-token":e}})).status&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-check"></i> User deactivated</div>',setTimeout(()=>{location.reload()},500))})})}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}helperModule.show_form()}return!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.display_user_record=async function(){try{var e=(await a()).pop();return document.querySelector("#first-name-input").value=e.first_name,document.querySelector("#last-name-input").value=e.last_name,document.querySelector("#email-input").value=e.email,document.querySelector("#du-id-input").value=e.du_id,!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.update_user_record=async function(e){try{e.preventDefault();var a,t,r=helperModule.get_parameter_by_name("user_id"),s=l(),i=authModule.get_user_token();if(void 0===r)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get user ID</div>');if(!1===i)setTimeout(()=>{document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get session token</div>',authModule.logout()},1e3);else{if(void 0===s)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get form field values</div>');!1!==s&&(document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Updating user record...</div>',a=c.users.update_user.put.endpoint.replace(":user_id",r),void 0!==(t=await httpModule.req({method:"PUT",url:a,data:s,headers:{"Content-Type":"application/json","x-access-token":i}})))&&201===t.status&&(document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> User record updated</div>',setTimeout(()=>{window.location.reload()},900))}return!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.save_user_record=async function(e){try{e.preventDefault();var a=l(),t=authModule.get_user_token();if(!1===t)setTimeout(()=>{document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get session token</div>',authModule.logout()},1e3);else{if(void 0===a)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get form field values</div>');if(!1!==a){document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Saving user record...</div>';var r=c.users.endpoint,s=await httpModule.req({method:"POST",url:r,data:a,headers:{"Content-Type":"application/json","x-access-token":t}});if(void 0!==s&&201===s.status){let e=s.data[0];document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> User record saved</div>',setTimeout(()=>{window.location.replace(o+"/users/edit?user_id="+e)},900)}else 200===s.status&&(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> User already exists</div>')}}return!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.delete_user=async function(){try{document.querySelector("#delete-message").innerHTML="Deleting user...";var e=helperModule.get_parameter_by_name("user_id"),a=authModule.get_user_token(),t=await httpModule.req({method:"DELETE",url:c.users.delete_user.delete.endpoint.replace(":user_id",e),headers:{"Content-Type":"application/json","x-access-token":a}});void 0!==t&&204===t.status?setTimeout(()=>{window.location.replace(o+"/users")},900):document.querySelector("#exhibit-no-delete").innerHTML='<i class="fa fa-exclamation"></i> '+t.data.message}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.check_user_data=function(){return null!==window.sessionStorage.getItem("exhibits_user")},e.init=function(){},e})();