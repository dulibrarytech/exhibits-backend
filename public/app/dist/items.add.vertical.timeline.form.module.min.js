let itemsAddVerticalTimelineFormModule=(()=>{let v="/exhibits-dashboard",w=endpointsModule.get_exhibits_endpoints(),x={};function c(e,t,i){var n,r;e&&(t=["info","success","danger","warning"].includes(t)?t:"info",(n=document.createElement("div")).className="alert alert-"+t,n.setAttribute("role","alert"),(r=document.createElement("i")).className={info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"}[t]||"fa fa-info",n.appendChild(r),t=document.createTextNode(" "+i),n.appendChild(t),e.textContent="",e.appendChild(n))}return x.create_timeline_record=async function(){var e=helperModule.get_parameter_by_name("item_id");if(e)return console.log("ðŸ”´ Item ID exists - already in edit mode, preventing duplicate creation"),console.log("Current URL:",window.location.href),console.log("item_id:",e),x.update_timeline_record&&"function"==typeof x.update_timeline_record?(console.log("Redirecting to update function..."),x.update_timeline_record()):(c(document.querySelector("#message"),"warning","Already in edit mode. Update function not available."),console.error("ERROR: update_timeline_record function not found!"),!1);if(console.log("ðŸŸ¢ CREATE FUNCTION CALLED - No item_id, proceeding with creation"),this._is_creating_timeline)return console.log("Already creating, preventing duplicate submission"),!1;this._is_creating_timeline=!0;try{var t=document.querySelector("#message");window.scrollTo({top:0,behavior:"smooth"});let i=helperModule.get_parameter_by_name("exhibit_id");if(!i)return c(t,"warning","Missing exhibit ID. Cannot create timeline record."),!1;c(t,"info","Creating timeline record...");var r=authModule.get_user_token();if(!r||!1===r)return c(t,"danger","Session expired. Please log in again."),setTimeout(()=>{authModule.logout()},1e3),!1;var o=itemsCommonVerticalTimelineFormModule.get_common_timeline_form_fields();if(!o||!1===o)return c(t,"danger","Unable to get form field values. Please check all required fields."),!1;var a=helperModule.get_user_name(),l=helperModule.get_owner();if(a&&(o.created_by=a),l&&(o.owner=l),!w?.exhibits?.timeline_records?.post?.endpoint)return c(t,"danger","API endpoint configuration missing"),!1;var d=w.exhibits.timeline_records.post.endpoint.replace(":exhibit_id",encodeURIComponent(i)),s=await httpModule.req({method:"POST",url:d,data:o,headers:{"Content-Type":"application/json","x-access-token":r},timeout:3e4});if(!s||201!==s.status){if(s)throw new Error("Failed to create timeline record");return c(t,"danger","Permission denied. You do not have access to add items to this exhibit."),!1}let n=s.data?.data;if(n)return console.log("âœ… Timeline record created successfully, ID:",n),c(t,"success","Timeline record created successfully. Redirecting to edit page..."),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{var e=i,t=n;console.log("=== REDIRECTING TO TIMELINE EDIT PAGE ==="),console.log("exhibit_id:",e),console.log("timeline_id:",t),e=new URLSearchParams({exhibit_id:e,item_id:t}),t=v+"/items/vertical-timeline/edit?"+e.toString(),console.log("Redirecting to:",t),console.log("Note: Back button will NOT return to create page"),window.location.replace(t)},1200),!0;throw new Error("Server did not return a valid timeline ID")}catch(e){return console.error("âŒ Error creating timeline record:",e),c(document.querySelector("#message"),"danger",e.user_message||e.message||"Unable to create timeline record. Please try again."),!1}finally{this._is_creating_timeline=!1}},x.create_timeline_record__=async function(){if(this._is_creating_timeline)return!1;this._is_creating_timeline=!0;let t=document.querySelector("#message");let e=300;var i=(e,t,i)=>{var n,r;e&&(t=["info","success","danger","warning"].includes(t)?t:"danger",(n=document.createElement("div")).className="alert alert-"+t,n.setAttribute("role","alert"),(r=document.createElement("i")).className=o(t),n.appendChild(r),t=document.createTextNode(" "+i),n.appendChild(t),e.style.opacity="1",e.style.transition="",e.textContent="",e.appendChild(n))};let o=e=>({info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"})[e]||"fa fa-exclamation";let n=(e,t)=>{var i;window.history?.pushState&&(i=new URLSearchParams({exhibit_id:e,item_id:t}),i=v+"/items/vertical-timeline/edit?"+i.toString(),window.history.pushState({mode:"edit",exhibit_id:e,item_id:t,type:"timeline"},"",i))},r=e=>{document.title&&(document.title=e);var t=document.querySelector("h1, .page-title");t&&(t.textContent=e)},a=async()=>{"function"==typeof display_edit_record&&await display_edit_record()},l=()=>{var e=document.querySelector("form#timeline-form, form");e&&(e.onsubmit=async function(e){return e.preventDefault(),!(!x.update_timeline_record||"function"!=typeof x.update_timeline_record)&&x.update_timeline_record()},e=e.querySelector('input[name="mode"]'))&&(e.value="edit")},d=()=>{var e=document.querySelector('button[type="submit"], #submit-button, #timeline-submit-button');e&&((t=e.querySelector(".button-text"))?t.textContent="Update Timeline":e.querySelector("i")?e.childNodes.forEach(e=>{e.nodeType===Node.TEXT_NODE&&(e.textContent=" Update Timeline")}):e.textContent="Update Timeline"),document.querySelectorAll('.edit-only, [data-mode="edit"]').forEach(e=>{e.style.display="",e.classList.remove("hidden")});document.querySelectorAll('.create-only, [data-mode="create"]').forEach(e=>{e.style.display="none",e.classList.add("hidden")});var t=document.querySelector("#created, .metadata-section"),e=(t&&(t.style.display="block",t.classList.remove("hidden")),document.querySelector("#timeline-events, .timeline-events-section"));e&&(e.style.display="block",e.classList.remove("hidden"))},s=(e,t)=>{e=new URLSearchParams({exhibit_id:e,item_id:t}),t=v+"/items/vertical-timeline/edit?"+e.toString();window.location.replace(t)},c=null;try{window.scrollTo({top:0,behavior:"smooth"});var m=helperModule.get_parameter_by_name("exhibit_id");if(!m)return i(t,"warning","Missing exhibit ID. Cannot create timeline record."),!1;i(t,"info","Creating timeline record...");var u=authModule.get_user_token();if(!u||!1===u)return i(t,"danger","Session expired. Please log in again."),c=setTimeout(()=>{authModule.logout()},1e3),!1;var _=itemsCommonVerticalTimelineFormModule.get_common_timeline_form_fields();if(!_||!1===_)return i(t,"danger","Unable to get form field values. Please check all required fields."),!1;var g=helperModule.get_user_name(),h=helperModule.get_owner();if(g&&(_.created_by=g),h&&(_.owner=h),!w?.exhibits?.timeline_records?.post?.endpoint)return i(t,"danger","API endpoint configuration missing"),!1;var p=w.exhibits.timeline_records.post.endpoint.replace(":exhibit_id",encodeURIComponent(m)),f=await httpModule.req({method:"POST",url:p,data:_,headers:{"Content-Type":"application/json","x-access-token":u},timeout:3e4});if(!f||201!==f.status){if(f)throw new Error("Failed to create timeline record");return i(t,"danger","Permission denied. You do not have access to add items to this exhibit."),!1}var y=f.data?.data;if(y)return window.scrollTo({top:0,behavior:"smooth"}),i(t,"success","Timeline record created successfully"),console.log("Created timeline ID:",y),await(async(t,i)=>{try{n(t,i),r("Edit Timeline"),await a(),l(),d()}catch(e){console.error("Error transitioning to edit mode:",e),s(t,i)}})(m,y),c=setTimeout(()=>{t&&(t.style.transition=`opacity ${e}ms ease-out`,t.style.opacity="0",setTimeout(()=>{t.textContent="",t.style.opacity="1",t.style.transition=""},e))},3e3),!0;throw new Error("Server did not return a valid timeline ID")}catch(e){c&&clearTimeout(c),console.error("Error creating timeline record:",e);var b=e.user_message||e.message||"Unable to create timeline record. Please try again.";return i(t,"danger",b),!1}finally{this._is_creating_timeline=!1}},x.init=async function(){try{var e=helperModule.get_parameter_by_name("exhibit_id"),t="/items?exhibit_id="+e+"&status=403";await authModule.check_permissions(["add_item","add_item_to_any_exhibit"],"timeline",e,null,t),exhibitsModule.set_exhibit_title(e),document.querySelector("#save-timeline-btn").addEventListener("click",itemsAddVerticalTimelineFormModule.create_timeline_record)}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},x})();