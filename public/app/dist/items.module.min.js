let itemsModule=(()=>{let h=()=>{try{return endpointsModule.get_exhibits_endpoints()}catch(e){return console.error("Error getting exhibits endpoints:",e),null}},g=(()=>{try{var e=window.localStorage.getItem("exhibits_app_path");return e?e:(console.error("App path not found in localStorage"),"")}catch(e){return console.error("Error accessing localStorage:",e),""}})(),_={},b=(e,t,i)=>{var r,a;e?(t=["info","success","danger","warning"].includes(t)?t:"danger",(r=document.createElement("div")).className="alert alert-"+t,r.setAttribute("role","alert"),(a=document.createElement("i")).className=n(t),a.setAttribute("aria-hidden","true"),r.appendChild(a),t=document.createTextNode(" "+i),r.appendChild(t),e.textContent="",e.appendChild(r)):console.error("Message element not found:",i)},n=e=>({info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"})[e]||"fa fa-exclamation";async function y(i){try{if(!i)throw new Error("Invalid item UUID");var e=helperModule.get_parameter_by_name("exhibit_id");if(!e)throw new Error("Exhibit ID not found");var r=document.getElementsByTagName("tr");let t=null;for(let e=0;e<r.length;e++)if(r[e].id&&-1!==r[e].id.indexOf(i)){var a=r[e].id.split("_");t=a[a.length-1];break}if(!t)throw new Error("Could not determine item type");console.log("Publishing item type:",t);var n,o,d,s,l=h();if(l?.exhibits?.item_records?.item_publish?.post?.endpoint)return m=l.exhibits.item_records.item_publish.post.endpoint.replace(":exhibit_id",encodeURIComponent(e)).replace(":item_id",encodeURIComponent(i))+"?type="+encodeURIComponent(t),(n=authModule.get_user_token())&&!1!==n?(d=await httpModule.req({method:"POST",url:m,headers:{"Content-Type":"application/json","x-access-token":n},timeout:3e4}))&&200===d.status?(c=i,u=t,p=e,setTimeout(()=>{var e,t,i=document.getElementById(c);i&&(i.classList.remove("publish-item"),i.classList.add("suppress-item"),(e=document.createElement("span")).id="suppress",e.setAttribute("title","Published - click to unpublish"),(t=document.createElement("i")).className="fa fa-cloud",t.style.color="green",t.setAttribute("aria-hidden","true"),e.appendChild(t),e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode("Published")),i.textContent="",i.appendChild(e),i.addEventListener("click",async e=>{e.preventDefault(),await f(c)},!1))},100),setTimeout(()=>{w(c,u,p,!0)},150),!0):(window.scrollTo({top:0,behavior:"smooth"}),s=document.querySelector("#message"),b(s,"danger","You do not have permission to publish this record."),!1):(o=document.querySelector("#message"),b(o,"danger","Session expired. Please log in again."),!1);throw new Error("Publish endpoint not configured")}catch(e){console.error("Error publishing item:",e);var l=document.querySelector("#message"),m=e.user_message||e.message||"Unable to publish item. Please try again.";return b(l,"danger",m),!1}var c,u,p}async function f(i){try{if(!i)throw new Error("Invalid item UUID");var e=helperModule.get_parameter_by_name("exhibit_id");if(!e)throw new Error("Exhibit ID not found");var r=document.getElementsByTagName("tr");let t=null;for(let e=0;e<r.length;e++)if(r[e].id&&-1!==r[e].id.indexOf(i)){var a=r[e].id.split("_");t=a[a.length-1];break}if(!t)throw new Error("Could not determine item type");console.log("Suppressing item type:",t);var n,o,d,s,l=h();if(l?.exhibits?.item_records?.item_suppress?.post?.endpoint)return m=l.exhibits.item_records.item_suppress.post.endpoint.replace(":exhibit_id",encodeURIComponent(e)).replace(":item_id",encodeURIComponent(i))+"?type="+encodeURIComponent(t),(n=authModule.get_user_token())&&!1!==n?(d=await httpModule.req({method:"POST",url:m,headers:{"Content-Type":"application/json","x-access-token":n},timeout:3e4}))&&200===d.status?(c=i,u=t,p=e,setTimeout(()=>{var e,t,i=document.getElementById(c);i&&(i.classList.remove("suppress-item"),i.classList.add("publish-item"),(e=document.createElement("span")).id="publish",e.setAttribute("title","Unpublished - click to publish"),(t=document.createElement("i")).className="fa fa-cloud-upload",t.style.color="darkred",t.setAttribute("aria-hidden","true"),e.appendChild(t),e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode("Unpublished")),i.textContent="",i.appendChild(e),i.addEventListener("click",async e=>{e.preventDefault(),await y(c)},!1))},100),setTimeout(()=>{w(c,u,p,!1)},150),!0):(window.scrollTo({top:0,behavior:"smooth"}),s=document.querySelector("#message"),b(s,"danger","You do not have permission to unpublish this record."),!1):(o=document.querySelector("#message"),b(o,"danger","Session expired. Please log in again."),!1);throw new Error("Suppress endpoint not configured")}catch(e){console.error("Error suppressing item:",e);var l=document.querySelector("#message"),m=e.user_message||e.message||"Unable to unpublish item. Please try again.";return b(l,"danger",m),!1}var c,u,p}function w(r,a,n,o){var d=document.getElementById(r+"-item-actions");if(d){var s=document.createElement("div");s.className="card-text text-sm-center";let e="";let t=null,i="item";var l=encodeURIComponent(n),m=encodeURIComponent(r);switch(a){case"heading":i="heading",e=o?g+`/items/heading/details?exhibit_id=${l}&item_id=`+m:g+`/items/heading/edit?exhibit_id=${l}&item_id=`+m;break;case"text":e=o?g+`/items/standard/text/details?exhibit_id=${l}&item_id=`+m:g+`/items/standard/text/edit?exhibit_id=${l}&item_id=`+m;break;case"grid":i="grid",e=o?g+`/items/grid/details?exhibit_id=${l}&item_id=`+m:g+`/items/grid/edit?exhibit_id=${l}&item_id=`+m;var c=g+`/items/grid/items?exhibit_id=${l}&grid_id=`+m,c=((t=document.createElement("a")).href=c,t.setAttribute("title","View grid items"),t.setAttribute("aria-label","view-grid-items"),document.createElement("i"));c.className="fa fa-list pr-1",c.setAttribute("aria-hidden","true"),t.appendChild(c);break;case"timeline":i="timeline",e=o?g+`/items/vertical-timeline/details?exhibit_id=${l}&item_id=`+m:g+`/items/vertical-timeline/edit?exhibit_id=${l}&item_id=`+m;c=g+`/items/timeline/items?exhibit_id=${l}&timeline_id=`+m,c=((t=document.createElement("a")).href=c,t.setAttribute("title","View timeline items"),t.setAttribute("aria-label","view-timeline-items"),document.createElement("i"));c.className="fa fa-list pr-1",c.setAttribute("aria-hidden","true"),t.appendChild(c);break;default:e=o?g+`/items/standard/media/details?exhibit_id=${l}&item_id=`+m:g+`/items/standard/media/edit?exhibit_id=${l}&item_id=`+m}n=g+`/items/delete?exhibit_id=${l}&item_id=${m}&type=`+encodeURIComponent(i),t&&(s.appendChild(t),s.appendChild(document.createTextNode(" ")));var r=document.createElement("a"),a=(r.href=e,r.setAttribute("title",o?"View details":"Edit item"),r.setAttribute("aria-label",o?"view-item-details":"edit-item"),document.createElement("i"));a.className=o?"fa fa-folder-open pr-1":"fa fa-edit pr-1",a.setAttribute("aria-hidden","true"),r.appendChild(a),s.appendChild(r),s.appendChild(document.createTextNode(" ")),o?((a=document.createElement("i")).className="fa fa-trash pr-1",a.setAttribute("title","Can only delete if unpublished"),a.setAttribute("aria-label","delete-disabled"),a.style.color="#d3d3d3",a.setAttribute("aria-hidden","true"),s.appendChild(a)):((r=document.createElement("a")).href=n,r.setAttribute("title","Delete item"),r.setAttribute("aria-label","delete-item"),(a=document.createElement("i")).className="fa fa-trash pr-1",a.setAttribute("aria-hidden","true"),r.appendChild(a),s.appendChild(r)),d.textContent="",d.appendChild(s)}}return _.get_items=async function(e){try{if(!e||"string"!=typeof e)throw new Error("Invalid exhibit UUID");var t=h();if(!t?.exhibits?.item_records?.endpoint)throw new Error("Item records endpoint not configured");var i=authModule.get_user_token();if(!i||!1===i)return n=document.querySelector("#message"),b(n,"danger","Session expired. Please log in again."),!1;var r=t.exhibits.item_records.endpoint.replace(":exhibit_id",encodeURIComponent(e)),a=await httpModule.req({method:"GET",url:r,headers:{"Content-Type":"application/json","x-access-token":i},timeout:3e4});if(!a||200!==a.status)throw new Error("Failed to retrieve items");if(a.data?.data)return(e=>{try{window.localStorage.removeItem("items"),window.localStorage.setItem("items",JSON.stringify(e))}catch(e){return console.error("Error saving items to localStorage:",e)}})(a.data.data),a.data.data;throw new Error("Invalid response structure")}catch(e){console.error("Error getting items:",e);var n=document.querySelector("#message"),t=e.user_message||e.message||"Unable to retrieve items. Please try again.";return b(n,"danger",t),!1}},_.display_items=async function(){try{var e=helperModule.get_parameter_by_name("exhibit_id");if(!e)return p=document.querySelector("#message"),b(p,"warning","No exhibit ID provided"),!1;var i,r,a,n,o=await _.get_items(e);if(!1===o)return(h=document.querySelector("#item-card"))&&(h.textContent=""),!1;if(!o||0===o.length)return(i=document.querySelector(".card"))&&(i.textContent=""),r=document.querySelector("#message"),(a=document.createElement("div")).className="alert alert-info",a.setAttribute("role","alert"),(n=document.createElement("span")).id="exhibit-title",a.appendChild(n),a.appendChild(document.createTextNode(" exhibit is empty.")),r.textContent="",r.appendChild(a),await exhibitsModule.set_exhibit_title(e),!1;let t="";for(let e=0;e<o.length;e++){var d=o[e].type,s=o[e];switch(d){case"heading":t+=await itemsListDisplayModule.display_heading_items(s);break;case"item":t+=await itemsListDisplayModule.display_standard_items(s);break;case"grid":t+=await itemsListDisplayModule.display_grids(s);break;case"vertical_timeline":t+=await itemsListDisplayModule.display_timelines(s);break;default:console.warn("Unknown item type: "+d)}}var l=document.querySelector("#item-data");l&&(l.innerHTML=t),new DataTable("#items",{paging:!1,rowReorder:!0}).on("row-reordered",async(e,t)=>{await helperModule.reorder_items(e,t)});try{Array.from(document.getElementsByClassName("publish-item")).forEach(t=>{t.addEventListener("click",async e=>{e.preventDefault(),await y(t.getAttribute("id"))})})}catch(e){console.error("Error binding publish events:",e)}try{Array.from(document.getElementsByClassName("suppress-item")).forEach(t=>{t.addEventListener("click",async e=>{e.preventDefault(),await f(t.getAttribute("id"))})})}catch(e){console.error("Error binding suppress events:",e)}var m,c=helperModule.get_parameter_by_name("id"),u=helperModule.get_parameter_by_name("type");return c&&u&&(m=g+"/exhibits?exhibit_id="+encodeURIComponent(e),window.history.replaceState({},"",m),window.history.pushState({},"",m),window.location.href=`#${c}_`+u),!0}catch(e){console.error("Error displaying items:",e);var p=document.querySelector("#message"),h=e.user_message||e.message||"Unable to display items. Please try again.";return b(p,"danger",h),!1}},_.delete_item=async function(){try{var i=document.querySelector("#delete-message");i&&(i.textContent="Deleting item...");let t=helperModule.get_parameter_by_name("exhibit_id");var e=helperModule.get_parameter_by_name("item_id"),r=helperModule.get_parameter_by_name("type");if(!t||!e||!r)throw new Error("Missing required parameters for delete operation");var a,n,o,d,s,l,m=h();if(m?.exhibits?.item_records?.delete?.endpoint)return(a=authModule.get_user_token())&&!1!==a?(o=m.exhibits.item_records.delete.endpoint.replace(":exhibit_id",encodeURIComponent(t)).replace(":item_id",encodeURIComponent(e))+"?type="+encodeURIComponent(r),(d=await httpModule.req({method:"DELETE",url:o,headers:{"Content-Type":"application/json","x-access-token":a},timeout:3e4}))&&204===d.status?(setTimeout(()=>{var e=g+"/items?exhibit_id="+encodeURIComponent(t);window.location.replace(e)},900),!0):(window.scrollTo({top:0,behavior:"smooth"}),(s=document.querySelector("#delete-card"))&&(s.textContent=""),l=document.querySelector("#message"),b(l,"danger","You do not have permission to delete this record."),!1)):(n=document.querySelector("#message"),b(n,"danger","Session expired. Please log in again."),!1);throw new Error("Delete endpoint not configured")}catch(e){console.error("Error deleting item:",e);i=document.querySelector("#message"),m=e.user_message||e.message||"Unable to delete item. Please try again.";return b(i,"danger",m),!1}},_.init=function(){try{let t=helperModule.get_parameter_by_name("exhibit_id");"403"===helperModule.get_parameter_by_name("status")&&(i=document.querySelector("#message"),b(i,"danger","You do not have permission to add item."),setTimeout(()=>{var e=g+"/items?exhibit_id="+encodeURIComponent(t);window.history.replaceState({page:"items"},"",e)},0)),(async()=>{var e=authModule.get_user_token();await authModule.check_auth(e)})(),exhibitsModule.set_exhibit_title(t),_.display_items(),helperModule.show_form(),navModule.set_preview_link(),navModule.set_item_nav_menu_links(),navModule.set_logout_link(),console.log("Items module initialized")}catch(e){console.error("Error initializing items module:",e);var i=document.querySelector("#message"),t=e.message||"Unable to initialize items module";b(i,"danger",t)}},_})();