let itemsEditHeadingFormModule=(()=>{let u=window.localStorage.getItem("exhibits_app_path"),c=endpointsModule.get_exhibits_endpoints();var e={};let l={};async function r(){var e=await(async()=>{try{var e,t=helperModule.get_parameter_by_name("exhibit_id"),a=helperModule.get_parameter_by_name("item_id"),r=authModule.get_user_token(),o=authModule.get_user_profile_data(),i=c.exhibits.heading_records.get.endpoint.replace(":exhibit_id",t).replace(":heading_id",a);return!1===r?(document.querySelector("#message").innerHTML="ERROR: Unable to get API endpoints",setTimeout(()=>{window.location.replace(u+"/login")},1e3),!1):void 0!==(e=await httpModule.req({method:"GET",url:i+"?type=edit&uid="+o.uid,headers:{"Content-Type":"application/json","x-access-token":r}}))&&200===e.status?e.data.data[0]:void 0}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})();let t;var a=e.is_published,r=e.created_by,o=new Date(e.created),i=e.updated_by,l=e.updated,l=new Date(l);let d="";o=helperModule.format_date(o),l=helperModule.format_date(l);if(helperModule.check_if_locked(e,"#item-submit-card"),null!==r&&(d+=`<em>Created by ${r} on ${o}</em>`),null!==i&&(d+=` | <em>Last updated by ${i} on ${l}</em>`),document.querySelector("#created").innerHTML=d,document.querySelector("#item-heading-text-input").value=helperModule.unescape(e.text),null!==document.querySelector("#is-published")&&1===a?document.querySelector("#is-published").value=!0:null!==document.querySelector("#is-published")&&0===a&&(document.querySelector("#is-published").value=!1),"string"==typeof e.styles&&(t=JSON.parse(e.styles)),0!==Object.keys(t).length){void 0!==t.backgroundColor&&0!==t.backgroundColor.length&&(document.querySelector("#heading-background-color").value=t.backgroundColor,document.querySelector("#heading-background-color-picker").value=t.backgroundColor),void 0!==t.color&&0!==t.color.length&&(document.querySelector("#heading-font-color").value=t.color,document.querySelector("#heading-font-color-picker").value=t.color),void 0!==t.fontSize?document.querySelector("#heading-font-size").value=t.fontSize.replace("px",""):document.querySelector("#heading-font-size").value="";var n=document.querySelector("#heading-font");for(let e=0;e<n.length;e++)n[e].value===t.fontFamily&&(document.querySelector("#heading-font").value=t.fontFamily)}return!1}return e.update_item_heading_record=async function(){try{scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Updating heading record...</div>';var e=helperModule.get_parameter_by_name("exhibit_id"),t=helperModule.get_parameter_by_name("item_id"),a=authModule.get_user_token(),r=itemsCommonHeadingFormModule.get_common_heading_form_fields(l);if(!1===r)return!1;if(void 0===e||void 0===t)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get record ID</div>');if(!1===a)return setTimeout(()=>{document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get session token</div>',authModule.logout()},1e3),!1;r.updated_by=helperModule.get_user_name();var o,i=c.exhibits.heading_records.put.endpoint.replace(":exhibit_id",e).replace(":heading_id",t);void 0!==(o=await httpModule.req({method:"PUT",url:i,data:r,headers:{"Content-Type":"application/json","x-access-token":a}}))&&201===o.status&&(document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Heading record updated</div>',setTimeout(()=>{window.location.reload()},900))}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.init=async function(){try{var e=helperModule.get_parameter_by_name("exhibit_id"),t=helperModule.get_parameter_by_name("item_id"),a="/items/heading/details?exhibit_id="+e+"&item_id="+t+"&status=403";await authModule.check_permissions(["update_item","update_any_item"],"heading",e,t,a),await exhibitsModule.set_exhibit_title(e),document.querySelector("#save-heading-btn").addEventListener("click",await itemsEditHeadingFormModule.update_item_heading_record),await r()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e})();