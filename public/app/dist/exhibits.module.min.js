let exhibitsModule=(()=>{let m=window.localStorage.getItem("exhibits_app_path");var e={};let i;async function b(){try{var t=endpointsModule.get_exhibits_endpoints();if(!t?.exhibits?.exhibit_records?.endpoint)throw new Error("Exhibits endpoint configuration not available");var i=authModule.get_user_token();if(!i||"string"!=typeof i)throw new Error("Authentication token not available");var a=await httpModule.req({method:"GET",url:t.exhibits.exhibit_records.endpoint,headers:{"Content-Type":"application/json","x-access-token":i},timeout:3e4});if(a&&200===a.status)return a.data&&Array.isArray(a.data.data)?a.data.data:(console.warn("Unexpected response data structure:",a.data),[]);if(a)throw new Error("Request failed with status "+a.status)}catch(e){console.error("Error fetching exhibits:",e),t=e.message,(i=document.querySelector("#message"))?(i.textContent="",(a=document.createElement("div")).className="alert alert-danger",a.setAttribute("role","alert"),a.setAttribute("aria-live","polite"),a.setAttribute("aria-atomic","true"),(n=document.createElement("i")).className="fa fa-exclamation",n.setAttribute("aria-hidden","true"),a.appendChild(n),a.appendChild(document.createTextNode(" ")),n=document.createTextNode(t),a.appendChild(n),i.appendChild(a)):console.error("Message element #message not found in DOM")}var n}function f(e,t){var i=document.createElement("td"),t=(i.style.width="4%",i.className="item-order",i.setAttribute("aria-label",t),document.createElement("span")),e=(t.style.paddingLeft="4px",new Date(e)),e=helperModule.format_date(e);return t.textContent=e,i.appendChild(t),i}function x(e,t,i,a){var n=document.createElement("i");return n.className=e,t&&n.setAttribute("title",t),i?n.setAttribute("aria-label",i):n.setAttribute("aria-hidden","true"),a&&(n.style.color=a),n}function g(e,t,i,a){var n=document.createElement("a");return n.href=e,t&&n.setAttribute("title",t),i&&n.setAttribute("aria-label",i),a&&(e=x(a,"","",""),n.appendChild(e),n.appendChild(document.createTextNode(" "))),n}async function y(a){try{var e=endpointsModule.get_exhibits_endpoints(),t=authModule.get_user_token(),i=await httpModule.req({method:"POST",url:e.exhibits.exhibit_publish.post.endpoint.replace(":exhibit_id",a.replace("-status","")),headers:{"Content-Type":"application/json","x-access-token":t}});return void 0!==i&&200===i.status&&(setTimeout(()=>{let t=document.getElementById(a);document.getElementById(a).classList.remove("publish-exhibit"),document.getElementById(a).classList.add("suppress-exhibit"),document.getElementById(a).replaceWith(t.cloneNode(!0)),document.getElementById(a).innerHTML='<span id="suppress" title="published"><i class="fa fa-cloud" style="color: green"></i><br>Published</span>',document.getElementById(a).addEventListener("click",async e=>{e.preventDefault(),await v(t.getAttribute("id"))},!1)},0),setTimeout(()=>{a=a.replace("-status","");var e=`<a href="${m}/items?exhibit_id=${a}" title="View Exhibit Items"><i class="fa fa-list pr-1"></i></a>&nbsp;`,t=a+"-actions",t=document.getElementById(t),i=`<a href="${m}/exhibits/exhibit/details?exhibit_id=${a}" title="View details" aria-label="exhibit-details"><i class="fa fa-folder-open pr-1"></i> </a>`;m;t.innerHTML=`
                        ${e}&nbsp;
                        ${i}&nbsp;
                        <i title="Can only delete if unpublished" style="color: #d3d3d3" class="fa fa-trash pr-1" aria-label="delete-exhibit"></i>`},0)),void 0!==i&&204===i.status?(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-warning" role="alert"><i class="fa fa-warning"></i> Exhibit must contain at least one item to publish</div>',setTimeout(()=>{document.querySelector("#message").innerHTML=""},5e3)):void 0===i&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-danger"></i> You do not have permission to publish this record.</div>',setTimeout(()=>{document.querySelector("#message").innerHTML=""},5e3)),!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}async function v(n){try{var e=endpointsModule.get_exhibits_endpoints(),t=authModule.get_user_token(),i=await httpModule.req({method:"POST",url:e.exhibits.exhibit_suppress.post.endpoint.replace(":exhibit_id",n.replace("-status","")),headers:{"Content-Type":"application/json","x-access-token":t}});return void 0!==i&&200===i.status?(setTimeout(()=>{let t=document.getElementById(n);document.getElementById(n).classList.remove("suppress-exhibit"),document.getElementById(n).classList.add("publish-exhibit"),document.getElementById(n).replaceWith(t.cloneNode(!0)),document.getElementById(n).innerHTML='<span id="publish" title="suppressed"><i class="fa fa-cloud-upload" style="color: darkred"></i><br>Unpublished</span>',document.getElementById(n).addEventListener("click",async e=>{e.preventDefault(),await y(t.getAttribute("id"))},!1)},0),setTimeout(()=>{n=n.replace("-status","");var e=`<a href="${m}/items?exhibit_id=${n}" title="View Exhibit Items"><i class="fa fa-list pr-1"></i></a>&nbsp;`,t=n+"-actions",t=document.getElementById(t),i=(m,`<a href="${m}/exhibits/exhibit/edit?exhibit_id=${n}" title="Edit" aria-label="edit-exhibit"><i class="fa fa-edit pr-1"></i> </a>`),a=`<a href="${m}/exhibits/exhibit/delete?exhibit_id=${n}" title="Delete exhibit" aria-label="delete-exhibit"><i class="fa fa-trash pr-1"></i></a>`;t.innerHTML=`
                        ${e}&nbsp;
                        ${i}&nbsp;
                        `+a},0)):void 0===i&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-danger"></i> You do not have permission to unplublish this record.</div>',setTimeout(()=>{},3e3)),!1}catch(e){document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> An error occurred while suppressing exhibit</div>'}}return e.display_exhibits=async function(){try{var t=await b();if(!1===t)return(l=document.querySelector("#exhibit-card"))&&(l.textContent=""),!1;if(void 0===t)return authModule.redirect_to_auth(),!1;if(!t||0===t.length)return(h=document.querySelector(".card"))&&(h.textContent=""),(e=document.querySelector("#message"))?(e.textContent="",(u=document.createElement("div")).className="alert alert-info",u.setAttribute("role","status"),u.setAttribute("aria-live","polite"),u.setAttribute("aria-atomic","true"),p=document.createTextNode("No Exhibits found."),u.appendChild(p),e.appendChild(u)):console.warn("Message element not found"),!1;var i=document.querySelector("#exhibits-data");if(!i)throw new Error("Table body element #exhibits-data not found");i.textContent="";var a=document.createDocumentFragment();for(let e=0;e<t.length;e++){s=t[e],c=void 0,(c=document.createElement("tr")).id=s.uuid,c.appendChild((e=>{var t=document.createElement("td"),i=(t.style.width="35%",(e=>{var t=document.createElement("p"),i=document.createElement("strong"),a=helperModule.strip_html(helperModule.unescape(e.title));return i.textContent=a,t.appendChild(i),1===e.is_featured&&(t.appendChild(document.createTextNode("  ")),a=x("fa fa-star","Featured","featured exhibit","#BA8E23"),t.appendChild(a)),1===e.is_locked&&(t.appendChild(document.createTextNode("  ")),i=x("fa fa-lock","Record is currently locked","exhibit-is-locked","#BA8E23"),t.appendChild(i)),t})(e)),i=(t.appendChild(i),(e=>{let t=document.createElement("p"),i=document.createElement("img"),a=m+"/static/images/image-tn.png",n;return n=e.thumbnail&&0<e.thumbnail.length?`${m}/api/v1/exhibits/${encodeURIComponent(e.uuid)}/media/`+encodeURIComponent(e.thumbnail):a,i.src=n,i.alt=e.uuid+" thumbnail",i.height=100,i.width=100,i.addEventListener("error",function(){this.src!==a&&(console.warn(`Thumbnail failed to load for exhibit ${e.uuid}, using default image`),this.src=a)}),t.appendChild(i),t})(e)),i=(t.appendChild(i),(e=>{let t=document.createElement("div"),i=(t.className="d-flex justify-content-between align-items-center",document.createElement("div")),a=(i.className="btn-group",document.createElement("span")),n=(a.id="preview-link",document.createElement("button")),r=(n.type="button",n.className="btn btn-sm btn-outline-secondary",n.setAttribute("aria-label","Preview exhibit"),document.createElement("i")),d=(r.className="menu-icon fa fa-eye",r.setAttribute("aria-hidden","true"),n.appendChild(r),n.appendChild(document.createTextNode(" ")),document.createElement("small")),l=(d.textContent="Preview",n.appendChild(d),m+"/preview?uuid="+encodeURIComponent(e.uuid)),o=(n.addEventListener("click",()=>{exhibitsModule.open_preview(l)}),a.appendChild(n),i.appendChild(a),i.appendChild(document.createTextNode("  ")),document.createElement("span")),s=(o.id="share-link",document.createElement("button")),c=(s.type="button",s.className="btn btn-sm btn-outline-secondary",s.setAttribute("aria-label","Share exhibit"),s.setAttribute("data-toggle","modal"),s.setAttribute("data-target",".shared-url-modal"),document.createElement("i")),u=(c.className="fa fa-share-alt",c.setAttribute("aria-hidden","true"),s.appendChild(c),s.appendChild(document.createTextNode(" ")),document.createElement("small"));return u.textContent="Share",s.appendChild(u),s.addEventListener("click",()=>{exhibitsModule.create_shared_preview_url(e.uuid)}),o.appendChild(s),i.appendChild(o),t.appendChild(i),t})(e)),i=(t.appendChild(i),(e=>{var t=document.createElement("p"),i=document.createElement("span"),a=(i.style.fontSize="x-small",document.createElement("em"));return a.textContent="Exhibit created by "+e,i.appendChild(a),t.appendChild(i),t})(e.created_by));return t.appendChild(i),t})(s)),c.appendChild((e=>{var t=document.createElement("td"),i=(t.style.width="5%",t.style.textAlign="center",document.createElement("small")),e=((e,t)=>{var i=document.createElement("a"),e=(i.href="#",i.id=e+"-status",i.setAttribute("aria-label","Toggle publication status"),document.createElement("span"));return 1===t?(i.className="suppress-exhibit",e.id="suppress",e.setAttribute("title","published"),(t=document.createElement("i")).className="fa fa-cloud",t.style.color="green",t.setAttribute("aria-hidden","true"),e.appendChild(t),e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode("Published"))):(i.className="publish-exhibit",e.id="publish",e.setAttribute("title","suppressed"),(t=document.createElement("i")).className="fa fa-cloud-upload",t.style.color="darkred",t.setAttribute("aria-hidden","true"),e.appendChild(t),e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode("Unpublished"))),i.appendChild(e),i})(e.uuid,e.is_published);return i.appendChild(e),t.appendChild(i),t})(s)),c.appendChild((e=>{var t=document.createElement("td"),i=(t.style.width="10%",document.createElement("div")),a=(i.className="card-text text-sm-center",i.id=e.uuid+"-actions",g(m+"/items?exhibit_id="+encodeURIComponent(e.uuid),"View Exhibit Items","view-exhibit-items","fa fa-list"));return a.classList.add("pr-1"),i.appendChild(a),i.appendChild(document.createTextNode(" ")),1===e.is_published?((a=g(m+"/exhibits/exhibit/details?exhibit_id="+encodeURIComponent(e.uuid),"View details","exhibit-details","fa fa-folder-open")).classList.add("pr-1"),i.appendChild(a),i.appendChild(document.createTextNode(" ")),(a=document.createElement("i")).className="fa fa-trash pr-1",a.setAttribute("title","Can only delete if unpublished"),a.setAttribute("aria-label","delete-exhibit"),a.style.color="#d3d3d3",i.appendChild(a)):((a=g(m+"/exhibits/exhibit/edit?exhibit_id="+encodeURIComponent(e.uuid),"Edit","edit-exhibit","fa fa-edit")).classList.add("pr-1"),i.appendChild(a),i.appendChild(document.createTextNode(" ")),(a=g(m+"/exhibits/exhibit/delete?exhibit_id="+encodeURIComponent(e.uuid),"Delete exhibit","delete-exhibit","fa fa-trash")).classList.add("pr-1"),i.appendChild(a)),t.appendChild(i),t})(s)),c.appendChild(f(s.created,"exhibit-created")),c.appendChild(f(s.updated,"exhibit-updated"));var n=c;a.appendChild(n)}i.appendChild(a);var r=(()=>{try{if(document.querySelector("#exhibits"))return new DataTable("#exhibits",{paging:!0,order:[[4,"desc"]],rowReorder:!1,language:{bottomEnd:{paging:{firstLast:!1}}}});throw new Error("Table element #exhibits not found")}catch(e){throw console.error("Error initializing DataTable:",e),e}})();if(r)try{r.on("click","tbody tr .publish-exhibit",async e=>{e.preventDefault();e=e.currentTarget.getAttribute("id");e?await y(e):console.error("No UUID found on publish button")}),r.on("click","tbody tr .suppress-exhibit",async e=>{e.preventDefault();e=e.currentTarget.getAttribute("id");e?await v(e):console.error("No UUID found on suppress button")})}catch(e){console.error("Error binding DataTable events:",e)}else console.error("DataTable instance not provided");try{var d=helperModule.get_parameter_by_name("exhibit_id");if(null!==d&&""!==d){history.replaceState({},"",m+"/exhibits"),history.pushState({},"",m+"/exhibits");let e=document.getElementById(d);e?(e.scrollIntoView({behavior:"smooth",block:"center"}),e.style.backgroundColor="#fffacd",setTimeout(()=>{e.style.backgroundColor=""},2e3)):console.warn(`Exhibit with ID ${d} not found in DOM`)}}catch(e){console.error("Error handling exhibit_id parameter:",e)}return!0}catch(e){console.error("Error displaying exhibits:",e);var l=document.querySelector("#message");return l&&(i=l,r="danger",l="Error displaying exhibits: "+e.message,i?(i.textContent="",(o=document.createElement("div")).className="alert alert-"+r,o.setAttribute("role","alert"),o.setAttribute("aria-live","polite"),o.setAttribute("aria-atomic","true"),r=x({info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"}[r]||"fa fa-info","","",""),o.appendChild(r),o.appendChild(document.createTextNode(" ")),r=document.createTextNode(l),o.appendChild(r),i.appendChild(o)):console.error("Display message: element not found")),!1}var o,s,c,e,u,p,h},e.get_exhibit_title=async function(e){try{var t=endpointsModule.get_exhibits_endpoints(),i=authModule.get_user_token(),a=await httpModule.req({method:"GET",url:t.exhibits.exhibit_records.endpoints.get.endpoint.replace(":exhibit_id",e),headers:{"Content-Type":"application/json","x-access-token":i}});if(void 0!==a&&200===a.status)return helperModule.strip_html(helperModule.unescape(a.data.data.title))}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.set_exhibit_title=async function(e){e=await exhibitsModule.get_exhibit_title(e);return document.querySelector("#exhibit-title").innerHTML=""+e,!1},e.open_preview=function(e){scrollTo(0,0);let t=authModule.get_user_token();void 0!==i&&exhibitsModule.close_preview(),document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> Building Exhibit Preview...</div>',setTimeout(()=>{i=window.open(e+"&t="+t,"_blank","location=yes,scrollbars=yes,status=yes"),document.querySelector("#message").innerHTML=""},900)},e.close_preview=function(){i.close()},e.delete_exhibit=function(){try{(async()=>{document.querySelector("#delete-message").innerHTML="Deleting exhibit...";var e=endpointsModule.get_exhibits_endpoints(),t=helperModule.get_parameter_by_name("exhibit_id"),i=authModule.get_user_token();void 0!==(e=await httpModule.req({method:"DELETE",url:e.exhibits.exhibit_records.endpoints.delete.endpoint.replace(":exhibit_id",t),headers:{"Content-Type":"application/json","x-access-token":i}}))&&204===e.status?setTimeout(()=>{window.location.replace(m+"/exhibits")},900):void 0!==e&&200===e.status?(scrollTo(0,0),document.querySelector("#delete-card").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-warning" role="alert"><i class="fa fa-warning"></i> Cannot delete an exhibit that contains items.</div>'):void 0===e&&(scrollTo(0,0),document.querySelector("#delete-card").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> You do not have permission to delete this record.</div>')})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}return!1},e.create_shared_preview_url=function(i){(async()=>{document.querySelector("#shared-url").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Generating Shared URL...</div>';var e=endpointsModule.get_exhibits_endpoints(),t=authModule.get_user_token();!1===t?setTimeout(()=>{document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Unable to get session token</div>',authModule.logout()},1e3):void 0!==(e=await httpModule.req({method:"POST",url:e.exhibits.exhibit_shared.get.endpoint+"?uuid="+i,headers:{"Content-Type":"application/json","x-access-token":t}}))&&201===e.status&&(document.querySelector("#shared-url-copy").innerText=e.data.shared_url,setTimeout(async()=>{document.querySelector("#shared-url").innerHTML=`<div class="d-flex align-items-center">
                                                                                    <p>
                                                                                    - Shared URL created.&nbsp;&nbsp; 
                                                                                    <button type="button" class="btn btn-sm btn-primary" onclick="exhibitsModule.copy();">
                                                                                    <i class="fa fa-copy"> Copy</i>
                                                                                    </button>
                                                                                    <br>
                                                                                    - Shared URL expires in 7 days.
                                                                                    </p>
                                                                                </div>`},900))})()},e.copy=function(){try{(async()=>{var e=document.querySelector("#shared-url-copy").textContent;await navigator.clipboard.writeText(e),document.querySelector("#copy-message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> URL copied to clipboard!</div>',setTimeout(()=>{document.querySelector("#copy-message").innerHTML=""},5e3)})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Failed to copy shared URL to clipboard. Error: ${e.message}</div>`}},e.init=async function(){try{var e=authModule.get_user_token();await authModule.check_auth(e),await exhibitsModule.display_exhibits(),helperModule.show_form(),navModule.set_logout_link()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e})();