let itemsAddHeadingFormModule=(()=>{let m=window.localStorage.getItem("exhibits_app_path"),t=endpointsModule.get_exhibits_endpoints(),h={};function g(e){if(t?.exhibits?.heading_records?.post?.endpoint)return t.exhibits.heading_records.post.endpoint.replace(":exhibit_id",encodeURIComponent(e));throw new Error("API endpoint configuration missing")}async function f(e,t,r){if(httpModule?.req)return await httpModule.req({method:"POST",url:e,data:t,headers:{"Content-Type":"application/json","x-access-token":r},timeout:3e4});throw new Error("HTTP module not available")}function _(e,t,r){var i,n;e&&(t=["info","success","danger","warning"].includes(t)?t:"info",(i=document.createElement("div")).className="alert alert-"+t,i.setAttribute("role","alert"),(n=document.createElement("i")).className=o(t),i.appendChild(n),t=document.createTextNode(" "+r),i.appendChild(t),e.textContent="",e.appendChild(i))}function o(e){return{info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"}[e]||"fa fa-info"}function p(e){var t={NetworkError:"Network connection error. Please check your internet connection.",TimeoutError:"Request timed out. Please try again.",AbortError:"Request was cancelled. Please try again."};if(e.name&&t[e.name])return t[e.name];if(e.response?.status){t=e.response.status;if(401===t||403===t)return"Permission denied. You do not have access to create items in this exhibit.";if(404===t)return"Exhibit not found.";if(422===t)return"Invalid data submitted. Please check your inputs.";if(500<=t)return"Server error. Please try again later."}return"Unable to create heading record. Please try again."}function g(e){if(t?.exhibits?.heading_records?.post?.endpoint)return t.exhibits.heading_records.post.endpoint.replace(":exhibit_id",encodeURIComponent(e));throw new Error("API endpoint configuration missing")}async function f(e,t,r){if(httpModule?.req)return await httpModule.req({method:"POST",url:e,data:t,headers:{"Content-Type":"application/json","x-access-token":r}});throw new Error("HTTP module not available")}function _(e,t,r){var i,n;e&&(t=["info","success","danger","warning"].includes(t)?t:"info",(i=document.createElement("div")).className="alert alert-"+t,i.setAttribute("role","alert"),(n=document.createElement("i")).className=o(t),i.appendChild(n),t=document.createTextNode(" "+r),i.appendChild(t),e.textContent="",e.appendChild(i))}function o(e){return{info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"}[e]||"fa fa-info"}function p(e){var t={NetworkError:"Network connection error. Please check your internet connection.",TimeoutError:"Request timed out. Please try again.",AbortError:"Request was cancelled. Please try again."};if(e.name&&t[e.name])return t[e.name];if(e.response?.status){t=e.response.status;if(401===t||403===t)return"Permission denied. You do not have access to create items in this exhibit.";if(404===t)return"Exhibit not found.";if(422===t)return"Invalid data submitted. Please check your inputs.";if(500<=t)return"Server error. Please try again later."}return"Unable to create heading record. Please try again."}return h.create_heading_record=async function(){var e=helperModule.get_parameter_by_name("item_id");if(e)return console.log("ðŸ”´ Item ID exists - already in edit mode, preventing duplicate creation"),console.log("Current URL:",window.location.href),console.log("item_id:",e),h.update_item_heading_record&&"function"==typeof h.update_item_heading_record?(console.log("Redirecting to update function..."),h.update_item_heading_record()):(e=document.querySelector("#message"),_(e,"warning","Already in edit mode. Update function not available."),console.error("ERROR: update_item_heading_record function not found!"),!1);if(console.log("ðŸŸ¢ CREATE FUNCTION CALLED - No item_id, proceeding with creation"),this._is_creating)return console.log("Already creating, preventing duplicate submission"),!1;this._is_creating=!0;try{var t=document.querySelector("#message");window.scrollTo({top:0,behavior:"smooth"});let i=helperModule.get_parameter_by_name("exhibit_id");if(i){_(t,"info","Creating item heading record...");var r=authModule.get_user_token();if(r&&!1!==r){var n=itemsCommonHeadingFormModule.get_common_heading_form_fields();if(n&&!1!==n){var o=helperModule.get_user_name(),a=helperModule.get_owner(),d=(o&&(n.created_by=o),a&&(n.owner=a),g(i)),s=await f(d,n,r);if(s&&201===s.status){let r=s.data?.data;if(r)return console.log("âœ… Heading record created successfully, ID:",r),_(t,"success","Heading record created successfully. Redirecting to edit page..."),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{var e=i,t=r;console.log("=== REDIRECTING TO EDIT PAGE ==="),console.log("exhibit_id:",e),console.log("item_id:",t),e=new URLSearchParams({exhibit_id:e,item_id:t}),t=m+"/items/heading/edit?"+e.toString(),console.log("Redirecting to:",t),console.log("Note: Back button will NOT return to create page"),window.location.replace(t)},1200),!0;throw new Error("Server did not return a valid item ID")}if(s)throw new Error("Unexpected response from server");_(t,"danger","Permission denied. You do not have access to add items to this exhibit.")}else _(t,"danger","Invalid form data. Please check all required fields.")}else _(t,"danger","Session expired. Please log in again."),setTimeout(()=>{authModule.logout()},1e3)}else _(t,"warning","Missing exhibit ID. Cannot create heading record.");return!1}catch(e){console.error("âŒ Error creating heading record:",e);var i=document.querySelector("#message"),c=p(e);return _(i,"danger",c),!1}finally{this._is_creating=!1}},h.create_heading_record__=async function(){if(this._is_creating)return!1;this._is_creating=!0;try{let t=document.querySelector("#message");window.scrollTo({top:0,behavior:"smooth"});var e=helperModule.get_parameter_by_name("exhibit_id");if(e){_(t,"info","Creating item heading record...");var r=authModule.get_user_token();if(r&&!1!==r){var i=itemsCommonHeadingFormModule.get_common_heading_form_fields();if(i&&!1!==i){var n=helperModule.get_user_name(),o=helperModule.get_owner(),a=(n&&(i.created_by=n),o&&(i.owner=o),g(e)),d=await f(a,i,r);if(d&&201===d.status){var s=d.data?.data;if(!s)throw new Error("Server did not return a valid item ID");_(t,"success","Heading record created successfully");var c=e,l=s;try{((e,t)=>{var r;window.history?.pushState&&(r=new URLSearchParams({exhibit_id:e,item_id:t}),r=m+"/items/heading/edit?"+r.toString(),window.history.pushState({mode:"edit",exhibit_id:e,item_id:t},"",r))})(c,l),(e=>{document.title&&(document.title=e);var t=document.querySelector("h1, .page-title");t&&(t.textContent=e)})("Edit Heading"),await("function"!=typeof display_edit_record||!await display_edit_record()),(()=>{var e=document.querySelector("form#heading-form, form");e&&(e.onsubmit,e.onsubmit=async function(e){return e.preventDefault(),!(!h.update_item_heading_record||"function"!=typeof h.update_item_heading_record)&&h.update_item_heading_record()},e=e.querySelector('input[name="mode"]'))&&(e.value="edit")})(),(()=>{var e=document.querySelector('button[type="submit"], #submit-button'),t=(e&&((t=e.querySelector(".button-text"))?t.textContent="Update Heading":e.textContent="Update Heading"),document.querySelectorAll('.edit-only, [data-mode="edit"]'));t.forEach(e=>{e.style.display="",e.classList.remove("hidden")}),(e=document.querySelectorAll('.create-only, [data-mode="create"]')).forEach(e=>{e.style.display="none",e.classList.add("hidden")}),(e=document.querySelector("#created"))&&(e.style.display="block")})()}catch(e){console.error("Error transitioning to edit mode:",e),((e,t)=>{e=new URLSearchParams({exhibit_id:e,item_id:t}),t=m+"/items/heading/edit?"+e.toString(),window.location.replace(t)})(c,l)}return await 0,setTimeout(()=>{var e;(e=t)&&(e.style.transition="opacity 0.3s ease-out",e.style.opacity="0",setTimeout(()=>{e.textContent="",e.style.opacity="1"},300))},3e3),!0}if(d)throw new Error("Unexpected response from server");_(t,"danger","Permission denied. You do not have access to add items to this exhibit.")}else _(t,"danger","Invalid form data. Please check all required fields.")}else _(t,"danger","Session expired. Please log in again."),setTimeout(()=>{authModule.logout()},1e3)}else _(t,"warning","Missing exhibit ID. Cannot create heading record.");return!1}catch(e){console.error("Error creating heading record:",e);var t=document.querySelector("#message"),u=p(e);return _(t,"danger",u),!1}finally{this._is_creating=!1}},h.init=async function(){var e=helperModule.get_parameter_by_name("exhibit_id");await authModule.check_permissions(["add_item","add_item_to_any_exhibit"],"heading",e,null,"/items?exhibit_id="+e+"&status=403"),exhibitsModule.set_exhibit_title(e),document.querySelector("#save-heading-btn").addEventListener("click",itemsAddHeadingFormModule.create_heading_record)},h})();