let authModule=(()=>{let l=window.localStorage.getItem("exhibits_app_path"),r=endpointsModule.init();var e={get_user_token:function(){var e=JSON.parse(window.sessionStorage.getItem("exhibits_token"));if(null===e||null!==e.token)return null!==e&&DOMPurify.sanitize(e.token);window.location.replace(l+"/")},get_auth_user_data:async function(){try{var e=helperModule.get_parameter_by_name("id");if(null!==e){authModule.save_token();var t=authModule.get_user_token(),a=r.authenticate+"?id="+e,i=await httpModule.req({method:"GET",url:a,headers:{"Content-Type":"application/json","x-access-token":t}});if(200===i.status)return authModule.save_user_auth_data(i.data),!0;authModule.redirect_to_auth()}}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},get_user_profile_data:function(){try{var e=window.sessionStorage.getItem("exhibits_user");if(null!==e)return JSON.parse(e);authModule.redirect_to_auth()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},get_user_role:async function(e){try{var t=this.get_user_token(),a="/exhibits-dashboard/auth/role?user_id="+e,i=await httpModule.req({method:"GET",url:a,headers:{"Content-Type":"application/json","x-access-token":t}});if(200===i.status)return i.data[0].role}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},check_user_auth_data:function(){try{return null!==window.sessionStorage.getItem("exhibits_user")?!0:!1}catch(e){document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to check user auth data</div>'}},save_user_auth_data:function(e){var t={uid:DOMPurify.sanitize(e.user_data.data[0].id),name:DOMPurify.sanitize(e.user_data.data[0].first_name)+" "+DOMPurify.sanitize(e.user_data.data[0].last_name)};endpointsModule.save_exhibits_endpoints(e),window.sessionStorage.setItem("exhibits_user",JSON.stringify(t))},save_token:function(){var e=helperModule.get_parameter_by_name("t");null!==e&&(e={token:DOMPurify.sanitize(e)},window.sessionStorage.setItem("exhibits_token",JSON.stringify(e)))},check_auth:async function(e){try{if(!1===e)return document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Session Expired. One moment please...</div>',authModule.redirect_to_auth(),!1;var t=endpointsModule.get_exhibits_endpoints();void 0===await httpModule.req({method:"POST",url:t.exhibits.token_verify.endpoint,headers:{"Content-Type":"application/json","x-access-token":e}})&&window.location.replace(l+"/session")}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},check_permissions:async function(e,t,a,i,r){try{var n=authModule.get_user_token();if(!1===n)return document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Session Expired. One moment please...</div>',authModule.redirect_to_auth(),!1;var o={permissions:e,record_type:t,parent_id:a,child_id:i},s=await httpModule.req({method:"POST",url:"/exhibits-dashboard/auth/permissions",headers:{"Content-Type":"application/json","x-access-token":n},data:o});void 0===s&&void 0===r?window.location.replace(l+"/access-denied"):void 0===s&&void 0!==r?window.location.replace(l+r):void 0!==s&&200===s.status&&console.log("Authorized")}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},redirect_to_auth:function(){setTimeout(()=>{window.location.replace(l+"/auth")},4e3)},clear:function(){window.sessionStorage.clear(),window.localStorage.clear()},logout:function(){window.location.replace(l+"/logout")},init:function(){}};return e})();