let itemsEditGridItemFormModule=(()=>{let g=window.localStorage.getItem("exhibits_app_path"),v=endpointsModule.get_exhibits_endpoints();var e={};async function t(){try{var a=await(async()=>{try{var e,t=helperModule.get_parameter_by_name("exhibit_id"),i=helperModule.get_parameter_by_name("grid_id"),a=helperModule.get_parameter_by_name("item_id"),r=authModule.get_user_token(),l=authModule.get_user_profile_data(),o=v.exhibits.grid_item_record.get.endpoint.replace(":exhibit_id",t).replace(":grid_id",i).replace(":item_id",a);return!1===r?(document.querySelector("#message").innerHTML="ERROR: Unable to get API endpoints",setTimeout(()=>{window.location.replace(g+"/exhibits-dashboard/auth")},1e3),!1):void 0!==(e=await httpModule.req({method:"GET",url:o+"?type=edit&uid="+l.uid,headers:{"Content-Type":"application/json","x-access-token":r}}))&&200===e.status?e.data.data[0]:void 0}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})();let e="",t="";var r=a.is_published,l=a.created_by,o=new Date(a.created),d=a.updated_by,m=a.updated,n=new Date(m);let i="";var c=helperModule.format_date(o),u=helperModule.format_date(n);if(helperModule.check_if_locked(a,"#item-submit-card"),null!==l&&(i+=`<em>Created by ${l} on ${c}</em>`),null!==d&&(i+=` | <em>Last updated by ${d} on ${u}</em>`),document.querySelector("#created").innerHTML=i,null!==document.querySelector("#is-published")&&1===r?document.querySelector("#is-published").value=!0:null!==document.querySelector("#is-published")&&0===r&&(document.querySelector("#is-published").value=!1),document.querySelector("#item-title-input").value=helperModule.unescape(a.title),document.querySelector("#item-text-input").value=helperModule.unescape(a.text),-1!==window.location.pathname.indexOf("media")){if(document.querySelector("#item-description-input").value=helperModule.unescape(a.description),document.querySelector("#item-caption-input").value=a.caption,document.querySelector("#pdf-open-to-page").value=a.pdf_open_to_page,1===a.is_embedded?document.querySelector("#embed-item").checked=!0:document.querySelector("#embed-item").checked=!1,1===a.is_alt_text_decorative?(document.querySelector("#is-alt-text-decorative").checked=!0,document.querySelector("#item-alt-text-input").disabled=!0):(document.querySelector("#is-alt-text-decorative").checked=!1,document.querySelector("#item-alt-text-input").value=helperModule.unescape(a.alt_text)),0<a.media.length){if(0===a.is_repo_item&&0===a.is_kaltura_item&&(-1!==a.mime_type.indexOf("image")?(t=v.exhibits.exhibit_media.get.endpoint.replace(":exhibit_id",a.is_member_of_exhibit).replace(":media",a.media),e=`<p><img src="${t}" height="200" ></p>`,document.querySelector("#image-alt-text").style.display="block",1===a.is_alt_text_decorative?(document.querySelector("#is-alt-text-decorative").checked=!0,document.querySelector("#item-alt-text-input").disabled=!0):(document.querySelector("#is-alt-text-decorative").checked=!1,document.querySelector("#item-alt-text-input").value=helperModule.unescape(a.alt_text))):-1!==a.mime_type.indexOf("video")?(t="/exhibits-dashboard/static/images/video-tn.png",e=`<p><img src="${t}" height="200" ></p>`):-1!==a.mime_type.indexOf("audio")?(t="/exhibits-dashboard/static/images/audio-tn.png",e=`<p><img src="${t}" height="200" ></p>`):-1!==a.mime_type.indexOf("pdf")?(t="/exhibits-dashboard/static/images/pdf-tn.png",e=`<p><img src="${t}" height="200" ></p>`,document.querySelector("#toggle-open-to-page").style.visibility="visible"):console.log("Unable to Determine Type"),document.querySelector("#item-media-trash").style.display="inline",document.querySelector("#item-media-filename-display").innerHTML=`<span style="font-size: 11px">${a.media}</span>`),document.querySelector("#item-type").value=a.item_type,1===a.is_repo_item&&(document.getElementById("upload-media-tab").classList.remove("active"),document.getElementById("import-repo-media-tab").classList.add("active"),document.getElementById("upload-media").classList.remove("active"),document.getElementById("upload-media").classList.remove("show"),document.getElementById("import-repo-media").classList.add("show"),document.getElementById("import-repo-media").classList.add("active"),document.getElementById("upload-media-tab").setAttribute("aria-selected","false"),document.getElementById("import-repo-media-tab").setAttribute("aria-selected","true"),document.querySelector("#repo-uuid").value=a.media,await helperModule.get_repo_item_data(null)),1===a.is_kaltura_item){document.getElementById("upload-media-tab").classList.remove("active"),document.getElementById("import-audio-video-tab").classList.add("active"),document.getElementById("upload-media").classList.remove("active"),document.getElementById("upload-media").classList.remove("show"),document.getElementById("import-audio-video").classList.add("show"),document.getElementById("import-audio-video").classList.add("active"),document.getElementById("upload-media-tab").setAttribute("aria-selected","false"),document.getElementById("import-audio-video-tab").setAttribute("aria-selected","true"),document.querySelector("#audio-video").value=a.media;var s=document.getElementsByName("item_type");for(let e=0;e<s.length;e++)s[e].value===a.item_type&&(document.querySelector("#"+s[e].id).checked=!0);document.querySelector("#item-type").value="kaltura"}document.querySelector("#item-mime-type").value=helperModule.unescape(a.mime_type),document.querySelector("#item-media-thumbnail-image-display").innerHTML=e,document.querySelector("#item-media").value=a.media,document.querySelector("#item-media-prev").value=a.media}0<a.thumbnail.length&&(t=v.exhibits.exhibit_media.get.endpoint.replace(":exhibit_id",a.is_member_of_exhibit).replace(":media",a.thumbnail),e=`<p><img src="${t}" height="200" ></p>`,document.querySelector("#item-thumbnail-image-display").innerHTML=e,document.querySelector("#item-thumbnail-filename-display").innerHTML=`<span style="font-size: 11px">${a.thumbnail}</span>`,document.querySelector("#item-thumbnail").value=a.thumbnail,document.querySelector("#item-thumbnail-image-prev").value=a.thumbnail,document.querySelector("#item-thumbnail-trash").style.display="inline")}var p=document.getElementsByName("layout");for(let e=0;e<p.length;e++)p[e].value===a.layout&&(document.querySelector("#"+p[e].id).checked=!0);var y=document.getElementsByName("media_width");for(let e=0;e<y.length;e++)parseInt(y[e].value)===parseInt(a.media_width)&&(document.querySelector("#"+y[e].id).checked=!0);var h=JSON.parse(a.styles);if(0!==Object.keys(h).length){void 0!==h.backgroundColor?(document.querySelector("#item-background-color").value=h.backgroundColor,document.querySelector("#item-background-color-picker").value=h.backgroundColor):document.querySelector("#item-background-color").value="",void 0!==h.color?(document.querySelector("#item-font-color").value=h.color,document.querySelector("#item-font-color-picker").value=h.color):document.querySelector("#item-font-color").value="";var _=document.querySelector("#item-font");for(let e=0;e<_.length;e++)_[e].value===h.fontFamily&&(document.querySelector("#item-font").value=h.fontFamily);void 0!==h.fontSize?document.querySelector("#item-font-size").value=h.fontSize.replace("px",""):document.querySelector("#item-font-size").value=""}return!1}catch(e){console.log(e),document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}function i(){try{(async()=>{var e=helperModule.get_parameter_by_name("exhibit_id"),t=helperModule.get_parameter_by_name("grid_id"),i=helperModule.get_parameter_by_name("item_id"),a=document.querySelector("#item-media").value,e=v.exhibits.grid_item_media.delete.endpoint.replace(":exhibit_id",e).replace(":grid_id",t).replace(":item_id",i).replace(":media",a),t=authModule.get_user_token();void 0!==(i=await httpModule.req({method:"DELETE",url:e,headers:{"Content-Type":"application/json","x-access-token":t}}))&&204===i.status&&(document.querySelector("#item-media").value="",document.querySelector("#item-media-filename-display").innerHTML="",document.querySelector("#item-media-trash").style.display="none",document.querySelector("#item-media-thumbnail-image-display").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Media deleted</div>',setTimeout(()=>{document.querySelector("#message").innerHTML="",window.location.reload()},900))})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}function a(){try{(async()=>{var e=helperModule.get_parameter_by_name("exhibit_id"),t=helperModule.get_parameter_by_name("grid_id"),i=helperModule.get_parameter_by_name("item_id"),a=document.querySelector("#item-thumbnail").value,e=v.exhibits.grid_item_media.delete.endpoint.replace(":exhibit_id",e).replace(":grid_id",t).replace(":item_id",i).replace(":media",a),t=authModule.get_user_token();void 0!==(i=await httpModule.req({method:"DELETE",url:e,headers:{"Content-Type":"application/json","x-access-token":t}}))&&204===i.status&&(document.querySelector("#item-thumbnail").value="",document.querySelector("#item-thumbnail-filename-display").innerHTML="",document.querySelector("#item-thumbnail-trash").style.display="none",document.querySelector("#item-thumbnail-image-display").innerHTML="",document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Thumbnail deleted</div>',setTimeout(()=>{document.querySelector("#message").innerHTML="",window.location.reload()},900))})()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}return!1}return e.update_grid_item_record=async function(){try{window.scrollTo(0,0);var e=helperModule.get_parameter_by_name("exhibit_id"),t=helperModule.get_parameter_by_name("grid_id"),i=helperModule.get_parameter_by_name("item_id");if(void 0===e||void 0===t||void 0===i)return!(document.querySelector("#message").innerHTML='<div class="alert alert-warning" role="alert"><i class="fa fa-info"></i> Unable to update grid item record.</div>');document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Updating grid item record...</div>';var a=itemsCommonGridItemFormModule.get_common_grid_item_form_fields();if(void 0===a)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get form field values</div>');if(!1===a)return!1;var r=JSON.parse(sessionStorage.getItem("exhibits_user"));if(null===r.name)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to retrieve your name</div>');a.updated_by=r.name;var l=v.exhibits.grid_item_records.put.endpoint.replace(":exhibit_id",e).replace(":grid_id",t).replace(":item_id",i),o=authModule.get_user_token(),d=await httpModule.req({method:"PUT",url:l,data:a,headers:{"Content-Type":"application/json","x-access-token":o}});void 0!==d&&201===d.status&&(document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Grid item record updated</div>',setTimeout(()=>{window.location.reload()},900))}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.init=async function(){try{var e=helperModule.get_parameter_by_name("exhibit_id");exhibitsModule.set_exhibit_title(e),navModule.back_to_grid_items(),await t(),document.querySelector("#save-item-btn").addEventListener("click",itemsEditGridItemFormModule.update_grid_item_record),-1!==window.location.pathname.indexOf("media")&&(document.querySelector("#is-alt-text-decorative").addEventListener("click",()=>{helperModule.toggle_alt_text()}),setTimeout(()=>{0===document.querySelector("#item-media").value.length?(document.querySelector("#item-media-trash").removeEventListener("click",i),document.querySelector("#item-media-trash").addEventListener("click",itemsCommonGridItemFormModule.delete_media)):0!==document.querySelector("#item-media").value&&(document.querySelector("#item-media-trash").removeEventListener("click",itemsCommonGridItemFormModule.delete_media),document.querySelector("#item-media-trash").addEventListener("click",i)),0===document.querySelector("#item-thumbnail").value.length?(document.querySelector("#item-thumbnail-trash").removeEventListener("click",a),document.querySelector("#item-thumbnail-trash").addEventListener("click",itemsCommonGridItemFormModule.delete_thumbnail_image)):0!==document.querySelector("#item-thumbnail").value.length&&(document.querySelector("#item-thumbnail-trash").removeEventListener("click",itemsCommonGridItemFormModule.delete_thumbnail_image),document.querySelector("#item-thumbnail-trash").addEventListener("click",a))},1e3))}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e})();