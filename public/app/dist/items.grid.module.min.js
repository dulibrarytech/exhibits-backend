let itemsGridModule=(()=>{let s=window.localStorage.getItem("exhibits_app_path"),l=endpointsModule.get_exhibits_endpoints();var e={};async function n(d){try{let a=helperModule.get_parameter_by_name("exhibit_id"),r=helperModule.get_parameter_by_name("grid_id");var e=d,t=endpointsModule.get_exhibits_endpoints().exhibits.grid_item_records.grid_item_publish.post.endpoint.replace(":exhibit_id",a).replace(":grid_id",r).replace(":grid_item_id",e),i=authModule.get_user_token(),l=await httpModule.req({method:"POST",url:t+"?type=grid_item",headers:{"Content-Type":"application/json","x-access-token":i}});return 200===l.status&&(setTimeout(()=>{let t=document.getElementById(d);document.getElementById(d).classList.remove("publish-item"),document.getElementById(d).classList.add("suppress-item"),document.getElementById(d).replaceWith(t.cloneNode(!0)),document.getElementById(d).innerHTML='<span id="suppress" title="published"><i class="fa fa-cloud" style="color: green"></i><br>Published</span>',document.getElementById(d).addEventListener("click",async e=>{e.preventDefault(),await o(t.getAttribute("id"))},!1)},0),setTimeout(()=>{var e=Array.from(document.querySelectorAll("tr")).map(e=>e.id).filter(e=>e).find(e=>{e=e.split("_");return d===e[0]}).split("_");let t;t="griditem"===e[1]&&"text"===e[2]?`${s}/items/grid/item/text/details?exhibit_id=${a}&grid_id=${r}&item_id=`+d:`${s}/items/grid/item/media/details?exhibit_id=${a}&grid_id=${r}&item_id=`+d;var e=document.getElementById(d+"-item-actions"),i=`<a href="${t}" title="View details" aria-label="item-details"><i class="fa fa-folder-open pr-1"></i> </a>`;e.innerHTML=`
                        <div class="card-text text-sm-center">
                        ${i}&nbsp;
                        <i title="Can only delete if unpublished" style="color: #d3d3d3" class="fa fa-trash pr-1" aria-label="delete-grid-item"></i>
                        </div>`},0)),204===l.status&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to publish grid item</div>',setTimeout(()=>{document.querySelector("#message").innerHTML=""},5e3)),!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}async function o(l){try{let r=helperModule.get_parameter_by_name("exhibit_id"),d=helperModule.get_parameter_by_name("grid_id");var e=l,t=endpointsModule.get_exhibits_endpoints().exhibits.grid_item_records.grid_item_suppress.post.endpoint.replace(":exhibit_id",r).replace(":grid_id",d).replace(":grid_item_id",e),i=authModule.get_user_token(),a=await httpModule.req({method:"POST",url:t+"?type=grid_item",headers:{"Content-Type":"application/json","x-access-token":i}});return 200===a.status&&(setTimeout(()=>{let t=document.getElementById(l);document.getElementById(l).classList.remove("suppress-item"),document.getElementById(l).classList.add("publish-item"),document.getElementById(l).replaceWith(t.cloneNode(!0)),document.getElementById(l).innerHTML='<span id="publish" title="suppressed"><i class="fa fa-cloud-upload" style="color: darkred"></i><br>Suppressed</span>',document.getElementById(l).addEventListener("click",async e=>{e.preventDefault(),await n(t.getAttribute("id"))},!1)},0),setTimeout(()=>{var e=Array.from(document.querySelectorAll("tr")).map(e=>e.id).filter(e=>e).find(e=>{e=e.split("_");return l===e[0]}).split("_");let t;t="griditem"===e[1]&&"text"===e[2]?`${s}/items/grid/item/text/edit?exhibit_id=${r}&grid_id=${d}&item_id=`+l:`${s}/items/grid/item/media/edit?exhibit_id=${r}&grid_id=${d}&item_id=`+l,e=`${s}/items/grid/item/delete?exhibit_id=${r}&grid_id=${d}&item_id=`+l;var i=l+"-item-actions",i=document.getElementById(i),a=`<a href="${t}" title="Edit item" aria-label="edit-item"><i class="fa fa-edit pr-1"></i> </a>`;i.innerHTML=`
                        <div class="card-text text-sm-center">
                        ${""}&nbsp;
                        ${a}&nbsp;
                        ${`<a href="${e}" title="Delete item" aria-label="delete-item"><i class="fa fa-trash pr-1"></i></a>`}
                        </div>`},0)),204===a.status&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-warning" role="alert"><i class="fa fa-warning"></i> Unable to unpublish grid item</div>',setTimeout(()=>{document.querySelector("#message").innerHTML=""},5e3)),!1}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}return e.display_grid_items=async function(e){var t=helperModule.get_parameter_by_name("exhibit_id"),i=helperModule.get_parameter_by_name("grid_id"),a=(await exhibitsModule.set_exhibit_title(t),await(async(e,t)=>{try{var i=l.exhibits.grid_item_records.get.endpoint.replace(":exhibit_id",e),a=authModule.get_user_token(),r=i.replace(":grid_id",t),d=await httpModule.req({method:"GET",url:r,headers:{"Content-Type":"application/json","x-access-token":a}});if(void 0!==d&&200===d.status)return d.data.data}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})(t,i));let r="";var d=[];if(!1===a)return document.querySelector("#item-card").innerHTML="",!1;if(0===a.length)return document.querySelector(".card").innerHTML="",!(document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert">Grid is empty.</div>');for(let e=0;e<a.length;e++)d.push(a[e].order),r+=await itemsListDisplayModule.display_grid_items(a[e]);document.querySelector("#grid-item-list").innerHTML=r,new DataTable("#grid-items",{paging:!1,rowReorder:!0}).on("row-reordered",async(e,t)=>{await helperModule.reorder_items(e,t)});try{Array.from(document.getElementsByClassName("publish-item")).forEach(t=>{t.addEventListener("click",async e=>{e.preventDefault(),await n(t.getAttribute("id"))})})}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}try{Array.from(document.getElementsByClassName("suppress-item")).forEach(t=>{t.addEventListener("click",async e=>{e.preventDefault(),await o(t.getAttribute("id"))})})}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.delete_grid_item=async function(){try{document.querySelector("#delete-message").innerHTML="Deleting grid item...";let e=helperModule.get_parameter_by_name("exhibit_id"),t=helperModule.get_parameter_by_name("grid_id");var i=helperModule.get_parameter_by_name("item_id"),a=l.exhibits.grid_item_records.delete.endpoint.replace(":exhibit_id",e).replace(":grid_id",t).replace(":item_id",i),r=authModule.get_user_token(),d=await httpModule.req({method:"DELETE",url:a+"?type=grid_item",headers:{"Content-Type":"application/json","x-access-token":r}});void 0!==d&&204===d.status&&setTimeout(()=>{window.location.replace(`${s}/items/grid/items?exhibit_id=${e}&grid_id=`+t)},900)}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.init=async function(){try{var e=authModule.get_user_token();await authModule.check_auth(e),navModule.init(),navModule.back_to_items(),navModule.set_preview_link(),navModule.set_grid_item_nav_menu_links(),navModule.set_logout_link(),helperModule.show_form()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e})();