let exhibitsDetailsModule=(()=>{let m=window.localStorage.getItem("exhibits_app_path"),c=endpointsModule.get_exhibits_endpoints();var e={};async function l(){var t=(e,t="danger",r="fa-exclamation")=>{var o,n=document.querySelector("#message");n?((o=document.createElement("div")).className="alert alert-"+t,o.setAttribute("role","alert"),(t=document.createElement("i")).className="fa "+r,r=document.createTextNode(" "+e),o.appendChild(t),o.appendChild(r),n.innerHTML="",n.appendChild(o)):console.error("Message element not found")};try{if(!c||"object"!=typeof c)return console.error("EXHIBITS_ENDPOINTS is not available"),t("Configuration error: API endpoints not available","danger","fa-exclamation"),authModule.redirect_to_auth(),null;var e=helperModule.get_parameter_by_name("exhibit_id");if(!e)return t("Missing required parameter: exhibit_id","danger","fa-exclamation"),null;var r=authModule.get_user_token();if(!r)return console.error("Authentication token not available"),t("Authentication error: Please log in again","warning","fa-lock"),authModule.redirect_to_auth(),null;var o=authModule.get_user_profile_data();if(!o||!o.uid)return console.error("User profile not available"),t("User profile error: Please log in again","warning","fa-user"),authModule.redirect_to_auth(),null;var n=c.exhibits?.exhibit_records?.endpoints?.get?.endpoint;if(!n)throw new Error("Endpoint configuration not found");(async e=>{var t=document.querySelector("#exhibit-title");if(t)try{var r=await exhibitsModule.get_exhibit_title(e);r&&(t.textContent=r)}catch(e){console.error("Error getting exhibit title:",e)}else console.warn("Exhibit title element not found")})(e).catch(e=>{console.error("Failed to set exhibit title:",e)});var a=encodeURIComponent(e),i=n.replace(":exhibit_id",a)+"?"+(e=>{var t,r,o=new URLSearchParams;for([t,r]of Object.entries(e))null!=r&&o.append(t,r);return o.toString()})({uid:o.uid}),l=await Promise.race([httpModule.req({method:"GET",url:i,headers:{"Content-Type":"application/json","x-access-token":r}}),new Promise((e,t)=>setTimeout(()=>t(new Error("Request timeout")),3e4))]);if(!l)throw new Error("No response received from server");if(200!==l.status)throw new Error("Server returned status "+l.status);if(!l.data||!l.data.data)throw new Error("Invalid response structure from server");if(0===l.data.data.length)throw new Error("Exhibit record not found");return l.data.data}catch(e){return console.error("Error getting exhibit details record:",e),t(e.message||"An unexpected error occurred while loading the exhibit record","danger","fa-exclamation"),null}}async function a(){let s=(e,t)=>{e=document.querySelector(e);e&&null!=t&&(e.value=t)};var t=(e,t)=>{e=document.querySelector(e);e&&(e.checked=Boolean(t))};let p=(e,t)=>{e=document.querySelector(e);e&&t&&(e.innerHTML="",e.appendChild(t))};var r=(e,t,r,o,n,a,i)=>{var l,c,u,d,t=e[t];t&&0!==t.length&&(e=m+`/api/v1/exhibits/${e.uuid}/media/`+t,l=t,e=e,d=200,c=document.createElement("p"),(u=document.createElement("img")).alt=l||"",u.src=e,u.height=d,c.appendChild(u),l=c,e=t,(d=document.createElement("span")).style.fontSize="11px",d.textContent=e,u=d,p(r,l),p(o,u),s(n,t),s(a,t),((e,t)=>{e=document.querySelector(e);e&&(e.style.display=t)})(i,"inline"))};var o=(e,t,r)=>{t&&t.exhibit&&t.exhibit[e]&&((t=t.exhibit[e]).backgroundColor&&(s(r.backgroundColor.input,t.backgroundColor),s(r.backgroundColor.picker,t.backgroundColor)),t.color&&(s(r.color.input,t.color),s(r.color.picker,t.color)),t.fontFamily&&((e,t)=>{var r=document.querySelector(e);if(r&&t)for(let e=0;e<r.options.length;e++)if(r.options[e].value===t){r.value=t;break}})(r.fontFamily.select,t.fontFamily),t.fontSize)&&(e=String(t.fontSize).replace("px",""),s(r.fontSize.input,e))};try{var n=await l();if(!n)throw new Error("Failed to retrieve exhibit record");((e,t,r,o)=>{let n=document.querySelector("#created");var a,i;n&&(a=[],e&&t&&(t=new Date(t),t=helperModule.format_date(t),(i=document.createElement("em")).textContent=`Created by ${e} on `+t,a.push(i)),r&&o&&(e=new Date(o),t=helperModule.format_date(e),0<a.length&&a.push(document.createTextNode(" | ")),(i=document.createElement("em")).textContent=`Last updated by ${r} on `+t,a.push(i)),n.innerHTML="",a.forEach(e=>n.appendChild(e)))})(n.created_by,n.created,n.updated_by,n.updated);var a=1===n.is_published;if(s("#is-published",a),s("#exhibit-title-input",helperModule.unescape(n.title||"")),s("#exhibit-sub-title-input",helperModule.unescape(n.subtitle||"")),s("#exhibit-description-input",helperModule.unescape(n.description||"")),s("#exhibit-about-the-curators-input",helperModule.unescape(n.about_the_curators||"")),t("#is-featured",1===n.is_featured),t("#is-student-curated",1===n.is_student_curated),n.alert_text&&0<n.alert_text.length&&(t("#is-content-advisory",!0),s("#exhibit-alert-text-input",helperModule.unescape(n.alert_text))),n.hero_image&&r(n,"hero_image","#hero-image-display","#hero-image-filename-display","#hero-image","#hero-image-prev","#hero-trash"),n.thumbnail&&r(n,"thumbnail","#thumbnail-image-display","#thumbnail-filename-display","#thumbnail-image","#thumbnail-image-prev","#thumbnail-trash"),n.banner_template&&((e,t)=>{if(t){var r=document.getElementsByName(e);for(let e=0;e<r.length;e++)if(r[e].value===t){r[e].checked=!0;break}}})("banner_template",n.banner_template),n.styles)try{var e=JSON.parse(n.styles),i={navigation:{backgroundColor:{input:"#nav-background-color",picker:"#nav-background-color-picker"},color:{input:"#nav-font-color",picker:"#nav-font-color-picker"},fontFamily:{select:"#nav-font"},fontSize:{input:"#nav-font-size"}},template:{backgroundColor:{input:"#template-background-color",picker:"#template-background-color-picker"},color:{input:"#template-font-color",picker:"#template-font-color-picker"},fontFamily:{select:"#template-font"},fontSize:{input:"#template-font-size"}},introduction:{backgroundColor:{input:"#introduction-background-color",picker:"#introduction-background-color-picker"},color:{input:"#introduction-font-color",picker:"#introduction-font-color-picker"},fontFamily:{select:"#introduction-font"},fontSize:{input:"#introduction-font-size"}}};o("navigation",e,i.navigation),o("template",e,i.template),o("introduction",e,i.introduction)}catch(e){console.error("Error parsing styles JSON:",e)}return!1}catch(e){console.error("Error displaying details record:",e);a=e.message||"An error occurred while loading the exhibit record";return t=a,(r=document.querySelector("#message"))?((n=document.createElement("div")).className="alert alert-danger",n.setAttribute("role","alert"),(o=document.createElement("i")).className="fa fa-exclamation",t=document.createTextNode(" "+t),n.appendChild(o),n.appendChild(t),r.innerHTML="",r.appendChild(n)):console.error("Message element not found"),!1}}return e.init=async function(){var e,t,r,o,n=(e,t="danger",r="fa-exclamation")=>{var o,n=document.querySelector("#message");n?((o=document.createElement("div")).className="alert alert-"+t,o.setAttribute("role","alert"),(t=document.createElement("i")).className="fa "+r,r=document.createTextNode(" "+e),o.appendChild(t),o.appendChild(r),n.innerHTML="",n.appendChild(o)):console.error("Message element not found")};try{return"403"===helperModule.get_parameter_by_name("status")&&n("You do not have permission to edit this record.","danger","fa-exclamation"),navModule&&"function"==typeof navModule.back_to_exhibits&&navModule.back_to_exhibits(),e="#save-exhibit-btn",t="click",r=exhibitsDetailsModule?.update_exhibit_record,(o=document.querySelector(e))&&r&&"function"==typeof r?o.addEventListener(t,r):console.warn("Could not attach listener to: "+e),await a(),console.log("Module initialized successfully"),!0}catch(e){return console.error("Error initializing module:",e),n(e.message||"An error occurred during initialization","danger","fa-exclamation"),!1}},e})();