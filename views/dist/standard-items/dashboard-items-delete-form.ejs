<%- include('../partials/header.ejs'); %> <body> <%- include('../partials/nav.ejs'); %> <div id="right-panel" class="right-panel"> <%- include('../partials/main-header.ejs'); %> <div class="content" style="min-height: 875px;"><div id="message"></div><div id="delete-card" class="card"><div class="card-header"><strong class="card-title mb-3"></strong></div><div class="card-body"><div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Are you sure you want to delete this item from the <strong><span id="exhibit-title"></span></strong> exhibit?&nbsp;&nbsp; <button class="btn btn-danger" type="button" id="delete-item-btn"><i class="fa fa-trash"></i>&nbsp;&nbsp;<span id="delete-message">Delete</span></button></div></div></div></div><div class="clearfix"></div> <%- include('../partials/footer.ejs'); %> </div><!-- libs --> <%- include('../partials/exhibits-libs-common.ejs'); %> <!-- app --> <%- include('../partials/exhibits-app-common.ejs'); %> <script src="/exhibits-dashboard/static/app/dist/exhibits.module.min.js?<%=build_version%>"></script><script src="/exhibits-dashboard/static/app/dist/items.module.min.js?<%=build_version%>"></script><script>(async function () {

        'use strict';

        /**
         * Displays a message safely in the message container
         * @param {string} message - Message text to display
         * @param {string} type - Alert type: 'danger', 'warning', 'info', 'success'
         */
        function display_message(message, type = 'danger') {
            const message_el = document.querySelector('#message');

            if (message_el === null) {
                return;
            }

            const alert_div = document.createElement('div');
            alert_div.className = `alert alert-${type}`;
            alert_div.setAttribute('role', 'alert');

            const icon = document.createElement('i');
            icon.className = 'fa fa-exclamation';
            icon.setAttribute('aria-hidden', 'true');

            alert_div.appendChild(icon);
            alert_div.appendChild(document.createTextNode(` ${message}`));

            message_el.innerHTML = '';
            message_el.appendChild(alert_div);
        }

        /**
         * Initializes the delete item page
         */
        async function init_delete_item() {

            try {

                const status = helperModule.get_parameter_by_name('status');
                const exhibit_id = helperModule.get_parameter_by_name('exhibit_id');
                const item_id = helperModule.get_parameter_by_name('item_id');

                if (status === '403') {

                    display_message('You do not have permission to delete this item.');

                    window.history.replaceState(
                        { page: 'items' },
                        '',
                        `/exhibits-dashboard/items/delete?exhibit_id=${encodeURIComponent(exhibit_id)}`
                    );

                } else {

                    const redirect = `/items/delete?exhibit_id=${encodeURIComponent(exhibit_id)}&status=403`;
                    await authModule.check_permissions(['delete_item', 'delete_any_item'], 'item', exhibit_id, item_id, redirect);
                    await exhibitsModule.set_exhibit_title(exhibit_id);

                    const delete_btn = document.querySelector('#delete-item-btn');

                    if (delete_btn !== null) {
                        delete_btn.addEventListener('click', itemsModule.delete_item);
                    }

                    helperModule.show_form();
                }

                navModule.set_item_list_link();

            } catch (error) {
                display_message(error.message);
            }
        }

        await init_delete_item();

    })();</script></body>