let exhibitsAddFormModule=(()=>{let l=window.localStorage.getItem("exhibits_app_path"),d=endpointsModule.get_exhibits_endpoints();var e={};function s(){var t,r=(e,t=null)=>null==e||""===e||(e=Number(e),isNaN(e))?t:e;try{if(!((e,t)=>{if(!e||"object"!=typeof e)return!1;for(var r of t)if("function"!=typeof e[r])return console.error(`Required method '${r}' not found in module`),!1;return!0})(exhibitsCommonFormModule,["get_common_form_fields","get_exhibit_styles"]))throw new Error("exhibitsCommonFormModule is not properly configured");var o=exhibitsCommonFormModule.get_common_form_fields();if(!1===o||!o)return!1;if("object"!=typeof o)throw new Error("Invalid exhibit data format");var n=exhibitsCommonFormModule.get_exhibit_styles();if(n&&"object"==typeof n)return o.styles=n,"is_published"in o&&(o.is_published=r(o.is_published,0)),"owner"in o&&(o.owner=r(o.owner,null)),o;throw new Error("Failed to retrieve exhibit styles")}catch(e){console.error("Error getting exhibit data:",e);var n=e.message||"An error occurred while processing exhibit data";return r=n,(o=document.querySelector("#message"))?((n=document.createElement("div")).className="alert alert-danger",n.setAttribute("role","alert"),(t=document.createElement("i")).className="fa fa-exclamation",r=document.createTextNode(" "+r),n.appendChild(t),n.appendChild(r),o.innerHTML="",o.appendChild(n)):console.error("Message element not found"),!1}}return e.create_exhibit_record=async function(){let n=document.querySelector("#message");var t=(e,t,r="fa-info")=>{var o;n?((o=document.createElement("div")).className="alert alert-"+e,o.setAttribute("role","alert"),(e=document.createElement("i")).className="fa "+r,r=document.createTextNode(" "+t),o.appendChild(e),o.appendChild(r),n.innerHTML="",n.appendChild(o)):console.error("Message element not found")};let r=null;try{window.scrollTo({top:0,left:0,behavior:"instant"});var o=authModule.get_user_token();if(!o)return t("warning","Unable to get session token"),r=setTimeout(()=>{authModule.logout()},1e3),!1;var i=s();if(!i)return!1;t("info","Creating exhibit record..."),i.created_by=helperModule.get_user_name(),i.owner=helperModule.get_owner();var a=await Promise.race([httpModule.req({method:"POST",url:d.exhibits.exhibit_records.endpoint,data:i,headers:{"Content-Type":"application/json","x-access-token":o}}),new Promise((e,t)=>setTimeout(()=>t(new Error("Request timeout")),3e4))]);if(!a||201!==a.status)throw new Error("Failed to create exhibit record");if(!a.data?.data)throw new Error("Invalid response from server");t("success","Exhibit record created");let e=encodeURIComponent(a.data.data);return r=setTimeout(()=>{window.location.href=l+"/items?exhibit_id="+e},900),!0}catch(e){return r&&clearTimeout(r),console.error("Create exhibit error:",e),t("danger",e.message||"An unexpected error occurred","fa-exclamation"),!1}},e.init=async function(){var t,r,o,n,i,a,l,d;try{if(!exhibitsAddFormModule||"object"!=typeof exhibitsAddFormModule)throw new Error("exhibitsAddFormModule is not available");if(!exhibitsCommonFormModule||"object"!=typeof exhibitsCommonFormModule)throw new Error("exhibitsCommonFormModule is not available");if(!helperModule||"object"!=typeof helperModule)throw new Error("helperModule is not available");var s,c=[{selector:"#save-exhibit-btn",event:"click",handler:exhibitsAddFormModule.create_exhibit_record,name:"create_exhibit_record"},{selector:"#hero-trash",event:"click",handler:exhibitsCommonFormModule.delete_hero_image,name:"delete_hero_image"},{selector:"#thumbnail-trash",event:"click",handler:exhibitsCommonFormModule.delete_thumbnail_image,name:"delete_thumbnail_image"}];let e=0,t=0;for(s of c)n=s.selector,i=s.event,a=s.handler,l=s.name,d=void 0,((d=document.querySelector(n))?a&&"function"==typeof a?(d.addEventListener(i,a),!0):(console.error(`Invalid handler for ${n}: `+l),!1):(console.warn("Element not found: "+n),!1))?e++:t++;if(console.log(`Initialization complete: ${e} listeners attached, ${t} failed`),r="#item-list-nav",(o=document.querySelector(r))?o.innerHTML="":console.warn("Element not found: "+r),"function"!=typeof helperModule.create_subjects_menu)throw new Error("helperModule.create_subjects_menu is not available");return await helperModule.create_subjects_menu(),!0}catch(e){console.error("Error initializing module:",e);var c=e.message||"An error occurred during initialization";return o=c,(r=document.querySelector("#message"))?((c=document.createElement("div")).className="alert alert-danger",c.setAttribute("role","alert"),(t=document.createElement("i")).className="fa fa-exclamation",o=document.createTextNode(" "+o),c.appendChild(t),c.appendChild(o),r.innerHTML="",r.appendChild(c)):console.error("Message element not found"),!1}},e})();