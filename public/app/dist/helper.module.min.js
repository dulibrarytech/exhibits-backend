let helperModule=(()=>{let r={};function m(e){try{var r=document.querySelector("#message");r&&(r.innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e}</div>`)}catch(e){console.error("Error displaying message:",e.message)}}function t(r){try{if(!r||"string"!=typeof r)return"";var t,n,o=["script","iframe","html","head","body","title","img","embed","applet","object","style","link","form","input","video","source","math","maction","picture","map","svg","details","frameset","comment","base","meta","noscript","onclick","onerror","onload","onmouseover","frame","bgsound","marquee"],a=document.createElement("div");try{a.innerHTML=r}catch(e){return console.warn("Failed to parse HTML:",e.message),""}for(t of o)for(n of a.querySelectorAll(t))n.remove();var i,l=["onclick","onerror","onload","onmouseover","onmouseout","onkeydown","onkeyup","onfocus","onblur","onchange","onsubmit","ondblclick","onmouseenter","onmouseleave","oncontextmenu","onwheel","ondrag","ondrop"];for(i of a.querySelectorAll("*")){for(var s of l)i.removeAttribute(s);var c,d,u=["href","title","target","rel","class","id"],m=[];for(c of i.attributes)u.includes(c.name.toLowerCase())||m.push(c.name);for(d of m)i.removeAttribute(d)}let e=a.innerHTML;var p,g,f={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};for([p,g]of Object.entries(f))e=e.split(p).join(g);return"string"!=typeof(e=e.replace(/\s+/g," ").trim())?(console.warn("Cleaned HTML is not a string"),""):e}catch(e){return console.error("Error in manual_clean_html:",e.message),""}}function a(e){try{var r;return e&&"string"==typeof e?(r=document.querySelectorAll(e))?Array.from(r):[]:(console.error("Invalid selector"),[])}catch(e){return console.error("Error getting form cards:",e),[]}}function i(e,n=!1){e&&0!==e.length&&requestAnimationFrame(()=>{e.forEach(e=>{if(e&&e instanceof HTMLElement)try{var r,t;n?((r=e).style.visibility="visible",r.style.opacity="0",r.style.transition="opacity 0.3s ease-in","none"===r.style.display&&(r.style.display=""),requestAnimationFrame(()=>{r.style.opacity="1"}),r.classList.contains("hidden")&&r.classList.remove("hidden")):((t=e).classList.contains("hidden")&&t.classList.remove("hidden"),t.style.visibility="visible","none"===t.style.display&&(t.style.display=""),"0"===t.style.opacity&&(t.style.opacity="1"))}catch(e){console.error("Error showing card:",e)}else console.warn("Invalid card element, skipping")})})}function o(e,t=!1){e&&0!==e.length&&requestAnimationFrame(()=>{e.forEach(e=>{var r;if(e&&e instanceof HTMLElement)try{t?((r=e).style.transition="opacity 0.3s ease-out",r.style.opacity="0",setTimeout(()=>{r.style.visibility="hidden"},300)):e.style.visibility="hidden"}catch(e){console.error("Error hiding card:",e)}})})}function p(e){try{var r=e.querySelector(".item-order");if(r){var t=r.querySelector("span");if(t){var n=t.textContent.trim(),o=parseInt(n,10);if(!isNaN(o)&&0<o)return o}var a=r.textContent.trim(),i=parseInt(a,10);if(!isNaN(i)&&0<i)return i}var l=e.querySelector("td");if(l&&l.classList.contains("item-order")){var s=l.textContent.trim(),c=parseInt(s,10);if(!isNaN(c)&&0<c)return c}var d=e.getAttribute("data-order");if(d){var u=parseInt(d,10);if(!isNaN(u)&&0<u)return u}return null}catch(e){return console.error("Error getting order number:",e),null}}function g(e,r){var t,n;e&&(e.textContent="",(t=document.createElement("div")).className="alert alert-danger",t.setAttribute("role","alert"),(n=document.createElement("i")).className="fa fa-exclamation",n.setAttribute("aria-hidden","true"),t.appendChild(n),n=document.createTextNode(" "+r),t.appendChild(n),e.appendChild(t))}return r.get_parameter_by_name=function(r,e){try{if(!r||"string"!=typeof r)return console.warn("Invalid or missing parameter name"),null;var t=e&&"string"==typeof e?e:window.location.href;if(!t||"string"!=typeof t)return console.warn("Invalid URL provided"),null;try{var n,o=new URL(t),a=new URLSearchParams(o.search).get(r);return null===a?null:""===a?"":"string"!=typeof a?(console.warn("Parameter value is not a string: "+r),null):(n=DOMPurify.sanitize(a,{ALLOWED_TAGS:[]}))!==a?(console.warn("Parameter contained potentially malicious content: "+r),null):n}catch(e){console.debug("URLSearchParams failed, using regex fallback:",e.message);var i,l,s,c,d=r,u=t;try{return d&&"string"==typeof d&&u&&"string"==typeof u?(i=d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),(l=new RegExp(`[?&]${i}(=([^&#]*)|&|#|$)`,"i").exec(u))?l[2]?"string"!=typeof(s=decodeURIComponent(l[2].replace(/\+/g," ")))?(console.warn("Decoded parameter value is not a string: "+d),null):(c=DOMPurify.sanitize(s,{ALLOWED_TAGS:[]}))!==s?(console.warn("Parameter contained potentially malicious content: "+d),null):c:"":null):null}catch(e){return console.error("Error in parse_parameter_regex:",e.message),null}}}catch(e){return console.error("Error in get_parameter_by_name:",e.message),m("An error occurred: "+e.message),null}},r.unescape=function(r){try{if(null==r)return"";if("string"!=typeof r&&(console.warn("Data is not a string, converting from "+typeof r),r=String(r)),""===r||""===r.trim())return"";var t,n,o={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x27;":"'","&#x2F;":"/","&apos;":"'"};let e=r;for([t,n]of Object.entries(o))e=e.split(t).join(n);return"string"!=typeof(e=(e=e.replace(/&#(\d+);/g,(e,r)=>{r=parseInt(r,10);return 0<r&&r<=1114111?String.fromCharCode(r):e})).replace(/&#x([0-9a-fA-F]+);/g,(e,r)=>{r=parseInt(r,16);return 0<r&&r<=1114111?String.fromCharCode(r):e}))?(console.warn("Unescaped value is not a string"),""):e}catch(e){return console.error("Error in unescape_safe:",e.message),m("An error occurred: "+e.message),""}},r.strip_html=function(r){try{if(null==r)return"";if("string"!=typeof r&&(console.warn("Input is not a string, converting from "+typeof r),r=String(r)),""===r||""===r.trim())return"";try{return(new DOMParser).parseFromString(r,"text/html").body.textContent||""}catch(e){console.debug("DOMParser failed, using regex fallback:",e.message);var t=r;try{if(!t||"string"!=typeof t)return"";let e=t.replace(/<[^>]*>/g,"");e=(e=e.replace(/\s+/g," ")).trim();var n,o,a={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x27;":"'","&#x2F;":"/"};for([n,o]of Object.entries(a))e=e.split(n).join(o);return"string"!=typeof(e=(e=e.replace(/&#(\d+);/g,(e,r)=>{r=parseInt(r,10);return 0<r&&r<=1114111?String.fromCharCode(r):e})).replace(/&#x([0-9a-fA-F]+);/g,(e,r)=>{r=parseInt(r,16);return 0<r&&r<=1114111?String.fromCharCode(r):e}))?(console.warn("Stripped value is not a string"),""):e}catch(e){return console.error("Error in strip_html_regex:",e.message),""}}}catch(e){return console.error("Error in strip_html:",e.message),m("An error occurred: "+e.message),""}},r.clean_html=function(r){try{if(null==r)return"";if("string"!=typeof r&&(console.warn("Input is not a string, converting from "+typeof r),r=String(r)),""===r||""===r.trim())return"";if("undefined"!=typeof DOMPurify)try{var e=DOMPurify.sanitize(r,{ALLOWED_TAGS:["b","i","em","strong","a","p","br","ul","ol","li","blockquote","h1","h2","h3","h4","h5","h6","span","div"],ALLOWED_ATTR:["href","title","target","rel"],KEEP_CONTENT:!0,FORCE_BODY:!1});return"string"!=typeof e?(console.warn("DOMPurify output is not a string"),""):e}catch(e){return console.error("DOMPurify sanitization failed:",e.message),t(r)}return console.debug("DOMPurify not available, using manual HTML cleaning"),t(r)}catch(e){return console.error("Error in clean_html:",e.message),m("An error occurred: "+e.message),""}},r.preview_html=function(e){try{if(helperModule)if(e&&"string"==typeof e){var r=e.replace(/[^a-zA-Z0-9_-]/g,"");if(r!==e)console.warn("Element ID contained invalid characters: "+e),m("Invalid element ID format.");else{var t=document.getElementById(r);if(t)if("string"!=typeof t.value)console.warn("Source element does not have a string value property: "+r),m("Source element has invalid value.");else{var n,o=t.value;if(o&&""!==o.trim()){var a=helperModule.clean_html(o);if(a&&"string"==typeof a){var i=document.getElementById("preview-html");if(i){try{i.innerHTML=a}catch(e){return console.error("Failed to set preview HTML:",e.message),m("Failed to display HTML preview."),!1}try{t.value=a}catch(e){return console.error("Failed to update source element:",e.message),m("Failed to update HTML content."),!1}console.debug("HTML preview successfully generated for element: "+r)}else console.warn("Preview element not found: preview-html"),m("Preview element not found in page.")}else console.error("HTML cleaning failed or returned invalid result"),m("Failed to clean HTML content.")}else console.debug("No HTML content to preview, clearing previous data"),(n=document.getElementById("preview-html"))&&(n.innerHTML=""),t.value=""}else console.warn("Source element not found: "+r),m(`Element with ID "${r}" not found.`)}}else console.warn("Invalid or missing element ID parameter"),m("Invalid element ID provided.");else console.error("helperModule is not available"),m("System configuration error.");return!1}catch(e){return console.error("Error in preview_html:",e.message),m("An error occurred: "+e.message),!1}},r.get_checked_radio_button=function(e){try{var r,t;return e?e.length?"function"!=typeof e[Symbol.iterator]&&"number"!=typeof e.length?(console.warn("radio_buttons is not iterable"),null):(r=Array.from(e).find(e=>e&&"object"==typeof e&&"checked"in e?!0===e.checked:(console.warn("Invalid radio button element in collection"),!1)))?"value"in r?""===(t=String(r.value))||"undefined"===t?(console.warn("Checked radio button has empty or undefined value"),null):t:(console.warn("Checked radio button does not have value property"),null):(console.debug("No radio button is currently checked"),null):(console.warn("radio_buttons is not array-like or is empty"),null):(console.warn("Missing radio_buttons parameter"),null)}catch(e){return console.error("Error in get_checked_radio_button:",e.message),m("An error occurred: "+e.message),null}},r.get_current_year=function(){try{var e=(new Date).getFullYear();domModule.html("#cdate",DOMPurify.sanitize(e))}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},r.format_date=function(e){return(1+e.getMonth()).toString().padStart(2,"0")+`/${e.getDate().toString().padStart(2,"0")}/${e.getFullYear()} @ ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:`+e.getSeconds().toString().padStart(2,"0")},r.show_form=function(r=0,t=".card",n=!1){try{var o=(e=>"number"!=typeof(e="string"==typeof e?parseInt(e,10):e)||isNaN(e)?(console.warn("Invalid delay, using 0"),0):e<0?(console.warn("Negative delay not allowed, using 0"),0):1e4<e?(console.warn("Delay too large, capping at 10 seconds"),1e4):Math.floor(e))(r);let e=a(t);return e&&0!==e.length?(0===o?i(e,n):setTimeout(()=>{i(e,n)},o),!0):(console.warn("No elements found with selector: "+t),!1)}catch(e){console.error("Error showing form:",e);r=document.querySelector("#message");return r&&g(r,e.message||"Unable to show form"),!1}},r.hide_form=function(e=".card",r=!1){try{var t=a(e);return t&&0!==t.length?(o(t,r),!0):(console.warn("No elements found with selector: "+e),!1)}catch(e){return console.error("Error hiding form:",e),!1}},r.toggle_form=function(e=".card",r=!1){try{var t,n=a(e);return n&&0!==n.length?"hidden"!==(t=n[0]).style.visibility&&"hidden"!==getComputedStyle(t).visibility?(o(n,r),!1):(i(n,r),!0):(console.warn("No elements found with selector: "+e),!1)}catch(e){return console.error("Error toggling form:",e),!1}},r.reorder_items=async function(e,r){try{if(!r||!Array.isArray(r))return console.error("Invalid reordered_items parameter"),!1;if(0===r.length)return console.log("No items to reorder"),!1;var t=endpointsModule.get_exhibits_endpoints();if(!t?.exhibits?.reorder_records?.post?.endpoint)throw new Error("Reorder endpoint not configured");var n=helperModule.get_parameter_by_name("exhibit_id");if(!n)throw new Error("Exhibit ID not found in URL");var o=authModule.get_user_token();if(!o||!1===o)throw new Error("Not authenticated - please log in again");var a=(r=>{var t=[];for(let e=0;e<r.length;e++){var n,o,a=r[e];a&&a.node?(a=a.node,(n=a.getAttribute("id"))?(o=(e=>!e||"string"!=typeof e||(e=e.split("_")).length<2?null:3===e.length?{uuid:e[0],type:e[2]}:2===e.length?{uuid:e[0],type:e[1]}:{uuid:e[0],type:e[e.length-1]})(n))?null===(a=p(a))?console.warn("Could not find order number for item:",n):t.push({uuid:o.uuid,type:o.type,order:a}):console.warn("Could not parse item ID:",n):console.warn("Item missing id attribute at index",e)):console.warn("Invalid item at index",e)}return t})(r);if(!a||0===a.length)throw new Error("Failed to build reorder data");var i=t.exhibits.reorder_records.post.endpoint.replace(":exhibit_id",encodeURIComponent(n)),l=await httpModule.req({method:"POST",url:i,data:a,headers:{"Content-Type":"application/json","x-access-token":o},timeout:3e4});if(l&&200===l.status)return console.log("Items reordered successfully"),!0;throw new Error("Failed to reorder items - server returned an error")}catch(e){console.error("Error reordering items:",e);r=document.querySelector("#message");return r&&g(r,e.message||"An error occurred while reordering items"),!1}},r.reorder_grid_items=async function(e,r){try{if(!r||!Array.isArray(r))return console.error("Invalid reordered_items parameter"),!1;if(0===r.length)return console.log("No grid items to reorder"),!1;var t=endpointsModule.get_exhibits_endpoints();if(!t?.exhibits?.reorder_records?.post?.endpoint)throw new Error("Reorder endpoint not configured");var n=helperModule.get_parameter_by_name("exhibit_id");if(!n)throw new Error("Exhibit ID not found in URL");var o=helperModule.get_parameter_by_name("grid_id");if(!o)throw new Error("Grid ID not found in URL");var a=authModule.get_user_token();if(!a||!1===a)throw new Error("Not authenticated - please log in again");var i=((r,t)=>{var n=[];for(let e=0;e<r.length;e++){var o,a,i=r[e];i&&i.node?(i=i.node,(o=i.getAttribute("id"))?(a=(e=>{if(e&&"string"==typeof e){e=e.split("_");if(!(e.length<1)){e=e[0];if(e&&0<e.length)return e}}return null})(o))?null===(i=p(i))?console.warn("Could not find order number for grid item:",o):n.push({grid_id:t,uuid:a,type:"griditem",order:i}):console.warn("Could not parse grid item ID:",o):console.warn("Grid item missing id attribute at index",e)):console.warn("Invalid grid item at index",e)}return n})(r,o);if(!i||0===i.length)throw new Error("Failed to build grid reorder data");var l=t.exhibits.reorder_records.post.endpoint.replace(":exhibit_id",encodeURIComponent(n)),s=await httpModule.req({method:"POST",url:l,data:i,headers:{"Content-Type":"application/json","x-access-token":a},timeout:3e4});if(s&&201===s.status){console.log("Grid items reordered successfully");let e=document.querySelector("#message");return e&&(c=e,d="Grid items reordered successfully",c&&(c.textContent="",(u=document.createElement("div")).className="alert alert-success",u.setAttribute("role","alert"),(m=document.createElement("i")).className="fa fa-check",m.setAttribute("aria-hidden","true"),u.appendChild(m),m=document.createTextNode(" "+d),u.appendChild(m),c.appendChild(u)),setTimeout(()=>{e.textContent=""},3e3)),!0}throw new Error("Failed to reorder grid items - server returned an error")}catch(e){console.error("Error reordering grid items:",e);r=document.querySelector("#message");return r&&g(r,e.message||"An error occurred while reordering grid items"),!1}var c,d,u,m},r.check_if_locked=async function(r,t){let n=()=>{helperModule&&"function"==typeof helperModule.unlock_record?helperModule.unlock_record(!1,{force:!0}):console.error("unlock_record function not available")};var o,a,i,l,s,c,d,u,m;try{if(r&&"object"==typeof r)if(t&&"string"==typeof t){var p=authModule.get_user_profile_data();if(p&&p.uid){var g=parseInt(p.uid,10);if(isNaN(g))console.error("Invalid user ID in profile");else{var f=1===r.is_locked||!0===r.is_locked,h=r.locked_by_user&&parseInt(r.locked_by_user,10)!==g;if(f&&h)if((e=>{e=document.querySelector(e);e&&(e.style.display="none")})(t),document.querySelector("#message")){var _=await authModule.get_user_role(g);let e=null;"Administrator"===_&&(e=((c=document.createElement("div")).className="btn-group float-right",(d=document.createElement("button")).id="unlock-record",d.className="btn btn-xs btn-secondary",(u=document.createElement("i")).className="fa fa-unlock-alt",m=document.createTextNode(" Unlock"),d.appendChild(u),d.appendChild(m),d.addEventListener("click",n),c.appendChild(d),u=document.createElement("span"),m=document.createElement("br"),u.appendChild(m),u.appendChild(c),u));[o,a,i=null]=["warning","This record is currently being worked on by another user.",e],(s=document.querySelector("#message"))?((l=document.createElement("div")).className="alert alert-"+o,l.setAttribute("role","alert"),(o=document.createElement("i")).className="fa fa-lock",a=document.createTextNode(" "+a),l.appendChild(o),l.appendChild(a),i&&(l.appendChild(document.createTextNode("  ")),l.appendChild(i)),s.innerHTML="",s.appendChild(l)):console.error("Message element not found")}else console.warn("Message element not found, cannot display lock warning")}}else console.error("Unable to get user profile data")}else console.error("Invalid card_id provided to check_if_locked");else console.error("Invalid record provided to check_if_locked")}catch(e){console.error("Error checking if record is locked:",e);p=e.message||"An error occurred while checking record lock status";r=p,(f=document.querySelector("#message"))?((h=document.createElement("div")).className="alert alert-danger",h.setAttribute("role","alert"),(t=document.createElement("i")).className="fa fa-exclamation",r=document.createTextNode(" "+r),h.appendChild(t),h.appendChild(r),f.innerHTML="",f.appendChild(h)):console.error("Message element not found")}},r.unlock_record=async function(r=!1,t={}){var{}=t;var n=[{paths:["exhibits/exhibit/edit"],endpoint_key:"exhibits.exhibit_unlock_record.post.endpoint",params:e=>({exhibit_id:e})},{paths:["items/heading/edit"],endpoint_key:"exhibits.heading_unlock_record.post.endpoint",params:e=>({exhibit_id:e,heading_id:helperModule.get_parameter_by_name("item_id")})},{paths:["items/standard/text/edit","items/standard/media/edit"],endpoint_key:"exhibits.item_unlock_record.post.endpoint",params:e=>({exhibit_id:e,item_id:helperModule.get_parameter_by_name("item_id")})},{paths:["items/grid/item/media/edit","items/grid/item/text/edit"],endpoint_key:"exhibits.grid_item_unlock_record.post.endpoint",params:e=>({exhibit_id:e,grid_id:helperModule.get_parameter_by_name("grid_id"),item_id:helperModule.get_parameter_by_name("item_id")})},{paths:["items/vertical-timeline/item/media/edit","items/vertical-timeline/item/text/edit"],endpoint_key:"exhibits.timeline_item_unlock_record.post.endpoint",params:e=>({exhibit_id:e,timeline_id:helperModule.get_parameter_by_name("timeline_id"),item_id:helperModule.get_parameter_by_name("item_id")})}],o=(e,r="info",t="fa-info")=>{var n,o=document.querySelector("#message");o?((n=document.createElement("div")).className="alert alert-"+r,n.setAttribute("role","alert"),t&&((r=document.createElement("i")).className="fa "+t,n.appendChild(r),n.appendChild(document.createTextNode(" "))),t=document.createTextNode(e),n.appendChild(t),o.innerHTML="",o.appendChild(n)):console.error("Message element not found")};try{var a=endpointsModule.get_exhibits_endpoints();if(!a)throw new Error("Unable to retrieve endpoints configuration");var i=window.location.pathname;if(!i)throw new Error("Unable to determine current page path");var l=helperModule.get_parameter_by_name("exhibit_id");if(!l)throw new Error("Missing required parameter: exhibit_id");var s=((r,e)=>{for(var t of e)if(t.paths.some(e=>r.includes(e)))return t;return null})(i,n);if(!s)return console.error("No matching endpoint found for current path:",i),r||o("Unable to determine record type.","danger","fa-exclamation"),!1;var c=((e,r)=>{if(!e||!r)return null;var t;let n=e;for(t of r.split(".")){if(!(n&&"object"==typeof n&&t in n))return null;n=n[t]}return n})(a,s.endpoint_key);if(!c)throw new Error("Endpoint template not found in configuration");var d,u,m="function"==typeof s.params?s.params(l):s.params;for([d,u]of Object.entries(m))if(!u)throw new Error("Missing required parameter: "+d);var p=((e,r)=>{if(!e||!r)return null;let t=e;for(var[n,o]of Object.entries(r)){if(!o)return console.error("Missing required parameter: "+n),null;o=encodeURIComponent(o);t=t.replace(":"+n,o)}return t})(c,m);if(!p)throw new Error("Failed to build endpoint URL");var g=authModule.get_user_profile_data(),f=authModule.get_user_token();if(!g||!g.uid)throw new Error("User profile data not available");if(!f)throw new Error("Authentication token not available");var h,_=new URLSearchParams({uid:g.uid});if(r)return navigator.sendBeacon?(_.append("t",f),h=p+"?"+_.toString(),navigator.sendBeacon(h,"")?(console.log("Unlock beacon sent successfully"),!0):(console.warn("Beacon API failed to send unlock request"),!1)):(console.warn("Beacon API not available"),!1);let e=p+"?"+_.toString();!0===t.force&&(e=e+"&force="+t.force);var y=await Promise.race([httpModule.req({method:"POST",url:e,headers:{"Content-Type":"application/json","x-access-token":f}}),new Promise((e,r)=>setTimeout(()=>r(new Error("Request timeout")),3e4))]);if(y)return 200===y.status?(o("Record unlocked successfully","success","fa-check"),!0):(o("Failed to unlock record. Please try again.","danger","fa-exclamation"),!1);throw new Error("No response received from server")}catch(e){return console.error("Error unlocking record:",e),r||o(e.message||"An unexpected error occurred while unlocking the record","danger","fa-exclamation"),!1}},r.setup_auto_unlock=function(e){if(e&&1===e.is_locked){var r=authModule.get_user_profile_data();if(r&&r.uid){r=parseInt(r.uid,10),e=parseInt(e.locked_by_user,10);if(r===e){let e=!1;document.addEventListener("visibilitychange",()=>{document.hidden&&!e&&(e=!0,console.log("Attempting unlock via beacon"),this.unlock_record(!0).catch(e=>{console.error("Visibility unlock failed:",e)}))}),window.addEventListener("pagehide",()=>{e||(e=!0,console.log("Page hiding - attempting unlock via beacon"),this.unlock_record(!0).catch(e=>{console.error("Page hide unlock failed:",e)}))}),window.addEventListener("beforeunload",()=>{e||(e=!0,console.log("Page unloading - attempting unlock via beacon"),this.unlock_record(!0).catch(e=>{console.error("Before unload unlock failed:",e)}))}),console.log("Auto-unlock setup complete for record (using beacon on visibility/page events)")}}}},r.get_user_name=function(){try{var e;return authModule&&"function"==typeof authModule.get_user_profile_data?(e=authModule.get_user_profile_data())&&"object"==typeof e?e.name||null:(console.warn("User profile data not available"),null):(console.error("authModule or get_user_profile_data not available"),null)}catch(e){return console.error("Error getting user name:",e),null}},r.get_owner=function(){try{var e,r;return authModule&&"function"==typeof authModule.get_user_profile_data?(e=authModule.get_user_profile_data())&&"object"==typeof e?e.uid?(r=parseInt(e.uid,10),isNaN(r)?(console.error("Invalid UID value:",e.uid),null):r):(console.warn("User UID not available in profile"),null):(console.warn("User profile data not available"),null):(console.error("authModule or get_user_profile_data not available"),null)}catch(e){return console.error("Error getting owner ID:",e),null}},r.init_subjects_menu=function(){r.subjects_menu=new SubjectsMenu({get_item_subjects:r.get_item_subjects.bind(r),show_error_message:m,on_change:e=>{console.log("Subjects changed:",e)}})},r.create_subjects_menu=async function(e=[]){r.subjects_menu||r.init_subjects_menu(),r.subjects_menu.is_initialized()?await r.subjects_menu.update(e):await r.subjects_menu.init(e)},r.reinit_subjects_menu=async function(e=[]){r.subjects_menu||r.init_subjects_menu(),await r.subjects_menu.init(e)},r.get_selected_subjects=function(){return r.subjects_menu?r.subjects_menu.get_selected():[]},r.clear_subjects=function(){r.subjects_menu&&r.subjects_menu.clear()},r.get_item_subjects=async function(){try{var r=endpointsModule.get_exhibits_endpoints();if(!r?.exhibits?.item_subjects?.endpoint)throw new Error("Item subjects endpoint not configured");var e=authModule.get_user_token();if(!e||!1===e)return console.error("No authentication token available"),authModule.redirect_to_auth(),null;var t=await httpModule.req({method:"GET",url:r.exhibits.item_subjects.endpoint,headers:{"Content-Type":"application/json","x-access-token":e},timeout:3e4});if(!t)throw new Error("No response received from server");if(200!==t.status)throw new Error("Server returned status "+t.status);if(t.data&&"object"==typeof t.data)return t.data.data?Array.isArray(t.data.data)?t.data.data:(console.error("Response data.data is not an array"),[]):(console.warn("Response data.data is missing or empty"),[]);throw new Error("Invalid response data structure")}catch(e){console.error("Error getting item subjects:",e);r=document.querySelector("#message");return r&&g(r,e.message||"Unable to retrieve item subjects"),null}},r.check_app_env=function(){var e=window.location.hostname;"localhost"!==e&&"libwebapw01-vlt.du.edu"!==e&&"exhibits.dev"!==e||null!==(e=document.querySelector("#app-message"))&&(e.innerHTML='<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> <strong>"STOP! Do not use Development Site"</strong>&nbsp;&nbsp;&nbsp;<a class="btn btn-info" href="https://exhibits-backend.library.du.edu/exhibits-dashboard/auth" target="_blank">Go to Live Site </a> </div>')},r.clear_status_message=function(e){e&&(e.style.transition="opacity 0.3s ease-out",e.style.opacity="0",setTimeout(()=>{e.textContent="",e.style.opacity="1"},300))},r.init=function(){},r})();helperModule.init();