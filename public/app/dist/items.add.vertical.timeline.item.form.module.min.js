let itemsAddVerticalTimelineItemFormModule=(()=>{let s=window.localStorage.getItem("exhibits_app_path"),_=endpointsModule.get_exhibits_endpoints(),r={};function u(e,t,i){var o,r;e&&(t=["info","success","danger","warning"].includes(t)?t:"info",(o=document.createElement("div")).className="alert alert-"+t,o.setAttribute("role","alert"),(r=document.createElement("i")).className={info:"fa fa-info",success:"fa fa-check",danger:"fa fa-exclamation",warning:"fa fa-exclamation-triangle"}[t]||"fa fa-info",o.appendChild(r),t=document.createTextNode(" "+i),o.appendChild(t),e.textContent="",e.appendChild(o))}return r.create_timeline_item_record=async function(){var e=helperModule.get_parameter_by_name("item_id");if(e)return console.log("üî¥ Item ID exists - already in edit mode, preventing duplicate creation"),console.log("Current URL:",window.location.href),console.log("item_id:",e),r.update_timeline_item_record&&"function"==typeof r.update_timeline_item_record?(console.log("Redirecting to update function..."),r.update_timeline_item_record()):(u(document.querySelector("#message"),"warning","Already in edit mode. Update function not available."),console.error("ERROR: update_timeline_item_record function not found!"),!1);if(console.log("üü¢ CREATE FUNCTION CALLED - No item_id, proceeding with creation"),this._is_creating_timeline_item)return console.log("Already creating, preventing duplicate submission"),!1;this._is_creating_timeline_item=!0;try{var t=document.querySelector("#message");window.scrollTo({top:0,behavior:"smooth"});let r=helperModule.get_parameter_by_name("exhibit_id"),a=helperModule.get_parameter_by_name("timeline_id");if(!r||!a)return u(t,"warning","Missing exhibit ID or timeline ID. Cannot create timeline item record."),!1;u(t,"info","Creating timeline item record...");var i=authModule.get_user_token();if(!i||!1===i)return u(t,"danger","Session expired. Please log in again."),setTimeout(()=>{authModule.logout()},1e3),!1;var o=itemsCommonVerticalTimelineItemFormModule.get_common_timeline_item_form_fields();if(!o||!1===o||void 0===o)return u(t,"danger","Unable to get form field values. Please check all required fields."),!1;var l=helperModule.get_user_name(),d=helperModule.get_owner();if(l&&(o.created_by=l),d&&(o.owner=d),!_?.exhibits?.timeline_item_records?.post?.endpoint)return u(t,"danger","API endpoint configuration missing"),!1;var m=_.exhibits.timeline_item_records.post.endpoint.replace(":exhibit_id",encodeURIComponent(r)).replace(":timeline_id",encodeURIComponent(a)),c=await httpModule.req({method:"POST",url:m,data:o,headers:{"Content-Type":"application/json","x-access-token":i},timeout:3e4});if(!c||201!==c.status){if(c)throw new Error("Failed to create timeline item record");return u(t,"danger","Permission denied. You do not have access to add items to this timeline."),!1}let n=c.data?.data;if(n)return console.log("‚úÖ Timeline item record created successfully, ID:",n),u(t,"success","Timeline item record created successfully. Redirecting to edit page..."),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{{var t=r,i=a,o=n;console.log("=== REDIRECTING TO TIMELINE ITEM EDIT PAGE ==="),console.log("exhibit_id:",t),console.log("timeline_id:",i),console.log("timeline_item_id:",o);let e="text";-1!==window.location.pathname.indexOf("media")?(e="media",console.log("Media form detected from URL path")):console.log("Text form detected (default)"),t=new URLSearchParams({exhibit_id:t,timeline_id:i,item_id:o}),i=`${s}/items/vertical-timeline/item/${e}/edit?`+t.toString(),console.log("Item form type:",e),console.log("Redirecting to:",i),console.log("Note: Back button will NOT return to create page"),window.location.replace(i)}},1200),!0;throw new Error("Server did not return a valid timeline item ID")}catch(e){return console.error("‚ùå Error creating timeline item record:",e),u(document.querySelector("#message"),"danger",e.user_message||e.message||"Unable to create timeline item record. Please try again."),!1}finally{this._is_creating_timeline_item=!1}},r.create_timeline_item_record__=async function(){try{window.scrollTo(0,0);let i=helperModule.get_parameter_by_name("exhibit_id"),o=helperModule.get_parameter_by_name("timeline_id");if(void 0===o)return!(document.querySelector("#message").innerHTML='<div class="alert alert-warning" role="alert"><i class="fa fa-info"></i> Unable to create timeline item record.</div>');document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-info"></i> Creating timeline item record...</div>';var e=itemsCommonVerticalTimelineItemFormModule.get_common_timeline_item_form_fields();if(void 0===e)return!(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> Unable to get form field values</div>');if(!1===e)return!1;var t=helperModule.get_user_name(),r=helperModule.get_owner();t&&(e.created_by=t),r&&(e.owner=r),e.created_by=t;var a=_.exhibits.timeline_item_records.post.endpoint.replace(":exhibit_id",i).replace(":timeline_id",o),n=authModule.get_user_token(),l=await httpModule.req({method:"POST",url:a,data:e,headers:{"Content-Type":"application/json","x-access-token":n}});if(void 0!==l&&201===l.status){document.querySelector("#message").innerHTML='<div class="alert alert-success" role="alert"><i class="fa fa-info"></i> Timeline item record created</div>';let t=l.data.data;setTimeout(()=>{let e="text";-1!==window.location.pathname.indexOf("media")&&(e="media"),window.location.replace(`${s}/items/vertical-timeline/item/${e}/edit?exhibit_id=${i}&timeline_id=${o}&item_id=`+t)},900)}else void 0===l&&(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> You do not have permission to add item to this exhibit.</div>')}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},r.init=async function(){try{var e=helperModule.get_parameter_by_name("exhibit_id"),t="/items?exhibit_id="+e+"&timeline_id="+helperModule.get_parameter_by_name("timeline_id")+"&status=403";await authModule.check_permissions(["add_item","add_item_to_any_exhibit"],"timeline_item",e,null,t),exhibitsModule.set_exhibit_title(e),document.querySelector("#save-item-btn").addEventListener("click",itemsAddVerticalTimelineItemFormModule.create_timeline_item_record),-1!==window.location.pathname.indexOf("media")&&await helperModule.create_subjects_menu()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},r})();