let itemsGridModule=(()=>{let w=window.localStorage.getItem("exhibits_app_path"),n=endpointsModule.get_exhibits_endpoints();var e={};return e.display_grid_items=async function(e){var t=helperModule.get_parameter_by_name("exhibit_id"),i=helperModule.get_parameter_by_name("grid_id"),r=document.querySelector("#grid-items"),a=document.querySelector(".card"),l=(null!==r&&(r.style.visibility="hidden"),null!==a&&(a.style.minHeight="200px"),document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert"><i class="fa fa-spinner fa-spin"></i> Loading grid items...</div>',await exhibitsModule.set_exhibit_title(t),await(async(e,t)=>{try{var i=n.exhibits.grid_item_records.get.endpoint.replace(":exhibit_id",e),r=authModule.get_user_token(),a=i.replace(":grid_id",t),l=await httpModule.req({method:"GET",url:a,headers:{"Content-Type":"application/json","x-access-token":r}});if(void 0!==l&&200===l.status)return l.data.data}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}})(t,i));if(document.querySelector("#message").innerHTML="",!1===l)return document.querySelector("#item-card").innerHTML="",null!==r&&(r.style.visibility="visible"),!1;if(0===l.length)return t=document.querySelector("#item-card"),i=document.querySelector("#exhibit-title"),null!==t&&(t.style.display="none"),null!==i&&null!==i.parentElement&&(i.parentElement.style.display="none"),!(document.querySelector("#message").innerHTML='<div class="alert alert-info" role="alert">Grid is empty.</div>');let s="";var d=[];for(let e=0;e<l.length;e++)d.push(l[e].order),s+=await itemsListDisplayModule.display_grid_items(l[e]);document.querySelector("#grid-item-list").innerHTML=s;new DataTable("#grid-items",{paging:!1,rowReorder:!0}).on("row-reordered",async(e,t)=>{await helperModule.reorder_grid_items(e,t)});t=document.querySelector("#grid-items tbody");null!==t&&t.addEventListener("click",async function(e){var t=e.target.closest(".publish-item, .suppress-item");if(null!==t){e.preventDefault();e=t.getAttribute("id");if(null!==e)if(t.classList.contains("publish-item")){var i=e;try{var r=helperModule.get_parameter_by_name("exhibit_id"),a=helperModule.get_parameter_by_name("grid_id"),l=i,s=endpointsModule.get_exhibits_endpoints().exhibits.grid_item_records.grid_item_publish.post.endpoint.replace(":exhibit_id",r).replace(":grid_id",a).replace(":grid_item_id",l),d=authModule.get_user_token(),n=await httpModule.req({method:"POST",url:s+"?type=grid_item",headers:{"Content-Type":"application/json","x-access-token":d},timeout:1e4,validateStatus:function(e){return 200<=e&&e<600}});if(200===n.status){var o=document.getElementById(i);o.classList.remove("publish-item"),o.classList.add("suppress-item"),o.innerHTML='<span id="suppress" title="published"><i class="fa fa-cloud" style="color: green"></i><br>Published</span>';var m=Array.from(document.querySelectorAll("tr")).map(e=>e.id).filter(e=>e).find(e=>{e=e.split("_");return i===e[0]}).split("_");let e;e="griditem"===m[1]&&"text"===m[2]?w+`/items/grid/item/text/details?exhibit_id=${r}&grid_id=${a}&item_id=`+i:w+`/items/grid/item/media/details?exhibit_id=${r}&grid_id=${a}&item_id=`+i;var u=i+"-item-actions",c=document.getElementById(u),p=`<a href="${e}" title="View details" aria-label="item-details"><i class="fa fa-folder-open pr-1"></i> </a>`;c.innerHTML=`
                    <div class="card-text text-sm-center">
                    ${p}&nbsp;
                    <i title="Can only delete if unpublished" style="color: #d3d3d3" class="fa fa-trash pr-1" aria-label="delete-grid-item"></i>
                    </div>`}else 403===n.status&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-danger"></i> You do not have permission to publish this record.</div>',setTimeout(()=>{document.querySelector("#message").innerHTML=""},5e3));return void await(500===n.status&&(scrollTo(0,0),document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${n.data.message}</div>`,setTimeout(()=>{},5e3)),!1)}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}else if(t.classList.contains("suppress-item")){var _=e;try{var g=helperModule.get_parameter_by_name("exhibit_id"),h=helperModule.get_parameter_by_name("grid_id"),y=_,v=endpointsModule.get_exhibits_endpoints().exhibits.grid_item_records.grid_item_suppress.post.endpoint.replace(":exhibit_id",g).replace(":grid_id",h).replace(":grid_item_id",y),b=authModule.get_user_token(),f=await httpModule.req({method:"POST",url:v+"?type=grid_item",headers:{"Content-Type":"application/json","x-access-token":b}});if(void 0!==f&&200===f.status){var M=document.getElementById(_);M.classList.remove("suppress-item"),M.classList.add("publish-item"),M.innerHTML='<span id="publish" title="suppressed"><i class="fa fa-cloud-upload" style="color: darkred"></i><br>Suppressed</span>';var x,T=Array.from(document.querySelectorAll("tr")).map(e=>e.id).filter(e=>e).find(e=>{e=e.split("_");return _===e[0]}).split("_");let e;e="griditem"===T[1]&&"text"===T[2]?w+`/items/grid/item/text/edit?exhibit_id=${g}&grid_id=${h}&item_id=`+_:w+`/items/grid/item/media/edit?exhibit_id=${g}&grid_id=${h}&item_id=`+_,x=w+`/items/grid/item/delete?exhibit_id=${g}&grid_id=${h}&item_id=`+_;var L=_+"-item-actions",S=document.getElementById(L),q=`<a href="${e}" title="Edit item" aria-label="edit-item"><i class="fa fa-edit pr-1"></i> </a>`,H=`<a href="${x}" title="Delete item" aria-label="delete-item"><i class="fa fa-trash pr-1"></i></a>`;S.innerHTML=`
                    <div class="card-text text-sm-center">
                    ${""}&nbsp;
                    ${q}&nbsp;
                    ${H}
                    </div>`}else void 0===f&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-danger"></i> You do not have permission to unpublish this record.</div>',setTimeout(()=>{document.querySelector("#message").innerHTML=""},5e3));return void await(void 0!==f&&204===f.status&&(scrollTo(0,0),document.querySelector("#message").innerHTML='<div class="alert alert-warning" role="alert"><i class="fa fa-warning"></i> Unable to unpublish grid item</div>',setTimeout(()=>{document.querySelector("#message").innerHTML=""},5e3)),!1)}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}}}}),null!==r&&(r.style.visibility="visible"),null!==a&&(a.style.minHeight="")},e.delete_grid_item=async function(){try{document.querySelector("#delete-message").innerHTML="Deleting grid item...",document.querySelector("#delete-card").style.display="none";let e=helperModule.get_parameter_by_name("exhibit_id"),t=helperModule.get_parameter_by_name("grid_id");var i=helperModule.get_parameter_by_name("item_id"),r=n.exhibits.grid_item_records.delete.endpoint.replace(":exhibit_id",e).replace(":grid_id",t).replace(":item_id",i),a=authModule.get_user_token(),l=await httpModule.req({method:"DELETE",url:r+"?type=grid_item",headers:{"Content-Type":"application/json","x-access-token":a}});void 0!==l&&204===l.status?setTimeout(()=>{window.location.replace(`${w}/items/grid/items?exhibit_id=${e}&grid_id=`+t)},900):void 0===l&&(document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> You do not have permission to delete this item.</div>')}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e.init=async function(){try{var e=helperModule.get_parameter_by_name("status");if(null!==e&&"403"===e){let e=helperModule.get_parameter_by_name("exhibit_id"),t=helperModule.get_parameter_by_name("grid_id");setTimeout(()=>{window.history.replaceState({page:"items"},"","/exhibits-dashboard/items/grid/items?exhibit_id="+e+"&grid_id="+t)},0),setTimeout(()=>{document.querySelector("#message").innerHTML='<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> You do not have permission to add item.</div>'},50)}var t=authModule.get_user_token();await authModule.check_auth(t),navModule.init(),navModule.back_to_items(),navModule.set_preview_link(),navModule.set_grid_item_nav_menu_links(),navModule.set_logout_link(),helperModule.show_form()}catch(e){document.querySelector("#message").innerHTML=`<div class="alert alert-danger" role="alert"><i class="fa fa-exclamation"></i> ${e.message}</div>`}},e})();